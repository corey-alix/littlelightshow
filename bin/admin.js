var Lo=Object.create;var pt=Object.defineProperty;var Fo=Object.getOwnPropertyDescriptor;var Bo=Object.getOwnPropertyNames;var ko=Object.getPrototypeOf,Mo=Object.prototype.hasOwnProperty;var Uo=e=>pt(e,"__esModule",{value:!0});var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Vo=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Bo(t))!Mo.call(e,a)&&a!=="default"&&pt(e,a,{get:()=>t[a],enumerable:!(n=Fo(t,a))||n.enumerable});return e},_e=e=>Vo(Uo(pt(e!=null?Lo(ko(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var rn=y((_c,nn)=>{"use strict";nn.exports=Go;function Go(e){if(typeof e!="function")throw new Error("Could not parse function signature for injection dependencies: Object is not a function");if(!e.length)return[];var t=/^()\(?([^)=]*)\)? *=>/.exec(e+"")||/^[^(]+([^ \(]*) *\(([^\)]*)\)/.exec(e+"");if(!t)throw new Error("Could not parse function signature for injection dependencies: "+e+"");var n=t[2].replace(/\/\*[\S\s]*?\*\//g," ").replace(/\/\/.*/g," ");function a(i,u,l){return u+l.split(",").map(function(f){return f&&f.trim()}).filter(Boolean).join("@")}return n=n.replace(/(\{)([^}]*)\}/g,a),n=n.replace(/(\[)([^}]*)\]/g,a),n.split(",").map(function(i){return i&&i.trim()}).map(function(i){return i[0]==="{"?i.substring(1).split("@"):i[0]==="["?{items:i.substring(1).split("@")}:i}).filter(Boolean)}});var gt=y((Tc,an)=>{an.exports=Jo;function Jo(e,t){if(ht("noDeprecation"))return e;var n=!1;function a(){if(!n){if(ht("throwDeprecation"))throw new Error(t);ht("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}return a}function ht(e){try{if(!global.localStorage)return!1}catch{return!1}var t=global.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}});var We=y((xc,Xo)=>{Xo.exports={name:"faunadb",version:"4.4.1",apiVersion:"4",description:"FaunaDB Javascript driver for Node.JS and Browsers",homepage:"https://fauna.com",repository:"fauna/faunadb-js",license:"MPL-2.0",keywords:["database","fauna","official","driver"],bugs:{url:"https://github.com/fauna/faunadb-js/issues"},files:["index.d.ts","src/","dist/","tools/printReleaseNotes.js"],main:"index.js",scripts:{doc:"jsdoc -c ./jsdoc.json",browserify:"browserify index.js --standalone faunadb -o dist/faunadb.js","browserify-min":"browserify index.js --standalone faunadb | terser -c -m --keep-fnames --keep-classnames -o dist/faunadb-min.js",prettify:'prettier --write "{src,test}/**/*.{js,ts}"',test:"jest --env=node --verbose=false --forceExit ./test","semantic-release":"semantic-release",wp:"webpack",postinstall:"node ./tools/printReleaseNotes",postupdate:"node ./tools/printReleaseNotes","load-test":"node ./tools/loadTest"},types:"index.d.ts",dependencies:{"abort-controller":"^3.0.0","base64-js":"^1.2.0",boxen:"^5.0.1","btoa-lite":"^1.0.0",chalk:"^4.1.1","cross-fetch":"^3.0.6",dotenv:"^8.2.0","fn-annotate":"^1.1.3","object-assign":"^4.1.0","util-deprecate":"^1.0.2"},devDependencies:{browserify:"^16.2.2",eslint:"^5.3.0","eslint-config-prettier":"^6.5.0","eslint-plugin-prettier":"^3.1.1",husky:">=1","ink-docstrap":"^1.2.1",jest:"^24.9.0",jsdoc:"^3.6.3","lint-staged":">=8",prettier:"1.18.2","semantic-release":"^17.1.2",terser:"^4.3.9",webpack:"^5.23.0","webpack-cli":"^4.5.0",yargs:"^16.2.0"},husky:{hooks:{"pre-commit":"lint-staged"}},"lint-staged":{"*.{js,css,json,md}":["prettier --write","git add"],"*.js":["eslint --fix","git add"]},release:{branches:["main"]},browser:{http2:!1,http:!1,https:!1,os:!1,util:!1,boxen:!1,chalk:!1}}});var sn=y(()=>{});var on=y(()=>{});var ln=y((Y,cn)=>{var un=typeof self!="undefined"?self:Y,Ge=function(){function e(){this.fetch=!1,this.DOMException=un.DOMException}return e.prototype=un,new e}();(function(e){var t=function(n){var a={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function i(c){return c&&DataView.prototype.isPrototypeOf(c)}if(a.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(c){return c&&u.indexOf(Object.prototype.toString.call(c))>-1};function f(c){if(typeof c!="string"&&(c=String(c)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(c))throw new TypeError("Invalid character in header field name");return c.toLowerCase()}function m(c){return typeof c!="string"&&(c=String(c)),c}function h(c){var d={next:function(){var g=c.shift();return{done:g===void 0,value:g}}};return a.iterable&&(d[Symbol.iterator]=function(){return d}),d}function p(c){this.map={},c instanceof p?c.forEach(function(d,g){this.append(g,d)},this):Array.isArray(c)?c.forEach(function(d){this.append(d[0],d[1])},this):c&&Object.getOwnPropertyNames(c).forEach(function(d){this.append(d,c[d])},this)}p.prototype.append=function(c,d){c=f(c),d=m(d);var g=this.map[c];this.map[c]=g?g+", "+d:d},p.prototype.delete=function(c){delete this.map[f(c)]},p.prototype.get=function(c){return c=f(c),this.has(c)?this.map[c]:null},p.prototype.has=function(c){return this.map.hasOwnProperty(f(c))},p.prototype.set=function(c,d){this.map[f(c)]=m(d)},p.prototype.forEach=function(c,d){for(var g in this.map)this.map.hasOwnProperty(g)&&c.call(d,this.map[g],g,this)},p.prototype.keys=function(){var c=[];return this.forEach(function(d,g){c.push(g)}),h(c)},p.prototype.values=function(){var c=[];return this.forEach(function(d){c.push(d)}),h(c)},p.prototype.entries=function(){var c=[];return this.forEach(function(d,g){c.push([g,d])}),h(c)},a.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function A(c){if(c.bodyUsed)return Promise.reject(new TypeError("Already read"));c.bodyUsed=!0}function T(c){return new Promise(function(d,g){c.onload=function(){d(c.result)},c.onerror=function(){g(c.error)}})}function W(c){var d=new FileReader,g=T(d);return d.readAsArrayBuffer(c),g}function B(c){var d=new FileReader,g=T(d);return d.readAsText(c),g}function G(c){for(var d=new Uint8Array(c),g=new Array(d.length),O=0;O<d.length;O++)g[O]=String.fromCharCode(d[O]);return g.join("")}function te(c){if(c.slice)return c.slice(0);var d=new Uint8Array(c.byteLength);return d.set(new Uint8Array(c)),d.buffer}function J(){return this.bodyUsed=!1,this._initBody=function(c){this._bodyInit=c,c?typeof c=="string"?this._bodyText=c:a.blob&&Blob.prototype.isPrototypeOf(c)?this._bodyBlob=c:a.formData&&FormData.prototype.isPrototypeOf(c)?this._bodyFormData=c:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(c)?this._bodyText=c.toString():a.arrayBuffer&&a.blob&&i(c)?(this._bodyArrayBuffer=te(c.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(c)||l(c))?this._bodyArrayBuffer=te(c):this._bodyText=c=Object.prototype.toString.call(c):this._bodyText="",this.headers.get("content-type")||(typeof c=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(c)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var c=A(this);if(c)return c;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?A(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(W)}),this.text=function(){var c=A(this);if(c)return c;if(this._bodyBlob)return B(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(G(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(Ee)}),this.json=function(){return this.text().then(JSON.parse)},this}var D=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function X(c){var d=c.toUpperCase();return D.indexOf(d)>-1?d:c}function $(c,d){d=d||{};var g=d.body;if(c instanceof $){if(c.bodyUsed)throw new TypeError("Already read");this.url=c.url,this.credentials=c.credentials,d.headers||(this.headers=new p(c.headers)),this.method=c.method,this.mode=c.mode,this.signal=c.signal,!g&&c._bodyInit!=null&&(g=c._bodyInit,c.bodyUsed=!0)}else this.url=String(c);if(this.credentials=d.credentials||this.credentials||"same-origin",(d.headers||!this.headers)&&(this.headers=new p(d.headers)),this.method=X(d.method||this.method||"GET"),this.mode=d.mode||this.mode||null,this.signal=d.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&g)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(g)}$.prototype.clone=function(){return new $(this,{body:this._bodyInit})};function Ee(c){var d=new FormData;return c.trim().split("&").forEach(function(g){if(g){var O=g.split("="),C=O.shift().replace(/\+/g," "),w=O.join("=").replace(/\+/g," ");d.append(decodeURIComponent(C),decodeURIComponent(w))}}),d}function Ve(c){var d=new p,g=c.replace(/\r?\n[\t ]+/g," ");return g.split(/\r?\n/).forEach(function(O){var C=O.split(":"),w=C.shift().trim();if(w){var He=C.join(":").trim();d.append(w,He)}}),d}J.call($.prototype);function q(c,d){d||(d={}),this.type="default",this.status=d.status===void 0?200:d.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in d?d.statusText:"OK",this.headers=new p(d.headers),this.url=d.url||"",this._initBody(c)}J.call(q.prototype),q.prototype.clone=function(){return new q(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},q.error=function(){var c=new q(null,{status:0,statusText:""});return c.type="error",c};var dt=[301,302,303,307,308];q.redirect=function(c,d){if(dt.indexOf(d)===-1)throw new RangeError("Invalid status code");return new q(null,{status:d,headers:{location:c}})},n.DOMException=e.DOMException;try{new n.DOMException}catch{n.DOMException=function(d,g){this.message=d,this.name=g;var O=Error(d);this.stack=O.stack},n.DOMException.prototype=Object.create(Error.prototype),n.DOMException.prototype.constructor=n.DOMException}function fe(c,d){return new Promise(function(g,O){var C=new $(c,d);if(C.signal&&C.signal.aborted)return O(new n.DOMException("Aborted","AbortError"));var w=new XMLHttpRequest;function He(){w.abort()}w.onload=function(){var Ae={status:w.status,statusText:w.statusText,headers:Ve(w.getAllResponseHeaders()||"")};Ae.url="responseURL"in w?w.responseURL:Ae.headers.get("X-Request-URL");var mt="response"in w?w.response:w.responseText;g(new q(mt,Ae))},w.onerror=function(){O(new TypeError("Network request failed"))},w.ontimeout=function(){O(new TypeError("Network request failed"))},w.onabort=function(){O(new n.DOMException("Aborted","AbortError"))},w.open(C.method,C.url,!0),C.credentials==="include"?w.withCredentials=!0:C.credentials==="omit"&&(w.withCredentials=!1),"responseType"in w&&a.blob&&(w.responseType="blob"),C.headers.forEach(function(Ae,mt){w.setRequestHeader(mt,Ae)}),C.signal&&(C.signal.addEventListener("abort",He),w.onreadystatechange=function(){w.readyState===4&&C.signal.removeEventListener("abort",He)}),w.send(typeof C._bodyInit=="undefined"?null:C._bodyInit)})}return fe.polyfill=!0,e.fetch||(e.fetch=fe,e.Headers=p,e.Request=$,e.Response=q),n.Headers=p,n.Request=$,n.Response=q,n.fetch=fe,Object.defineProperty(n,"__esModule",{value:!0}),n}({})})(Ge);Ge.fetch.ponyfill=!0;delete Ge.fetch.polyfill;var de=Ge;Y=de.fetch;Y.default=de.fetch;Y.fetch=de.fetch;Y.Headers=de.Headers;Y.Request=de.Request;Y.Response=de.Response;cn.exports=Y});var P=y((Rc,gn)=>{"use strict";var Te=We(),yt=sn(),$o=on(),xe=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:self;function Yo(e,t){if(e==null)throw new TypeError('The constructor to "inherits" must not be null or undefined');if(t==null)throw new TypeError('The super constructor to "inherits" must not be null or undefined');if(t.prototype===void 0)throw new TypeError('The super constructor to "inherits" must have a prototype');e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function fn(){return typeof window=="undefined"&&typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null}function zo(e){var t=!!(typeof process!="undefined"&&process&&process.env);if(t&&process.env[e]!=null)return process.env[e]}function Ko(){var e=navigator.appName,t=""+parseFloat(navigator.appVersion),n,a,i;return(a=navigator.userAgent.indexOf("Opera"))!=-1?(e="Opera",t=navigator.userAgent.substring(a+6),(a=navigator.userAgent.indexOf("Version"))!=-1&&(t=navigator.userAgent.substring(a+8))):(a=navigator.userAgent.indexOf("MSIE"))!=-1?(e="Microsoft Internet Explorer",t=navigator.userAgent.substring(a+5)):e=="Netscape"&&navigator.userAgent.indexOf("Trident/")!=-1?(e="Microsoft Internet Explorer",t=navigator.userAgent.substring(a+5),(a=navigator.userAgent.indexOf("rv:"))!=-1&&(t=navigator.userAgent.substring(a+3))):(a=navigator.userAgent.indexOf("Chrome"))!=-1?(e="Chrome",t=navigator.userAgent.substring(a+7)):(a=navigator.userAgent.indexOf("Safari"))!=-1?(e="Safari",t=navigator.userAgent.substring(a+7),(a=navigator.userAgent.indexOf("Version"))!=-1&&(t=navigator.userAgent.substring(a+8)),navigator.userAgent.indexOf("CriOS")!=-1&&(e="Chrome")):(a=navigator.userAgent.indexOf("Firefox"))!=-1?(e="Firefox",t=navigator.userAgent.substring(a+8)):(n=navigator.userAgent.lastIndexOf(" ")+1)<(a=navigator.userAgent.lastIndexOf("/"))&&(e=navigator.userAgent.substring(n,a),t=navigator.userAgent.substring(a+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),(i=t.indexOf(";"))!=-1&&(t=t.substring(0,i)),(i=t.indexOf(" "))!=-1&&(t=t.substring(0,i)),(i=t.indexOf(")"))!=-1&&(t=t.substring(0,i)),[e,t].join("-")}function Qo(){var e="unknown",t=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Chrome OS",r:/CrOS/},{s:"Linux",r:/(Linux|X11(?!.*CrOS))/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var n in t){var a=t[n];if(a.r.test(navigator.userAgent)){e=a.s;break}}var i="unknown";switch(/Windows/.test(e)&&(i=/Windows (.*)/.exec(e)[1],e="Windows"),e){case"Mac OS":case"Mac OS X":case"Android":i=/(?:Android|Mac OS|Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh) ([\.\_\d]+)/.exec(navigator.userAgent)[1];break;case"iOS":i=/OS (\d+)_(\d+)_?(\d+)?/.exec(navigator.appVersion),i=i[1]+"."+i[2]+"."+(i[3]|0);break}return[e,i].join("-")}function Zo(){var e=[{name:"Netlify",check:function(){return process.env.hasOwnProperty("NETLIFY_IMAGES_CDN_DOMAIN")}},{name:"Vercel",check:function(){return process.env.hasOwnProperty("VERCEL")}},{name:"Heroku",check:function(){return process.env.hasOwnProperty("PATH")&&process.env.PATH.indexOf(".heroku")!==-1}},{name:"AWS Lambda",check:function(){return process.env.hasOwnProperty("AWS_LAMBDA_FUNCTION_VERSION")}},{name:"GCP Cloud Functions",check:function(){return process.env.hasOwnProperty("_")&&process.env._.indexOf("google")!==-1}},{name:"GCP Compute Instances",check:function(){return process.env.hasOwnProperty("GOOGLE_CLOUD_PROJECT")}},{name:"Azure Cloud Functions",check:function(){return process.env.hasOwnProperty("WEBSITE_FUNCTIONS_AZUREMONITOR_CATEGORIES")}},{name:"Azure Compute",check:function(){return process.env.hasOwnProperty("ORYX_ENV_TYPE")&&process.env.hasOwnProperty("WEBSITE_INSTANCE_ID")&&process.env.ORYX_ENV_TYPE==="AppService"}},{name:"Mongo Stitch",check:function(){return typeof xe.StitchError=="function"}},{name:"Render",check:function(){return process.env.hasOwnProperty("RENDER_SERVICE_ID")}},{name:"Begin",check:function(){return process.env.hasOwnProperty("BEGIN_DATA_SCOPE_ID")}}],t=e.find(n=>n.check());return t?t.name:"unknown"}function eu(e,t){return e===void 0?t:e}function tu(e,t){var n={};for(var a in e){if(!(a in t))throw new Error("No such option "+a);n[a]=e[a]}for(var i in t)i in n||(n[i]=t[i]);return n}function nu(e){var t={};for(var n in e){var a=e[n];a!=null&&(t[n]=a)}return t}function ru(e){var t={};for(var n in e){var a=e[n];a!==void 0&&(t[n]=a)}return t}function dn(e,t){return typeof e=="object"&&e!==null&&Boolean(e[t])}function au(e,t,n){return n=typeof n=="object"?mn(n):n,[e,t?t.charAt(0)==="/"?"":"/"+t:"",n?n.charAt(0)==="?"?"":"?"+n:""].join("")}function mn(e,t){t=t||"";var n=[],a,i;typeof t!="string"&&(t="?");for(i in e)if(dn(e,i)){if(a=e[i],!a&&(a==null||isNaN(a))&&(a=""),i=pn(i),a=pn(a),i===null||a===null)continue;n.push(i+"="+a)}return n.length?t+n.join("&"):""}function pn(e){try{return encodeURIComponent(e)}catch{return null}}function iu(e,t){var n={};for(var a in e)n[a]=e[a];for(var a in t)n[a]=t[a];return n}function hn(e){return typeof e=="function"?e:typeof xe.fetch=="function"?xe.fetch.bind(xe):ln()}function su(){var e;return n=>{if(!fn()||e||!n)return;function a(i){var u=i>Te.version;u&&console.info($o("New "+Te.name+" version available "+yt.dim(Te.version)+yt.reset(" \u2192 ")+yt.green(i)+`
Changelog: https://github.com/${Te.repository}/blob/main/CHANGELOG.md`,{padding:1,borderColor:"yellow"}))}e=!0,hn()("https://registry.npmjs.org/"+Te.name).then(i=>i.json()).then(i=>a(i["dist-tags"].latest)).catch(i=>{console.error("Unable to check new driver version"),console.error(i)})}}gn.exports={notifyAboutNewVersion:su,crossGlobal:xe,mergeObjects:iu,formatUrl:au,querystringify:mn,inherits:Yo,isNodeEnv:fn,getEnvVariable:zo,defaults:eu,applyDefaults:tu,removeNullAndUndefinedValues:nu,removeUndefinedValues:ru,checkInstanceHasProperty:dn,getBrowserDetails:Ko,getBrowserOsDetails:Qo,getNodeRuntimeEnv:Zo,resolveFetch:hn}});var Xe=y((Nc,wn)=>{"use strict";var ou=P();function me(e){this.raw=e}me.prototype._isFaunaExpr=!0;me.prototype.toJSON=function(){return this.raw};me.prototype.toFQL=function(){return b(this.raw)};var uu=["Do","Call","Union","Intersection","Difference","Equals","Add","BitAnd","BitOr","BitXor","Divide","Max","Min","Modulo","Multiply","Subtract","LT","LTE","GT","GTE","And","Or"],yn={containsstrregex:"ContainsStrRegex",endswith:"EndsWith",findstr:"FindStr",findstrregex:"FindStrRegex",gt:"GT",gte:"GTE",is_nonempty:"is_non_empty",lowercase:"LowerCase",lt:"LT",lte:"LTE",ltrim:"LTrim",ngram:"NGram",rtrim:"RTrim",regexescape:"RegexEscape",replacestr:"ReplaceStr",replacestrregex:"ReplaceStrRegex",startswith:"StartsWith",substring:"SubString",titlecase:"TitleCase",uppercase:"UpperCase"};function vn(e){return e instanceof me||ou.checkInstanceHasProperty(e,"_isFaunaExpr")}function Je(e){return"{"+Object.keys(e).map(function(t){return'"'+t+'": '+b(e[t])}).join(", ")+"}"}function vt(e,t){return e.map(function(n){return t(n)}).join(", ")}function cu(e){return e in yn&&(e=yn[e]),e.split("_").map(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}).join("")}var b=function(e,t){if(vn(e)){if("value"in e)return e.toString();e=e.raw}if(e===null)return"null";switch(typeof e){case"string":return JSON.stringify(e);case"symbol":case"number":case"boolean":return e.toString();case"undefined":return"undefined"}if(Array.isArray(e)){var n=vt(e,b);return uu.indexOf(t)!=-1?n:"["+n+"]"}if("match"in e){var a=b(e.match),i=e.terms||[];return vn(i)&&(i=i.raw),Array.isArray(i)&&i.length==0?"Match("+a+")":Array.isArray(i)?"Match("+a+", ["+vt(i,b)+"])":"Match("+a+", "+b(i)+")"}if("paginate"in e){var u=Object.keys(e);if(u.length===1)return"Paginate("+b(e.paginate)+")";var l=Object.assign({},e);return delete l.paginate,"Paginate("+b(e.paginate)+", "+Je(l)+")"}if("let"in e&&"in"in e){var f="";return Array.isArray(e.let)?f="["+vt(e.let,Je)+"]":f=Je(e.let),"Let("+f+", "+b(e.in)+")"}if("object"in e)return Je(e.object);if("merge"in e)return e.lambda?"Merge("+b(e.merge)+", "+b(e.with)+", "+b(e.lambda)+")":"Merge("+b(e.merge)+", "+b(e.with)+")";if("lambda"in e)return"Lambda("+b(e.lambda)+", "+b(e.expr)+")";if("filter"in e)return"Filter("+b(e.collection)+", "+b(e.filter)+")";if("call"in e)return"Call("+b(e.call)+", "+b(e.arguments)+")";if("map"in e)return"Map("+b(e.collection)+", "+b(e.map)+")";if("foreach"in e)return"Foreach("+b(e.collection)+", "+b(e.foreach)+")";var m=Object.keys(e),h=m[0];h=cu(h);var p=m.filter(A=>e[A]!==null||m.length>1).map(A=>b(e[A],h)).join(", ");return h+"("+p+")"};me.toString=b;wn.exports=me});var ne=y((Dc,xn)=>{"use strict";var I=P();function N(e,t,n){Error.call(this),this.name=e,this.message=t,this.description=n}I.inherits(N,Error);function bn(e){N.call(this,"InvalidValue",e)}I.inherits(bn,N);function En(e,t,n,a){var i=`${a} function requires ${l(e,t)} argument(s) but ${n} were given`,u=f(a);N.call(this,"InvalidArity",`${i}
${u}`),this.min=e,this.max=t,this.actual=n;function l(m,h){return h===null?"at least "+m:m===null?"up to "+h:m===h?m:"from "+m+" to "+h}function f(m){var h="https://docs.fauna.com/fauna/current/api/fql/functions/";return`For more info, see the docs: ${h}${m.toLowerCase()}`}}I.inherits(En,N);function x(e,t){var n=t.responseContent,a=n.errors,i=a.length===0?'(empty "errors")':a[0].code,u=a.length===0?'(empty "errors")':a[0].description;N.call(this,e,i,u),this.requestResult=t}I.inherits(x,N);x.prototype.errors=function(){return this.requestResult.responseContent.errors};x.raiseForStatusCode=function(e){var t=e.statusCode;if(t<200||t>=300)switch(t){case 400:throw new wt(e);case 401:throw new bt(e);case 403:throw new Et(e);case 404:throw new At(e);case 405:throw new _t(e);case 429:throw new Tt(e);case 500:throw new xt(e);case 503:throw new St(e);default:throw new x("UnknownError",e)}};function wt(e){x.call(this,"BadRequest",e)}I.inherits(wt,x);function bt(e){x.call(this,"Unauthorized",e)}I.inherits(bt,x);function Et(e){x.call(this,"PermissionDenied",e)}I.inherits(Et,x);function At(e){x.call(this,"NotFound",e)}I.inherits(At,x);function _t(e){x.call(this,"MethodNotAllowed",e)}I.inherits(_t,x);function Tt(e){x.call(this,"TooManyRequests",e)}I.inherits(Tt,x);function xt(e){x.call(this,"InternalError",e)}I.inherits(xt,x);function St(e){x.call(this,"UnavailableError",e)}I.inherits(St,x);function $e(e,t,n){N.call(this,e,t,n)}I.inherits($e,N);function An(e){N.call(this,"StreamsNotSupported","streams not supported",e)}I.inherits(An,$e);function _n(e){var t=e.data||{};N.call(this,"StreamErrorEvent",t.code,t.description),this.event=e}I.inherits(_n,$e);function Tn(e,t){N.call(this,"ClientClosed",e,t)}I.inherits(Tn,N);xn.exports={FaunaError:N,ClientClosed:Tn,FaunaHTTPError:x,InvalidValue:bn,InvalidArity:En,BadRequest:wt,Unauthorized:bt,PermissionDenied:Et,NotFound:At,MethodNotAllowed:_t,TooManyRequests:Tt,InternalError:xt,UnavailableError:St,StreamError:$e,StreamsNotSupported:An,StreamErrorEvent:_n}});var On=y(Ye=>{"use strict";Ye.byteLength=fu;Ye.toByteArray=mu;Ye.fromByteArray=gu;var U=[],L=[],lu=typeof Uint8Array!="undefined"?Uint8Array:Array,Ct="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(se=0,Sn=Ct.length;se<Sn;++se)U[se]=Ct[se],L[Ct.charCodeAt(se)]=se;var se,Sn;L["-".charCodeAt(0)]=62;L["_".charCodeAt(0)]=63;function Cn(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var a=n===t?0:4-n%4;return[n,a]}function fu(e){var t=Cn(e),n=t[0],a=t[1];return(n+a)*3/4-a}function du(e,t,n){return(t+n)*3/4-n}function mu(e){var t,n=Cn(e),a=n[0],i=n[1],u=new lu(du(e,a,i)),l=0,f=i>0?a-4:a,m;for(m=0;m<f;m+=4)t=L[e.charCodeAt(m)]<<18|L[e.charCodeAt(m+1)]<<12|L[e.charCodeAt(m+2)]<<6|L[e.charCodeAt(m+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=t&255;return i===2&&(t=L[e.charCodeAt(m)]<<2|L[e.charCodeAt(m+1)]>>4,u[l++]=t&255),i===1&&(t=L[e.charCodeAt(m)]<<10|L[e.charCodeAt(m+1)]<<4|L[e.charCodeAt(m+2)]>>2,u[l++]=t>>8&255,u[l++]=t&255),u}function pu(e){return U[e>>18&63]+U[e>>12&63]+U[e>>6&63]+U[e&63]}function hu(e,t,n){for(var a,i=[],u=t;u<n;u+=3)a=(e[u]<<16&16711680)+(e[u+1]<<8&65280)+(e[u+2]&255),i.push(pu(a));return i.join("")}function gu(e){for(var t,n=e.length,a=n%3,i=[],u=16383,l=0,f=n-a;l<f;l+=u)i.push(hu(e,l,l+u>f?f:l+u));return a===1?(t=e[n-1],i.push(U[t>>2]+U[t<<4&63]+"==")):a===2&&(t=(e[n-2]<<8)+e[n-1],i.push(U[t>>10]+U[t>>4&63]+U[t<<2&63]+"=")),i.join("")}});var In=y(()=>{});var Oe=y((Lc,Nn)=>{"use strict";var Ot=On(),yu=gt(),It=ne(),Rt=Xe(),z=P(),ze=z.isNodeEnv()?In():null,Rn=ze&&ze.inspect.custom,vu=ze?ze.inspect:JSON.stringify;function K(){}K.prototype._isFaunaValue=!0;z.inherits(K,Rt);function S(e,t,n){if(!e)throw new It.InvalidValue("id cannot be null or undefined");this.value={id:e},t&&(this.value.collection=t),n&&(this.value.database=n)}S.prototype._isFaunaRef=!0;z.inherits(S,K);Object.defineProperty(S.prototype,"collection",{get:function(){return this.value.collection}});Object.defineProperty(S.prototype,"class",{get:yu(function(){return this.value.collection},"class is deprecated, use collection instead")});Object.defineProperty(S.prototype,"database",{get:function(){return this.value.database}});Object.defineProperty(S.prototype,"id",{get:function(){return this.value.id}});S.prototype.toJSON=function(){return{"@ref":this.value}};pe(S,function(){var e={collections:"Collection",databases:"Database",indexes:"Index",functions:"Function",roles:"Role",access_providers:"AccessProvider"},t=function(a){return a.collection===void 0},n=function(a){if(t(a)){var i=a.database!==void 0?a.database.toString():"";return a.id==="access_providers"?"AccessProviders("+i+")":a.id.charAt(0).toUpperCase()+a.id.slice(1)+"("+i+")"}if(t(a.collection)){var u=e[a.collection.id];if(u!==void 0){var i=a.database!==void 0?", "+a.database.toString():"";return u+'("'+a.id+'"'+i+")"}}return"Ref("+n(a.collection)+', "'+a.id+'")'};return n(this)});S.prototype.valueOf=function(){return this.value};S.prototype.equals=function(e){return(e instanceof S||z.checkInstanceHasProperty(e,"_isFaunaRef"))&&this.id===e.id&&(this.collection===void 0&&e.collection===void 0||this.collection.equals(e.collection))&&(this.database===void 0&&e.database===void 0||this.database.equals(e.database))};var Q={COLLECTIONS:new S("collections"),INDEXES:new S("indexes"),DATABASES:new S("databases"),FUNCTIONS:new S("functions"),ROLES:new S("roles"),KEYS:new S("keys"),ACCESS_PROVIDERS:new S("access_providers")};Q.fromName=function(e){switch(e){case"collections":return Q.COLLECTIONS;case"indexes":return Q.INDEXES;case"databases":return Q.DATABASES;case"functions":return Q.FUNCTIONS;case"roles":return Q.ROLES;case"keys":return Q.KEYS;case"access_providers":return Q.ACCESS_PROVIDERS}return new S(e)};function Ke(e){this.value=e}z.inherits(Ke,K);pe(Ke,function(){return Rt.toString(this.value)});Ke.prototype.toJSON=function(){return{"@set":this.value}};function Se(e){if(e instanceof Date)e=e.toISOString();else if(e.charAt(e.length-1)!=="Z")throw new It.InvalidValue("Only allowed timezone is 'Z', got: "+e);this.value=e}z.inherits(Se,K);Object.defineProperty(Se.prototype,"date",{get:function(){return new Date(this.value)}});pe(Se,function(){return'Time("'+this.value+'")'});Se.prototype.toJSON=function(){return{"@ts":this.value}};function Ce(e){e instanceof Date&&(e=e.toISOString().slice(0,10)),this.value=e}z.inherits(Ce,K);Object.defineProperty(Ce.prototype,"date",{get:function(){return new Date(this.value)}});pe(Ce,function(){return'Date("'+this.value+'")'});Ce.prototype.toJSON=function(){return{"@date":this.value}};function Qe(e){if(e instanceof ArrayBuffer)this.value=new Uint8Array(e);else if(typeof e=="string")this.value=Ot.toByteArray(e);else if(e instanceof Uint8Array)this.value=e;else throw new It.InvalidValue("Bytes type expect argument to be either Uint8Array|ArrayBuffer|string, got: "+vu(e))}z.inherits(Qe,K);pe(Qe,function(){return'Bytes("'+Ot.fromByteArray(this.value)+'")'});Qe.prototype.toJSON=function(){return{"@bytes":Ot.fromByteArray(this.value)}};function Ze(e){this.value=e}z.inherits(Ze,K);pe(Ze,function(){return"Query("+Rt.toString(this.value)+")"});Ze.prototype.toJSON=function(){return{"@query":this.value}};function pe(e,t){e.prototype.toString=t,e.prototype.inspect=t,Rn&&(e.prototype[Rn]=t)}Nn.exports={Value:K,Ref:S,Native:Q,SetRef:Ke,FaunaTime:Se,FaunaDate:Ce,Bytes:Qe,Query:Ze}});var Nt=y((Fc,Pn)=>{"use strict";var Dn=Object.getOwnPropertySymbols,wu=Object.prototype.hasOwnProperty,bu=Object.prototype.propertyIsEnumerable;function Eu(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function Au(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var a=Object.getOwnPropertyNames(t).map(function(u){return t[u]});if(a.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(u){i[u]=u}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}Pn.exports=Au()?Object.assign:function(e,t){for(var n,a=Eu(e),i,u=1;u<arguments.length;u++){n=Object(arguments[u]);for(var l in n)wu.call(n,l)&&(a[l]=n[l]);if(Dn){i=Dn(n);for(var f=0;f<i.length;f++)bu.call(n,i[f])&&(a[i[f]]=n[i[f]])}}return a}});var Ie=y((Bc,_s)=>{"use strict";var _u=rn(),re=gt(),s=Xe(),Dt=ne(),jn=Oe(),Tu=Nt(),v=P();function qn(){switch(o.between(1,2,arguments,qn.name),arguments.length){case 1:return new s({"@ref":r(arguments[0])});case 2:return new s({ref:r(arguments[0]),id:r(arguments[1])})}}function Ln(e){return o.exact(1,arguments,Ln.name),new jn.Bytes(e)}function Fn(e){return o.exact(1,arguments,Fn.name),new s({abort:r(e)})}function Bn(e,t){return o.exact(2,arguments,Bn.name),new s({at:r(e),expr:r(t)})}function kn(e,t){o.exact(2,arguments,kn.name);var n=[];if(Array.isArray(e)?n=e.map(function(i){return tt(i)}):n=Object.keys(e).filter(function(i){return e[i]!==void 0}).map(function(i){var u={};return u[i]=r(e[i]),u}),typeof t=="function")if(Array.isArray(e)){var a=[];e.forEach(function(i){Object.keys(i).forEach(function(u){a.push(he(u))})}),t=t.apply(null,a)}else t=t.apply(null,Object.keys(e).map(function(i){return he(i)}));return new s({let:n,in:r(t)})}function he(e){return o.exact(1,arguments,he.name),new s({var:r(e)})}function Mn(e,t,n){return o.exact(3,arguments,Mn.name),new s({if:r(e),then:r(t),else:r(n)})}function Un(){o.min(1,arguments,Un.name);var e=et(arguments);return new s({do:r(e)})}var Vn=function(e){return o.exact(1,arguments,Vn.name),new s({object:tt(e)})};function Pt(){switch(o.between(1,2,arguments,Pt.name),arguments.length){case 1:var e=arguments[0];if(typeof e=="function")return xu(e);if(e instanceof s||v.checkInstanceHasProperty(e,"_isFaunaExpr"))return e;throw new Dt.InvalidValue("Lambda function takes either a Function or an Expr.");case 2:var t=arguments[0],n=arguments[1];return jt(t,n)}}function xu(e){var t=_u(e);switch(t.length){case 0:throw new Dt.InvalidValue("Provided Function must take at least 1 argument.");case 1:return jt(t[0],e(he(t[0])));default:return jt(t,e.apply(null,t.map(function(n){return he(n)})))}}function jt(e,t){return new s({lambda:r(e),expr:r(t)})}function Hn(e){o.min(1,arguments,Hn.name);var t=et(arguments);return t.shift(),new s({call:r(e),arguments:r(_(t))})}function Wn(e){return o.exact(1,arguments,Wn.name),new s({query:r(e)})}function Gn(e,t){return o.exact(2,arguments,Gn.name),new s({map:r(t),collection:r(e)})}function Jn(e,t){return o.exact(2,arguments,Jn.name),new s({foreach:r(t),collection:r(e)})}function Xn(e,t){return o.exact(2,arguments,Xn.name),new s({filter:r(t),collection:r(e)})}function $n(e,t){return o.exact(2,arguments,$n.name),new s({take:r(e),collection:r(t)})}function Yn(e,t){return o.exact(2,arguments,Yn.name),new s({drop:r(e),collection:r(t)})}function zn(e,t){return o.exact(2,arguments,zn.name),new s({prepend:r(e),collection:r(t)})}function Kn(e,t){return o.exact(2,arguments,Kn.name),new s({append:r(e),collection:r(t)})}function Qn(e){return o.exact(1,arguments,Qn.name),new s({is_empty:r(e)})}function Zn(e){return o.exact(1,arguments,Zn.name),new s({is_nonempty:r(e)})}function er(e){return o.exact(1,arguments,er.name),new s({is_number:r(e)})}function tr(e){return o.exact(1,arguments,tr.name),new s({is_double:r(e)})}function nr(e){return o.exact(1,arguments,nr.name),new s({is_integer:r(e)})}function rr(e){return o.exact(1,arguments,rr.name),new s({is_boolean:r(e)})}function ar(e){return o.exact(1,arguments,ar.name),new s({is_null:r(e)})}function ir(e){return o.exact(1,arguments,ir.name),new s({is_bytes:r(e)})}function sr(e){return o.exact(1,arguments,sr.name),new s({is_timestamp:r(e)})}function or(e){return o.exact(1,arguments,or.name),new s({is_date:r(e)})}function ur(e){return o.exact(1,arguments,ur.name),new s({is_string:r(e)})}function cr(e){return o.exact(1,arguments,cr.name),new s({is_array:r(e)})}function lr(e){return o.exact(1,arguments,lr.name),new s({is_object:r(e)})}function fr(e){return o.exact(1,arguments,fr.name),new s({is_ref:r(e)})}function dr(e){return o.exact(1,arguments,dr.name),new s({is_set:r(e)})}function mr(e){return o.exact(1,arguments,mr.name),new s({is_doc:r(e)})}function pr(e){return o.exact(1,arguments,pr.name),new s({is_lambda:r(e)})}function hr(e){return o.exact(1,arguments,hr.name),new s({is_collection:r(e)})}function gr(e){return o.exact(1,arguments,gr.name),new s({is_database:r(e)})}function yr(e){return o.exact(1,arguments,yr.name),new s({is_index:r(e)})}function vr(e){return o.exact(1,arguments,vr.name),new s({is_function:r(e)})}function wr(e){return o.exact(1,arguments,wr.name),new s({is_key:r(e)})}function br(e){return o.exact(1,arguments,br.name),new s({is_token:r(e)})}function Er(e){return o.exact(1,arguments,Er.name),new s({is_credentials:r(e)})}function Ar(e){return o.exact(1,arguments,Ar.name),new s({is_role:r(e)})}function _r(e,t){return o.between(1,2,arguments,_r.name),t=v.defaults(t,null),new s(R({get:r(e)},{ts:r(t)}))}function Tr(e){return o.exact(1,arguments,Tr.name),new s({key_from_secret:r(e)})}function xr(e,t,n){return o.exact(3,arguments,xr.name),new s({reduce:r(e),initial:r(t),collection:r(n)})}function Sr(e,t){return o.between(1,2,arguments,Sr.name),t=v.defaults(t,{}),new s(Tu({paginate:r(e)},tt(t)))}function Cr(e,t){return o.between(1,2,arguments,Cr.name),t=v.defaults(t,null),new s(R({exists:r(e)},{ts:r(t)}))}function Or(e,t){return o.between(1,2,arguments,Or.name),new s({create:r(e),params:r(t)})}function Ir(e,t){return o.exact(2,arguments,Ir.name),new s({update:r(e),params:r(t)})}function Rr(e,t){return o.exact(2,arguments,Rr.name),new s({replace:r(e),params:r(t)})}function Nr(e){return o.exact(1,arguments,Nr.name),new s({delete:r(e)})}function Dr(e,t,n,a){return o.exact(4,arguments,Dr.name),new s({insert:r(e),ts:r(t),action:r(n),params:r(a)})}function Pr(e,t,n){return o.exact(3,arguments,Pr.name),new s({remove:r(e),ts:r(t),action:r(n)})}function jr(e){return o.exact(1,arguments,jr.name),new s({create_class:r(e)})}function qr(e){return o.exact(1,arguments,qr.name),new s({create_collection:r(e)})}function Lr(e){return o.exact(1,arguments,Lr.name),new s({create_database:r(e)})}function Fr(e){return o.exact(1,arguments,Fr.name),new s({create_index:r(e)})}function Br(e){return o.exact(1,arguments,Br.name),new s({create_key:r(e)})}function kr(e){return o.exact(1,arguments,kr.name),new s({create_function:r(e)})}function Mr(e){return o.exact(1,arguments,Mr.name),new s({create_role:r(e)})}function Ur(e){return o.exact(1,arguments,Ur.name),new s({create_access_provider:r(e)})}function Vr(e){return o.exact(1,arguments,Vr.name),new s({singleton:r(e)})}function Hr(e){return o.exact(1,arguments,Hr.name),new s({events:r(e)})}function Wr(e){o.min(1,arguments,Wr.name);var t=et(arguments);return t.shift(),new s({match:r(e),terms:r(_(t))})}function Gr(){return o.min(1,arguments,Gr.name),new s({union:r(_(arguments))})}function Jr(e,t,n){return o.between(2,3,arguments,Jr.name),new s(R({merge:r(e),with:r(t)},{lambda:r(n)}))}function Xr(){return o.min(1,arguments,Xr.name),new s({intersection:r(_(arguments))})}function $r(){return o.min(1,arguments,$r.name),new s({difference:r(_(arguments))})}function Yr(e){return o.exact(1,arguments,Yr.name),new s({distinct:r(e)})}function zr(e,t){return o.exact(2,arguments,zr.name),new s({join:r(e),with:r(t)})}function Kr(e,t,n){return o.exact(3,arguments,Kr.name),new s({range:r(e),from:r(t),to:r(n)})}function Qr(e,t){return o.exact(2,arguments,Qr.name),new s({login:r(e),params:r(t)})}function Zr(e){return o.exact(1,arguments,Zr.name),new s({logout:r(e)})}function ea(e,t){return o.exact(2,arguments,ea.name),new s({identify:r(e),password:r(t)})}function ta(){return o.exact(0,arguments,ta.name),new s({identity:null})}function na(){return o.exact(0,arguments,na.name),new s({current_identity:null})}function ra(){return o.exact(0,arguments,ra.name),new s({has_identity:null})}function aa(){return o.exact(0,arguments,aa.name),new s({has_current_identity:null})}function ia(){return o.exact(0,arguments,ia.name),new s({current_token:null})}function sa(){return o.exact(0,arguments,sa.name),new s({has_current_token:null})}function oa(e,t){return o.min(1,arguments,oa.name),t=v.defaults(t,null),new s(R({concat:r(e)},{separator:r(t)}))}function ua(e,t){return o.min(1,arguments,ua.name),new s(R({casefold:r(e)},{normalizer:r(t)}))}function ca(e,t){return o.exact(2,arguments,ca.name),new s({containsstr:r(e),search:r(t)})}function la(e,t){return o.exact(2,arguments,la.name),new s({containsstrregex:r(e),pattern:r(t)})}function fa(e,t){return o.exact(2,arguments,fa.name),new s({startswith:r(e),search:r(t)})}function da(e,t){return o.exact(2,arguments,da.name),new s({endswith:r(e),search:r(t)})}function ma(e){return o.exact(1,arguments,ma.name),new s({regexescape:r(e)})}function pa(e,t,n){return o.between(2,3,arguments,pa.name),n=v.defaults(n,null),new s(R({findstr:r(e),find:r(t)},{start:r(n)}))}function ha(e,t,n,a){return o.between(2,4,arguments,ha.name),n=v.defaults(n,null),new s(R({findstrregex:r(e),pattern:r(t)},{start:r(n),num_results:r(a)}))}function ga(e){return o.exact(1,arguments,ga.name),new s({length:r(e)})}function ya(e){return o.exact(1,arguments,ya.name),new s({lowercase:r(e)})}function va(e){return o.exact(1,arguments,va.name),new s({ltrim:r(e)})}function wa(e,t,n){return o.between(1,3,arguments,wa.name),t=v.defaults(t,null),n=v.defaults(n,null),new s(R({ngram:r(e)},{min:r(t),max:r(n)}))}function ba(e,t){return o.between(1,2,arguments,ba.name),t=v.defaults(t,null),new s(R({repeat:r(e)},{number:r(t)}))}function Ea(e,t,n){return o.exact(3,arguments,Ea.name),new s({replacestr:r(e),find:r(t),replace:r(n)})}function Aa(e,t,n,a){return o.between(3,4,arguments,Aa.name),a=v.defaults(a,null),new s(R({replacestrregex:r(e),pattern:r(t),replace:r(n)},{first:r(a)}))}function _a(e){return o.exact(1,arguments,_a.name),new s({rtrim:r(e)})}function Ta(e){return o.exact(1,arguments,Ta.name),new s({space:r(e)})}function xa(e,t,n){return o.between(1,3,arguments,xa.name),t=v.defaults(t,null),n=v.defaults(n,null),new s(R({substring:r(e)},{start:r(t),length:r(n)}))}function Sa(e){return o.exact(1,arguments,Sa.name),new s({titlecase:r(e)})}function Ca(e){return o.exact(1,arguments,Ca.name),new s({trim:r(e)})}function Oa(e){return o.exact(1,arguments,Oa.name),new s({uppercase:r(e)})}function Ia(e){o.min(1,arguments,Ia.name);var t=et(arguments);return t.shift(),new s({format:r(e),values:r(_(t))})}function Ra(e){return o.exact(1,arguments,Ra.name),new s({time:r(e)})}function Na(e,t){return o.exact(2,arguments,Na.name),new s({epoch:r(e),unit:r(t)})}function Da(e,t,n){return o.exact(3,arguments,Da.name),new s({time_add:r(e),offset:r(t),unit:r(n)})}function Pa(e,t,n){return o.exact(3,arguments,Pa.name),new s({time_subtract:r(e),offset:r(t),unit:r(n)})}function ja(e,t,n){return o.exact(3,arguments,ja.name),new s({time_diff:r(e),other:r(t),unit:r(n)})}function qa(e){return o.exact(1,arguments,qa.name),new s({date:r(e)})}function La(){return o.exact(0,arguments,La.name),new s({now:r(null)})}function Fa(){return o.exact(0,arguments,Fa.name),new s({next_id:null})}function Ba(){return o.exact(0,arguments,Ba.name),new s({new_id:null})}function ka(e,t){switch(o.between(1,2,arguments,ka.name),arguments.length){case 1:return new s({database:r(e)});case 2:return new s({database:r(e),scope:r(t)})}}function Ma(e,t){switch(o.between(1,2,arguments,Ma.name),arguments.length){case 1:return new s({index:r(e)});case 2:return new s({index:r(e),scope:r(t)})}}function Ua(e,t){switch(o.between(1,2,arguments,Ua.name),arguments.length){case 1:return new s({class:r(e)});case 2:return new s({class:r(e),scope:r(t)})}}function Va(e,t){switch(o.between(1,2,arguments,Va.name),arguments.length){case 1:return new s({collection:r(e)});case 2:return new s({collection:r(e),scope:r(t)})}}function Ha(e,t){switch(o.between(1,2,arguments,Ha.name),arguments.length){case 1:return new s({function:r(e)});case 2:return new s({function:r(e),scope:r(t)})}}function Wa(e,t){return o.between(1,2,arguments,Wa.name),t=v.defaults(t,null),new s(R({role:r(e)},{scope:r(t)}))}function Ga(e){return o.max(1,arguments,Ga.name),e=v.defaults(e,null),new s({access_providers:r(e)})}function Ja(e){return o.max(1,arguments,Ja.name),e=v.defaults(e,null),new s({classes:r(e)})}function Xa(e){return o.max(1,arguments,Xa.name),e=v.defaults(e,null),new s({collections:r(e)})}function $a(e){return o.max(1,arguments,$a.name),e=v.defaults(e,null),new s({databases:r(e)})}function Ya(e){return o.max(1,arguments,Ya.name),e=v.defaults(e,null),new s({indexes:r(e)})}function za(e){return o.max(1,arguments,za.name),e=v.defaults(e,null),new s({functions:r(e)})}function Ka(e){return o.max(1,arguments,Ka.name),e=v.defaults(e,null),new s({roles:r(e)})}function Qa(e){return o.max(1,arguments,Qa.name),e=v.defaults(e,null),new s({keys:r(e)})}function Za(e){return o.max(1,arguments,Za.name),e=v.defaults(e,null),new s({tokens:r(e)})}function ei(e){return o.max(1,arguments,ei.name),e=v.defaults(e,null),new s({credentials:r(e)})}function ti(){return o.min(1,arguments,ti.name),new s({equals:r(_(arguments))})}function ni(e,t){return o.exact(2,arguments,ni.name),new s({contains:r(e),in:r(t)})}function ri(e,t){return o.exact(2,arguments,ri.name),new s({contains_value:r(e),in:r(t)})}function ai(e,t){return o.exact(2,arguments,ai.name),new s({contains_field:r(e),in:r(t)})}function ii(e,t){return o.exact(2,arguments,ii.name),new s({contains_path:r(e),in:r(t)})}function si(e,t,n){o.between(2,3,arguments,si.name);var a={select:r(e),from:r(t)};return n!==void 0&&(a.default=r(n)),new s(a)}function oi(e,t){return o.exact(2,arguments,oi.name),new s({select_all:r(e),from:r(t)})}function ui(e){return o.exact(1,arguments,ui.name),new s({abs:r(e)})}function ci(){return o.min(1,arguments,ci.name),new s({add:r(_(arguments))})}function li(){return o.min(1,arguments,li.name),new s({bitand:r(_(arguments))})}function fi(e){return o.exact(1,arguments,fi.name),new s({bitnot:r(e)})}function di(){return o.min(1,arguments,di.name),new s({bitor:r(_(arguments))})}function mi(){return o.min(1,arguments,mi.name),new s({bitxor:r(_(arguments))})}function pi(e){return o.exact(1,arguments,pi.name),new s({ceil:r(e)})}function hi(){return o.min(1,arguments,hi.name),new s({divide:r(_(arguments))})}function gi(e){return o.exact(1,arguments,gi.name),new s({floor:r(e)})}function yi(){return o.min(1,arguments,yi.name),new s({max:r(_(arguments))})}function vi(){return o.min(1,arguments,vi.name),new s({min:r(_(arguments))})}function wi(){return o.min(1,arguments,wi.name),new s({modulo:r(_(arguments))})}function bi(){return o.min(1,arguments,bi.name),new s({multiply:r(_(arguments))})}function Ei(e,t){return o.min(1,arguments,Ei.name),t=v.defaults(t,null),new s(R({round:r(e)},{precision:r(t)}))}function Ai(){return o.min(1,arguments,Ai.name),new s({subtract:r(_(arguments))})}function _i(e){return o.exact(1,arguments,_i.name),new s({sign:r(e)})}function Ti(e){return o.exact(1,arguments,Ti.name),new s({sqrt:r(e)})}function xi(e,t){return o.min(1,arguments,xi.name),t=v.defaults(t,null),new s(R({trunc:r(e)},{precision:r(t)}))}function Si(e){return o.exact(1,arguments,Si.name),new s({count:r(e)})}function Ci(e){return o.exact(1,arguments,Ci.name),new s({sum:r(e)})}function Oi(e){return o.exact(1,arguments,Oi.name),new s({mean:r(e)})}function Ii(e){return o.exact(1,arguments,Ii.name),new s({any:r(e)})}function Ri(e){return o.exact(1,arguments,Ri.name),new s({all:r(e)})}function Ni(e){return o.exact(1,arguments,Ni.name),new s({acos:r(e)})}function Di(e){return o.exact(1,arguments,Di.name),new s({asin:r(e)})}function Pi(e){return o.exact(1,arguments,Pi.name),new s({atan:r(e)})}function ji(e){return o.exact(1,arguments,ji.name),new s({cos:r(e)})}function qi(e){return o.exact(1,arguments,qi.name),new s({cosh:r(e)})}function Li(e){return o.exact(1,arguments,Li.name),new s({degrees:r(e)})}function Fi(e){return o.exact(1,arguments,Fi.name),new s({exp:r(e)})}function Bi(e,t){return o.min(1,arguments,Bi.name),t=v.defaults(t,null),new s(R({hypot:r(e)},{b:r(t)}))}function ki(e){return o.exact(1,arguments,ki.name),new s({ln:r(e)})}function Mi(e){return o.exact(1,arguments,Mi.name),new s({log:r(e)})}function Ui(e,t){return o.min(1,arguments,Ui.name),t=v.defaults(t,null),new s(R({pow:r(e)},{exp:r(t)}))}function Vi(e){return o.exact(1,arguments,Vi.name),new s({radians:r(e)})}function Hi(e){return o.exact(1,arguments,Hi.name),new s({sin:r(e)})}function Wi(e){return o.exact(1,arguments,Wi.name),new s({sinh:r(e)})}function Gi(e){return o.exact(1,arguments,Gi.name),new s({tan:r(e)})}function Ji(e){return o.exact(1,arguments,Ji.name),new s({tanh:r(e)})}function Xi(){return o.min(1,arguments,Xi.name),new s({lt:r(_(arguments))})}function $i(){return o.min(1,arguments,$i.name),new s({lte:r(_(arguments))})}function Yi(){return o.min(1,arguments,Yi.name),new s({gt:r(_(arguments))})}function zi(){return o.min(1,arguments,zi.name),new s({gte:r(_(arguments))})}function Ki(){return o.min(1,arguments,Ki.name),new s({and:r(_(arguments))})}function Qi(){return o.min(1,arguments,Qi.name),new s({or:r(_(arguments))})}function Zi(e){return o.exact(1,arguments,Zi.name),new s({not:r(e)})}function es(e){return o.exact(1,arguments,es.name),new s({to_string:r(e)})}function ts(e){return o.exact(1,arguments,ts.name),new s({to_number:r(e)})}function ns(e){return o.exact(1,arguments,ns.name),new s({to_object:r(e)})}function rs(e){return o.exact(1,arguments,rs.name),new s({to_array:r(e)})}function as(e){return o.exact(1,arguments,as.name),new s({to_double:r(e)})}function is(e){return o.exact(1,arguments,is.name),new s({to_integer:r(e)})}function ss(e){return o.exact(1,arguments,ss.name),new s({to_time:r(e)})}function os(e){return o.exact(1,arguments,os.name),new s({to_seconds:r(e)})}function us(e){return o.exact(1,arguments,us.name),new s({to_millis:r(e)})}function cs(e){return o.exact(1,arguments,cs.name),new s({to_micros:r(e)})}function ls(e){return o.exact(1,arguments,ls.name),new s({day_of_week:r(e)})}function fs(e){return o.exact(1,arguments,fs.name),new s({day_of_year:r(e)})}function ds(e){return o.exact(1,arguments,ds.name),new s({day_of_month:r(e)})}function ms(e){return o.exact(1,arguments,ms.name),new s({hour:r(e)})}function ps(e){return o.exact(1,arguments,ps.name),new s({minute:r(e)})}function hs(e){return o.exact(1,arguments,hs.name),new s({second:r(e)})}function gs(e){return o.exact(1,arguments,gs.name),new s({month:r(e)})}function ys(e){return o.exact(1,arguments,ys.name),new s({year:r(e)})}function vs(e){return o.exact(1,arguments,vs.name),new s({to_date:r(e)})}function ws(e,t){return o.exact(2,arguments,ws.name),new s({move_database:r(e),to:r(t)})}function bs(e){return o.exact(1,arguments,bs.name),new s({documents:r(e)})}function Es(e){return o.exact(1,arguments,Es.name),new s({reverse:r(e)})}function As(e){return o.exact(1,arguments,As.name),new s({access_provider:r(e)})}function o(e,t,n,a){if(e!==null&&n.length<e||t!==null&&n.length>t)throw new Dt.InvalidArity(e,t,n.length,a)}o.exact=function(e,t,n){o(e,e,t,n)};o.max=function(e,t,n){o(null,e,t,n)};o.min=function(e,t,n){o(e,null,t,n)};o.between=function(e,t,n,a){o(e,t,n,a)};function R(e,t){for(var n in t){var a=t[n];a!=null&&(e[n]=a)}return e}function _(e){var t=Array.isArray(e)?e:Array.prototype.slice.call(e);return e.length===1?e[0]:t}function et(e){var t=[];return t.push.apply(t,e),t}function r(e){return o.exact(1,arguments,r.name),e===null?null:e instanceof s||v.checkInstanceHasProperty(e,"_isFaunaExpr")?e:typeof e=="symbol"?e.toString().replace(/Symbol\((.*)\)/,function(t,n){return n}):typeof e=="function"?Pt(e):Array.isArray(e)?new s(e.map(function(t){return r(t)})):e instanceof Uint8Array||e instanceof ArrayBuffer?new jn.Bytes(e):typeof e=="object"?new s({object:tt(e)}):e}function tt(e){if(e!==null){var t={};return Object.keys(e).forEach(function(n){t[n]=r(e[n])}),t}else return null}_s.exports={Ref:qn,Bytes:Ln,Abort:Fn,At:Bn,Let:kn,Var:he,If:Mn,Do:Un,Object:Vn,Lambda:Pt,Call:Hn,Query:Wn,Map:Gn,Foreach:Jn,Filter:Xn,Take:$n,Drop:Yn,Prepend:zn,Append:Kn,IsEmpty:Qn,IsNonEmpty:Zn,IsNumber:er,IsDouble:tr,IsInteger:nr,IsBoolean:rr,IsNull:ar,IsBytes:ir,IsTimestamp:sr,IsDate:or,IsString:ur,IsArray:cr,IsObject:lr,IsRef:fr,IsSet:dr,IsDoc:mr,IsLambda:pr,IsCollection:hr,IsDatabase:gr,IsIndex:yr,IsFunction:vr,IsKey:wr,IsToken:br,IsCredentials:Er,IsRole:Ar,Get:_r,KeyFromSecret:Tr,Reduce:xr,Paginate:Sr,Exists:Cr,Create:Or,Update:Ir,Replace:Rr,Delete:Nr,Insert:Dr,Remove:Pr,CreateClass:re(jr,"CreateClass() is deprecated, use CreateCollection() instead"),CreateCollection:qr,CreateDatabase:Lr,CreateIndex:Fr,CreateKey:Br,CreateFunction:kr,CreateRole:Mr,CreateAccessProvider:Ur,Singleton:Vr,Events:Hr,Match:Wr,Union:Gr,Merge:Jr,Intersection:Xr,Difference:$r,Distinct:Yr,Join:zr,Range:Kr,Login:Qr,Logout:Zr,Identify:ea,Identity:re(ta,"Identity() is deprecated, use CurrentIdentity() instead"),CurrentIdentity:na,HasIdentity:re(ra,"HasIdentity() is deprecated, use HasCurrentIdentity() instead"),HasCurrentIdentity:aa,CurrentToken:ia,HasCurrentToken:sa,Concat:oa,Casefold:ua,ContainsStr:ca,ContainsStrRegex:la,StartsWith:fa,EndsWith:da,FindStr:pa,FindStrRegex:ha,Length:ga,LowerCase:ya,LTrim:va,NGram:wa,Repeat:ba,ReplaceStr:Ea,ReplaceStrRegex:Aa,RegexEscape:ma,RTrim:_a,Space:Ta,SubString:xa,TitleCase:Sa,Trim:Ca,UpperCase:Oa,Format:Ia,Time:Ra,TimeAdd:Da,TimeSubtract:Pa,TimeDiff:ja,Epoch:Na,Date:qa,Now:La,NextId:re(Fa,"NextId() is deprecated, use NewId() instead"),NewId:Ba,Database:ka,Index:Ma,Class:re(Ua,"Class() is deprecated, use Collection() instead"),Collection:Va,Function:Ha,Role:Wa,AccessProviders:Ga,Classes:re(Ja,"Classes() is deprecated, use Collections() instead"),Collections:Xa,Databases:$a,Indexes:Ya,Functions:za,Roles:Ka,Keys:Qa,Tokens:Za,Credentials:ei,Equals:ti,Contains:re(ni,"Contains() is deprecated, use ContainsPath() instead"),ContainsPath:ii,ContainsField:ai,ContainsValue:ri,Select:si,SelectAll:re(oi,"SelectAll() is deprecated. Avoid use."),Abs:ui,Add:ci,BitAnd:li,BitNot:fi,BitOr:di,BitXor:mi,Ceil:pi,Divide:hi,Floor:gi,Max:yi,Min:vi,Modulo:wi,Multiply:bi,Round:Ei,Subtract:Ai,Sign:_i,Sqrt:Ti,Trunc:xi,Count:Si,Sum:Ci,Mean:Oi,Any:Ii,All:Ri,Acos:Ni,Asin:Di,Atan:Pi,Cos:ji,Cosh:qi,Degrees:Li,Exp:Fi,Hypot:Bi,Ln:ki,Log:Mi,Pow:Ui,Radians:Vi,Sin:Hi,Sinh:Wi,Tan:Gi,Tanh:Ji,LT:Xi,LTE:$i,GT:Yi,GTE:zi,And:Ki,Or:Qi,Not:Zi,ToString:es,ToNumber:ts,ToObject:ns,ToArray:rs,ToDouble:as,ToInteger:is,ToTime:ss,ToSeconds:os,ToMicros:cs,ToMillis:us,DayOfMonth:ds,DayOfWeek:ls,DayOfYear:fs,Second:hs,Minute:ps,Hour:ms,Month:gs,Year:ys,ToDate:vs,MoveDatabase:ws,Documents:bs,Reverse:Es,AccessProvider:As,wrap:r}});var Re=y((kc,Ts)=>{"use strict";var oe=Oe();function Su(e,t){return t=typeof t!="undefined"?t:!1,t?JSON.stringify(e,null,"  "):JSON.stringify(e)}function qt(e){return JSON.parse(e,Lt)}function Cu(e){var t=[];try{t.push(qt(e)),e=""}catch{for(;;){var n=e.indexOf(`
`)+1;if(n<=0)break;var a=e.slice(0,n).trim();a.length>0&&t.push(qt(a)),e=e.slice(n)}}return{values:t,buffer:e}}function Lt(e,t){if(typeof t!="object"||t===null)return t;if("@ref"in t){var n=t["@ref"];if(!("collection"in n)&&!("database"in n))return oe.Native.fromName(n.id);var a=Lt("collection",n.collection),i=Lt("database",n.database);return new oe.Ref(n.id,a,i)}else return"@obj"in t?t["@obj"]:"@set"in t?new oe.SetRef(t["@set"]):"@ts"in t?new oe.FaunaTime(t["@ts"]):"@date"in t?new oe.FaunaDate(t["@date"]):"@bytes"in t?new oe.Bytes(t["@bytes"]):"@query"in t?new oe.Query(t["@query"]):t}Ts.exports={toJSON:Su,parseJSON:qt,parseJSONStreaming:Cu}});var kt=y((Mc,xs)=>{"use strict";var Ft=Ie(),Bt=Nt();function F(e,t,n,a){n===void 0&&(n={}),a===void 0&&(a={}),this.reverse=!1,this.params={},this.before=void 0,this.after=void 0,Bt(this.params,n);var i=this.params.cursor||this.params;"before"in i?(this.before=i.before,delete i.before):"after"in i&&(this.after=i.after,delete i.after),this.options={},Bt(this.options,a),this.client=e,this.set=t,this._faunaFunctions=[]}F.prototype.map=function(e){var t=this._clone();return t._faunaFunctions.push(function(n){return Ft.Map(n,e)}),t};F.prototype.filter=function(e){var t=this._clone();return t._faunaFunctions.push(function(n){return Ft.Filter(n,e)}),t};F.prototype.each=function(e){return this._retrieveNextPage(this.after,!1).then(this._consumePages(e,!1))};F.prototype.eachReverse=function(e){return this._retrieveNextPage(this.before,!0).then(this._consumePages(e,!0))};F.prototype.previousPage=function(){var e=this;return this._retrieveNextPage(this.before,!0).then(this._adjustCursors.bind(e))};F.prototype.nextPage=function(){var e=this;return this._retrieveNextPage(this.after,!1).then(this._adjustCursors.bind(e))};F.prototype._adjustCursors=function(e){return e.after!==void 0&&(this.after=e.after),e.before!==void 0&&(this.before=e.before),e.data};F.prototype._consumePages=function(e,t){var n=this;return function(a){var i=[];a.data.forEach(function(l){l.document&&(l.instance=l.document),l.value&&l.value.document&&(l.value.instance=l.value.document),i.push(l)}),e(i);var u;return t?u=a.before:u=a.after,u!==void 0?n._retrieveNextPage(u,t).then(n._consumePages(e,t)):Promise.resolve()}};F.prototype._retrieveNextPage=function(e,t){var n={};Bt(n,this.params);var a=n.cursor||n;e!==void 0?t?a.before=e:a.after=e:t&&(a.before=null);var i=Ft.Paginate(this.set,n);return this._faunaFunctions.length>0&&this._faunaFunctions.forEach(function(u){i=u(i)}),this.client.query(i,this.options)};F.prototype._clone=function(){return Object.create(F.prototype,{client:{value:this.client},set:{value:this.set},_faunaFunctions:{value:this._faunaFunctions},before:{value:this.before},after:{value:this.after},params:{value:this.params}})};xs.exports=F});var nt=y((Uc,Cs)=>{"use strict";function Ss(e,t,n,a,i,u,l,f,m,h,p){this.method=e,this.path=t,this.query=n,this.requestRaw=a,this.requestContent=i,this.responseRaw=u,this.responseContent=l,this.statusCode=f,this.responseHeaders=m,this.startTime=h,this.endTime=p}Object.defineProperty(Ss.prototype,"timeTaken",{get:function(){return this.endTime-this.startTime}});Cs.exports=Ss});var rt=y((Vc,Ns)=>{"use strict";var Os=P();function Is(e){Error.call(this),this.message=e||"Request aborted due to timeout",this.isTimeoutError=!0}Os.inherits(Is,Error);function Rs(e){Error.call(this),this.message=e||"Request aborted",this.isAbortError=!0}Os.inherits(Rs,Error);Ns.exports={TimeoutError:Is,AbortError:Rs}});var Mt=y(()=>{});var Ls=y((Gc,qs)=>{"use strict";var ge=Mt(),Ds=rt(),Ps=ne(),Ou=P(),js="stream::";function Ne(e){this.type="http2",this._sessionMap={},this._http2SessionIdleTime=e.http2SessionIdleTime,this._closed=!1}Ne.prototype._resolveSessionFor=function(e,t){var n=t?js+e:e;if(this._sessionMap[n])return this._sessionMap[n];var a=this,i=null,u=0,l=function(){a._cleanupSessionFor(e,t)},f=function(){i&&(clearTimeout(i),i=null)},m=function(){if(f(),a._http2SessionIdleTime!==1/0){var B=function(){i=null,u===0&&l()};i=setTimeout(B,a._http2SessionIdleTime)}},h=function(B){f();var G=B||t;return G?(T.destroy(),Promise.resolve()):new Promise(function(te){T.close(te)})},p=function(){++u,f()},A=function(){--u;var B=u===0,G=a._closed||T.closed||T.destroyed;B&&!G&&m()},T=ge.connect(e).once("error",l).once("goaway",l),W={session:T,close:h,onRequestStart:p,onRequestEnd:A};return this._sessionMap[n]=W,W};Ne.prototype._cleanupSessionFor=function(e,t){var n=t?js+e:e;this._sessionMap[n]&&(this._sessionMap[n].session.close(),delete this._sessionMap[n])};Ne.prototype.execute=function(e){if(this._closed)return Promise.reject(new Ps.ClientClosed("The Client has already been closed","No subsequent requests can be issued after the .close method is called. Consider creating a new Client instance"));var t=this,n=e.streamConsumer!=null;return new Promise(function(a,i){var u=!1,l=!1,f=function(D){u=!0,a(D)},m=function(D){var X=Iu({error:D,isClosed:t._closed});if(u&&n)return e.streamConsumer.onError(X);u=!0,i(X)},h=function(){te.onRequestEnd(),e.signal&&e.signal.removeEventListener("abort",A)},p=function(D){h(),m(D)},A=function(){l=!0,h(),J.close(ge.constants.NGHTTP2_CANCEL),m(new Ds.AbortError)},T=function(){l=!0,h(),J.close(ge.constants.NGHTTP2_CANCEL),m(new Ds.TimeoutError)},W=function(D){var X=D[ge.constants.HTTP2_HEADER_STATUS],$=X>=200&&X<400,Ee=$&&n,Ve="",q=function(fe){if(Ee)return e.streamConsumer.onData(fe);Ve+=fe},dt=function(){if(l||h(),!Ee)return f({body:Ve,headers:D,status:X});!l&&!t._closed&&e.streamConsumer.onError(new TypeError("network error"))};Ee&&f({body:"[stream]",headers:D,status:X}),J.on("data",q).on("end",dt)};try{var B=(e.path[0]==="/"?e.path:"/"+e.path)+Ou.querystringify(e.query,"?"),G=Object.assign({},e.headers,{[ge.constants.HTTP2_HEADER_PATH]:B,[ge.constants.HTTP2_HEADER_METHOD]:e.method}),te=t._resolveSessionFor(e.origin,n),J=te.session.request(G).setEncoding("utf8").on("error",p).on("response",W);te.onRequestStart(),!e.signal&&e.timeout&&J.setTimeout(e.timeout,T),e.signal&&e.signal.addEventListener("abort",A),e.body!=null&&J.write(e.body),J.end()}catch(D){t._cleanupSessionFor(e.origin,n),m(D)}})};Ne.prototype.close=function(e){e=e||{},this._closed=!0;var t=function(){};return Promise.all(Object.values(this._sessionMap).map(function(n){return n.close(e.force)})).then(t)};function Iu({error:e,isClosed:t}){var n=t&&(e.code==="ERR_HTTP2_GOAWAY_SESSION"||e.code==="ERR_HTTP2_STREAM_CANCEL");return n?new Ps.ClientClosed("The request is aborted due to the Client#close call"):e}qs.exports=Ne});var Js=y((Pe,je)=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});var Fs=new WeakMap,Ut=new WeakMap;function E(e){let t=Fs.get(e);return console.assert(t!=null,"'this' is expected an Event object, but got",e),t}function Bs(e){if(e.passiveListener!=null){typeof console!="undefined"&&typeof console.error=="function"&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener);return}!e.event.cancelable||(e.canceled=!0,typeof e.event.preventDefault=="function"&&e.event.preventDefault())}function ye(e,t){Fs.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let n=Object.keys(t);for(let a=0;a<n.length;++a){let i=n[a];i in this||Object.defineProperty(this,i,ks(i))}}ye.prototype={get type(){return E(this).event.type},get target(){return E(this).eventTarget},get currentTarget(){return E(this).currentTarget},composedPath(){let e=E(this).currentTarget;return e==null?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return E(this).eventPhase},stopPropagation(){let e=E(this);e.stopped=!0,typeof e.event.stopPropagation=="function"&&e.event.stopPropagation()},stopImmediatePropagation(){let e=E(this);e.stopped=!0,e.immediateStopped=!0,typeof e.event.stopImmediatePropagation=="function"&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(E(this).event.bubbles)},get cancelable(){return Boolean(E(this).event.cancelable)},preventDefault(){Bs(E(this))},get defaultPrevented(){return E(this).canceled},get composed(){return Boolean(E(this).event.composed)},get timeStamp(){return E(this).timeStamp},get srcElement(){return E(this).eventTarget},get cancelBubble(){return E(this).stopped},set cancelBubble(e){if(!e)return;let t=E(this);t.stopped=!0,typeof t.event.cancelBubble=="boolean"&&(t.event.cancelBubble=!0)},get returnValue(){return!E(this).canceled},set returnValue(e){e||Bs(E(this))},initEvent(){}};Object.defineProperty(ye.prototype,"constructor",{value:ye,configurable:!0,writable:!0});typeof window!="undefined"&&typeof window.Event!="undefined"&&(Object.setPrototypeOf(ye.prototype,window.Event.prototype),Ut.set(window.Event.prototype,ye));function ks(e){return{get(){return E(this).event[e]},set(t){E(this).event[e]=t},configurable:!0,enumerable:!0}}function Ru(e){return{value(){let t=E(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function Nu(e,t){let n=Object.keys(t);if(n.length===0)return e;function a(i,u){e.call(this,i,u)}a.prototype=Object.create(e.prototype,{constructor:{value:a,configurable:!0,writable:!0}});for(let i=0;i<n.length;++i){let u=n[i];if(!(u in e.prototype)){let f=typeof Object.getOwnPropertyDescriptor(t,u).value=="function";Object.defineProperty(a.prototype,u,f?Ru(u):ks(u))}}return a}function Ms(e){if(e==null||e===Object.prototype)return ye;let t=Ut.get(e);return t==null&&(t=Nu(Ms(Object.getPrototypeOf(e)),e),Ut.set(e,t)),t}function Du(e,t){let n=Ms(Object.getPrototypeOf(t));return new n(e,t)}function Pu(e){return E(e).immediateStopped}function ju(e,t){E(e).eventPhase=t}function qu(e,t){E(e).currentTarget=t}function Us(e,t){E(e).passiveListener=t}var Vs=new WeakMap,Hs=1,Ws=2,at=3;function it(e){return e!==null&&typeof e=="object"}function De(e){let t=Vs.get(e);if(t==null)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function Lu(e){return{get(){let n=De(this).get(e);for(;n!=null;){if(n.listenerType===at)return n.listener;n=n.next}return null},set(t){typeof t!="function"&&!it(t)&&(t=null);let n=De(this),a=null,i=n.get(e);for(;i!=null;)i.listenerType===at?a!==null?a.next=i.next:i.next!==null?n.set(e,i.next):n.delete(e):a=i,i=i.next;if(t!==null){let u={listener:t,listenerType:at,passive:!1,once:!1,next:null};a===null?n.set(e,u):a.next=u}},configurable:!0,enumerable:!0}}function Vt(e,t){Object.defineProperty(e,`on${t}`,Lu(t))}function Gs(e){function t(){k.call(this)}t.prototype=Object.create(k.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let n=0;n<e.length;++n)Vt(t.prototype,e[n]);return t}function k(){if(this instanceof k){Vs.set(this,new Map);return}if(arguments.length===1&&Array.isArray(arguments[0]))return Gs(arguments[0]);if(arguments.length>0){let e=new Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return Gs(e)}throw new TypeError("Cannot call a class as a function")}k.prototype={addEventListener(e,t,n){if(t==null)return;if(typeof t!="function"&&!it(t))throw new TypeError("'listener' should be a function or an object.");let a=De(this),i=it(n),l=Boolean(i?n.capture:n)?Hs:Ws,f={listener:t,listenerType:l,passive:i&&Boolean(n.passive),once:i&&Boolean(n.once),next:null},m=a.get(e);if(m===void 0){a.set(e,f);return}let h=null;for(;m!=null;){if(m.listener===t&&m.listenerType===l)return;h=m,m=m.next}h.next=f},removeEventListener(e,t,n){if(t==null)return;let a=De(this),u=(it(n)?Boolean(n.capture):Boolean(n))?Hs:Ws,l=null,f=a.get(e);for(;f!=null;){if(f.listener===t&&f.listenerType===u){l!==null?l.next=f.next:f.next!==null?a.set(e,f.next):a.delete(e);return}l=f,f=f.next}},dispatchEvent(e){if(e==null||typeof e.type!="string")throw new TypeError('"event.type" should be a string.');let t=De(this),n=e.type,a=t.get(n);if(a==null)return!0;let i=Du(this,e),u=null;for(;a!=null;){if(a.once?u!==null?u.next=a.next:a.next!==null?t.set(n,a.next):t.delete(n):u=a,Us(i,a.passive?a.listener:null),typeof a.listener=="function")try{a.listener.call(this,i)}catch(l){typeof console!="undefined"&&typeof console.error=="function"&&console.error(l)}else a.listenerType!==at&&typeof a.listener.handleEvent=="function"&&a.listener.handleEvent(i);if(Pu(i))break;a=a.next}return Us(i,null),ju(i,0),qu(i,null),!i.defaultPrevented}};Object.defineProperty(k.prototype,"constructor",{value:k,configurable:!0,writable:!0});typeof window!="undefined"&&typeof window.EventTarget!="undefined"&&Object.setPrototypeOf(k.prototype,window.EventTarget.prototype);Pe.defineEventAttribute=Vt;Pe.EventTarget=k;Pe.default=k;je.exports=k;je.exports.EventTarget=je.exports.default=k;je.exports.defineEventAttribute=Vt});var Ys=y((qe,Le)=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});var Ht=Js(),ue=class extends Ht.EventTarget{constructor(){super();throw new TypeError("AbortSignal cannot be constructed directly")}get aborted(){let t=st.get(this);if(typeof t!="boolean")throw new TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return t}};Ht.defineEventAttribute(ue.prototype,"abort");function Fu(){let e=Object.create(ue.prototype);return Ht.EventTarget.call(e),st.set(e,!1),e}function Bu(e){st.get(e)===!1&&(st.set(e,!0),e.dispatchEvent({type:"abort"}))}var st=new WeakMap;Object.defineProperties(ue.prototype,{aborted:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ue.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});var ce=class{constructor(){Xs.set(this,Fu())}get signal(){return $s(this)}abort(){Bu($s(this))}},Xs=new WeakMap;function $s(e){let t=Xs.get(e);if(t==null)throw new TypeError(`Expected 'this' to be an 'AbortController' object, but got ${e===null?"null":typeof e}`);return t}Object.defineProperties(ce.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ce.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});qe.AbortController=ce;qe.AbortSignal=ue;qe.default=ce;Le.exports=ce;Le.exports.AbortController=Le.exports.default=ce;Le.exports.AbortSignal=ue});var Wt=y(()=>{"use strict";var zs=Ys(),Fe=typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:void 0;Fe&&(typeof Fe.AbortController=="undefined"&&(Fe.AbortController=zs.AbortController),typeof Fe.AbortSignal=="undefined"&&(Fe.AbortSignal=zs.AbortSignal))});var Ks=y(()=>{});var Qs=y(()=>{});var to=y((Qc,eo)=>{"use strict";Wt();var ot=P(),Gt=ne(),Jt=rt();function Xt(e){e=e||{},this.type="fetch",this._closed=!1,this._fetch=ot.resolveFetch(e.fetch),this._pendingRequests=new Map,ot.isNodeEnv()&&e.keepAlive&&(this._keepAliveEnabledAgent=new(e.isHttps?Ks():Qs()).Agent({keepAlive:!0}))}Xt.prototype.execute=function(e){if(this._closed)return Promise.reject(new Gt.ClientClosed("The Client has already been closed","No subsequent requests can be issued after the .close method is called. Consider creating a new Client instance"));var t=this,n=null,a=e.streamConsumer!=null,i=!e.signal&&!!e.timeout,u=new AbortController,l={isStreaming:a,isAbortedByClose:!1,onComplete:null};t._pendingRequests.set(u,l);var f=function(){t._pendingRequests.delete(u),e.signal&&e.signal.removeEventListener("abort",A),l.onComplete&&l.onComplete()},m=function(){n&&clearTimeout(n)},h=function(T){m();var W=Mu(T.headers),B=a&&T.ok;return B?(ku(T,e.streamConsumer,f),{body:"[stream]",headers:W,status:T.status}):(f(),T.text().then(function(G){return{body:G,headers:W,status:T.status}}))},p=function(T){return m(),f(),Promise.reject(Zs(T,function(){return!a&&l.isAbortedByClose?new Gt.ClientClosed("The request is aborted due to the Client#close call with the force=true option"):i?new Jt.TimeoutError:new Jt.AbortError}))},A=function(){u.abort()};return i&&(n=setTimeout(function(){n=null,u.abort()},e.timeout)),e.signal&&e.signal.addEventListener("abort",A),this._fetch(ot.formatUrl(e.origin,e.path,e.query),{method:e.method,headers:e.headers,body:e.body,agent:this._keepAliveEnabledAgent,signal:u.signal}).then(h).catch(p)};Xt.prototype.close=function(e){e=e||{},this._closed=!0;var t=[],n=function(i,u){var l=i.isStreaming||e.force;if(l)return i.isAbortedByClose=!0,u.abort();t.push(new Promise(function(f){i.onComplete=f}))};this._pendingRequests.forEach(n);var a=function(){};return Promise.all(t).then(a)};function ku(e,t,n){var a=function(l){n(),t.onError(Zs(l))};if(ot.isNodeEnv()){e.body.on("error",a).on("data",t.onData).on("end",function(){n(),t.onError(new TypeError("network error"))});return}try{let l=function(){return i.read().then(function(f){if(!f.done){var m=u.decode(f.value,{stream:!0});return t.onData(m),l()}n(),t.onError(new TypeError("network error"))})};var i=e.body.getReader(),u=new TextDecoder("utf-8");l().catch(a)}catch(l){throw new Gt.StreamsNotSupported("Please, consider providing a Fetch API-compatible function with streamable response bodies. "+l)}}function Zs(e,t){var n=e&&e.name==="AbortError";return n?t?t():new Jt.AbortError:e}function Mu(e){var t={};for(var n of e.entries()){var a=n[0],i=n[1];t[a]=i}return t}eo.exports=Xt});var no=y(()=>{});var $t=y((tl,io)=>{"use strict";var ro=We(),{getBrowserOsDetails:Uu}=P(),ve=P(),ao=rt();function Be(e){var t=e.scheme==="https";e.port||(e.port=t?443:80);var n=!e.fetch&&ve.isNodeEnv()&&Wu();this._adapter=n?new(Ls())({http2SessionIdleTime:e.http2SessionIdleTime}):new(to())({isHttps:t,fetch:e.fetch,keepAlive:e.keepAlive}),this._baseUrl=e.scheme+"://"+e.domain+":"+e.port,this._secret=e.secret,this._headers=Object.assign({},e.headers,Hu()),this._queryTimeout=e.queryTimeout,this._lastSeen=null,this._timeout=Math.floor(e.timeout*1e3)}Be.prototype.getLastTxnTime=function(){return this._lastSeen};Be.prototype.syncLastTxnTime=function(e){(this._lastSeen==null||this._lastSeen<e)&&(this._lastSeen=e)};Be.prototype.close=function(e){return this._adapter.close(e)};Be.prototype.execute=function(e){e=e||{};var t=e.streamConsumer&&(typeof e.streamConsumer.onData!="function"||typeof e.streamConsumer.onError!="function");if(t)return Promise.reject(new TypeError('Invalid "streamConsumer" provided'));var n=e.secret||this._secret,a=e.queryTimeout||this._queryTimeout,i=this._headers;return i.Authorization=n&&Vu(n),i["X-Last-Seen-Txn"]=this._lastSeen,i["X-Query-Timeout"]=a,this._adapter.execute({origin:this._baseUrl,path:e.path||"/",query:e.query,method:e.method||"GET",headers:ve.removeNullAndUndefinedValues(i),body:e.body,signal:e.signal,timeout:this._timeout,streamConsumer:e.streamConsumer})};function Vu(e){return"Bearer "+e}function Hu(){var e={driver:["javascript",ro.version].join("-")},t;try{t=global instanceof ServiceWorkerGlobalScope}catch{t=!1}try{if(ve.isNodeEnv()){e.runtime=["nodejs",process.version].join("-"),e.env=ve.getNodeRuntimeEnv();var n=no();e.os=[n.platform(),n.release()].join("-")}else t?e.runtime="Service Worker":(e.runtime=ve.getBrowserDetails(),e.env="browser",e.os=Uu())}catch{}var a={"X-FaunaDB-API-Version":ro.apiVersion};return ve.isNodeEnv()&&(a["X-Driver-Env"]=Object.keys(e).map(i=>[i,e[i].toLowerCase()].join("=")).join("; ")),a}function Wu(){try{return Mt(),!0}catch{return!1}}io.exports={HttpClient:Be,TimeoutError:ao.TimeoutError,AbortError:ao.AbortError}});var lo=y((nl,co)=>{"use strict";Wt();var Gu=nt(),Ju=ne(),so=Re(),Xu=$t(),oo=Ie(),$u=P(),uo=["start","error","version","history_rewrite"],Yu=uo.concat(["snapshot"]);function ke(e,t,n,a){n=$u.applyDefaults(n,{fields:null}),this._client=e,this._onEvent=a,this._query=oo.wrap(t),this._urlParams=n.fields?{fields:n.fields.join(",")}:null,this._abort=new AbortController,this._state="idle"}ke.prototype.snapshot=function(){var e=this;e._client.query(oo.Get(e._query)).then(function(t){e._onEvent({type:"snapshot",event:t})}).catch(function(t){e._onEvent({type:"error",event:t})})};ke.prototype.subscribe=function(){var e=this;if(e._state==="idle")e._state="open";else throw new Error("Subscription#start should not be called several times, consider instantiating a new stream instead.");var t=JSON.stringify(e._query),n=Date.now(),a="";function i(f){var m=Date.now(),h;try{h=so.parseJSON(f.body)}catch{h=f.body}var p=new Gu("POST","stream",e._urlParams,t,e._query,f.body,h,f.status,f.headers,n,m);e._client._handleRequestResult(f,p)}function u(f){var m=so.parseJSONStreaming(a+f);a=m.buffer,m.values.forEach(function(h){h.txn!==void 0&&e._client.syncLastTxnTime(h.txn),h.event==="error"?l(new Ju.StreamErrorEvent(h)):e._onEvent(h)})}function l(f){f instanceof Xu.AbortError||e._onEvent({type:"error",event:f})}e._client._http.execute({method:"POST",path:"stream",body:t,query:e._urlParams,signal:this._abort.signal,streamConsumer:{onError:l,onData:u}}).then(i).catch(l)};ke.prototype.close=function(){this._state!=="closed"&&(this._state="closed",this._abort.abort())};function ut(e){this._allowedEvents=e,this._listeners={}}ut.prototype.on=function(e,t){if(this._allowedEvents.indexOf(e)===-1)throw new Error("Unknown event type: "+e);this._listeners[e]===void 0&&(this._listeners[e]=[]),this._listeners[e].push(t)};ut.prototype.dispatch=function(e){var t=this._listeners[e.type];if(!!t)for(var n=0;n<t.length;n++)t[n].call(null,e.event,e)};function Me(e,t){this._client=e,this._dispatcher=t}Me.prototype.on=function(e,t){return this._dispatcher.on(e,t),this};Me.prototype.start=function(){return this._client.subscribe(),this};Me.prototype.close=function(){this._client.close()};function zu(e){var t=function(n,a){var i=new ut(uo),u=new ke(e,n,a,function(l){i.dispatch(l)});return new Me(u,i)};return t.document=function(n,a){var i=[],u=!0,l=new ut(Yu),f=new ke(e,n,a,m);function m(p){switch(p.type){case"start":l.dispatch(p),f.snapshot();break;case"snapshot":h(p);break;case"error":l.dispatch(p);break;default:u?i.push(p):l.dispatch(p)}}function h(p){l.dispatch(p);for(var A=0;A<i.length;A++){var T=i[A];T.txn>p.event.ts&&l.dispatch(T)}u=!1,i=null}return new Me(f,l)},t}co.exports={StreamAPI:zu}});var mo=y((rl,Yt)=>{"use strict";var Ku=We(),Qu=kt(),Zu=nt(),ec=ne(),tc=$t(),nc=Re(),rc=Ie(),ac=lo(),Z=P(),ic=Oe(),fo=Z.notifyAboutNewVersion();function V(e){var t=sc();e=Z.applyDefaults(e,{domain:"db.fauna.com",scheme:"https",port:null,secret:null,timeout:60,observer:null,keepAlive:!0,headers:{},fetch:void 0,queryTimeout:null,http2SessionIdleTime:t.value,checkNewVersion:!0}),fo(e.checkNewVersion),t.shouldOverride&&(e.http2SessionIdleTime=t.value),this._observer=e.observer,this._http=new tc.HttpClient(e),this.stream=ac.StreamAPI(this)}V.apiVersion=Ku.apiVersion;V.prototype.query=function(e,t){return this._execute("POST","",rc.wrap(e),null,t)};V.prototype.paginate=function(e,t,n){return t=Z.defaults(t,{}),n=Z.defaults(n,{}),new Qu(this,e,t,n)};V.prototype.ping=function(e,t){return this._execute("GET","ping",null,{scope:e,timeout:t})};V.prototype.getLastTxnTime=function(){return this._http.getLastTxnTime()};V.prototype.syncLastTxnTime=function(e){this._http.syncLastTxnTime(e)};V.prototype.close=function(e){return this._http.close(e)};V.prototype._execute=function(e,t,n,a,i){a=Z.defaults(a,null),(t instanceof ic.Ref||Z.checkInstanceHasProperty(t,"_isFaunaRef"))&&(t=t.value),a!==null&&(a=Z.removeUndefinedValues(a));var u=Date.now(),l=this,f=["GET","HEAD"].indexOf(e)>=0?void 0:JSON.stringify(n);return this._http.execute(Object.assign({},i,{path:t,query:a,method:e,body:f})).then(function(m){var h=Date.now(),p=nc.parseJSON(m.body),A=new Zu(e,t,a,f,n,m.body,p,m.status,m.headers,u,h);return l._handleRequestResult(m,A,i),p.resource})};V.prototype._handleRequestResult=function(e,t,n){var a="x-txn-time";e.headers[a]!=null&&this.syncLastTxnTime(parseInt(e.headers[a],10));var i=[this._observer,n&&n.observer];i.forEach(u=>{typeof u=="function"&&u(t,this)}),ec.FaunaHTTPError.raiseForStatusCode(t)};function sc(){var e=Z.getEnvVariable("FAUNADB_HTTP2_SESSION_IDLE_TIME"),t=e==="Infinity"?1/0:parseInt(e,10),n=!isNaN(t);return{shouldOverride:n,value:n?t:500}}Yt.exports=V;Yt.exports.resetNotifyAboutNewVersion=function(){fo=Z.notifyAboutNewVersion()}});var go=y((al,ho)=>{"use strict";var oc=Re();function uc(e){return function(t,n){return e(po(t),n)}}function po(e){var t=e.query,n=e.method,a=e.path,i=e.requestContent,u=e.responseHeaders,l=e.responseContent,f=e.statusCode,m=e.timeTaken,h="";function p(A){h=h+A}return p("Fauna "+n+" /"+a+lc(t)+`
`),i!=null&&p("  Request JSON: "+zt(i)+`
`),p("  Response headers: "+zt(u)+`
`),p("  Response JSON: "+zt(l)+`
`),p("  Response ("+f+"): Network latency "+m+`ms
`),h}function cc(e){var t="  ";return e.split(`
`).join(`
`+t)}function zt(e){return cc(oc.toJSON(e,!0))}function lc(e){if(e==null)return"";var t=Object.keys(e);if(t.length===0)return"";var n=t.map(function(a){return a+"="+e[a]});return"?"+n.join("&")}ho.exports={logger:uc,showRequestResult:po}});var we=y((il,vo)=>{var yo=Ie(),fc=P(),dc=Re().parseJSON;vo.exports=fc.mergeObjects({Client:mo(),Expr:Xe(),PageHelper:kt(),RequestResult:nt(),clientLogger:go(),errors:ne(),values:Oe(),query:yo,parseJSON:dc},yo)});var Ho={number:(e,t)=>e-t,"-number":(e,t)=>-(e-t),gl:(e,t)=>e>=0?e-t:t-e,"abs(number)":(e,t)=>Math.abs(e)-Math.abs(t),"-abs(number)":(e,t)=>-(Math.abs(e)-Math.abs(t)),string:(e,t)=>e.localeCompare(t),date:(e,t)=>e.valueOf()-t.valueOf(),noop:()=>0};Array.prototype.sortBy=function(e){return Wo(this,e)};function Wo(e,t){let n=Object.keys(t);return[...e].sort((a,i)=>{let u=0;return n.some(l=>!!(u=Ho[t[l]](a[l],i[l]))),u})}var wo=_e(we()),bo=.06,Kt=location.href.includes("localhost"),be=Kt;var M={FAUNADB_SERVER_SECRET:"",FAUNADB_ADMIN_SECRET:"",FAUNADB_DOMAIN:"db.us.fauna.com"};if(globalThis.process?.env)M.FAUNADB_SERVER_SECRET=process.env.FAUNADB_SERVER_SECRET,M.FAUNADB_ADMIN_SECRET=process.env.FAUNADB_ADMIN_SECRET;else if(localStorage){if(M.FAUNADB_SERVER_SECRET=localStorage.getItem("FAUNADB_SERVER_SECRET"),M.FAUNADB_ADMIN_SECRET=localStorage.getItem("FAUNADB_ADMIN_SECRET"),!M.FAUNADB_SERVER_SECRET){let e=prompt("Provide the FAUNADB_SERVER_SECRET")||"";M.FAUNADB_SERVER_SECRET=e,localStorage.setItem("FAUNADB_SERVER_SECRET",e)}M.FAUNADB_SERVER_SECRET||console.error("set FAUNADB_SERVER_SECRET in local storage"),M.FAUNADB_ADMIN_SECRET||console.error("set FAUNADB_ADMIN_SECRET in local storage")}function mc(){return 0<=location.href.indexOf("netlify")}var pc=M.FAUNADB_DOMAIN,hc=M.FAUNADB_SERVER_SECRET,sl=M.FAUNADB_ADMIN_SECRET,Eo=mc()?"NETLIFY":"dev",le=localStorage.getItem("user");function ae(){return new wo.default.Client({secret:hc,domain:pc})}var gc=_e(we());async function Ao(){await ae().ping()}var Qt={home:()=>"/index.html",identity:({context:e,target:t})=>`/app/identity.html?target=${t}&context=${e}`,createInvoice:()=>"/app/invoice/invoice.html",invoice:e=>`/app/invoice/invoice.html?id=${e}`,allInvoices:()=>"/app/invoice/invoices.html",allLedgers:()=>"/app/gl/index.html?print=all",printLedger:e=>`/app/gl/index.html?print=${e}`,createLedger:()=>"/app/gl/index.html",dashboard:()=>"/app/index.html",admin:()=>"/app/admin/index.html"};async function _o(){if(!localStorage.getItem("user"))return location.href=Qt.identity({target:location.href,context:Eo}),!1;try{await Ao()}catch{return localStorage.setItem("FAUNADB_SERVER_SECRET",""),Qt.home(),!1}return!0}function ee(e,t,n){e.addEventListener(t,n)}function To(e,t){e.dispatchEvent(new Event(t))}function xo(e){e.querySelectorAll("[data-event]").forEach(t=>{ee(t,"click",()=>{let n=t.dataset.event;if(!n)throw"item must define a data-event";To(e,n)})})}var vc=_e(we());function So(e){return e.length?e.reduce((t,n)=>t+n,0):0}var j=_e(we());function Co(e){return e/1e3}var yc=Kt?7*24*3600:60,H=class{constructor(t){this.table=t;let n=localStorage.getItem(`table_${this.table}`);if(!n)this.data=[],this.lastWrite=0;else{let a=JSON.parse(n);this.lastWrite=a.lastWrite,this.data=a.data}}clear(){this.lastWrite=0,this.save()}renew(){this.lastWrite=Date.now(),this.save()}save(){localStorage.setItem(`table_${this.table}`,JSON.stringify({lastWrite:this.lastWrite,data:this.data}))}deleteLineItem(t){let n=this.data.findIndex(a=>a.id===t);this.data.splice(n,1),this.save()}updateLineItem(t){let n=this.data.findIndex(a=>a.id===t.id);-1<n&&this.data.splice(n,1),this.data.push(t),this.save()}expired(){let t=Co(Date.now()-this.lastWrite);return yc<t}getById(t){return this.data.find(n=>n.id===t)}get(){return this.data}set(t){this.lastWrite=Date.now(),this.data=t,this.save()}};var ct="general_ledger",lt=new H(ct);async function Zt(e){if(!le)throw"user must be signed in";let t=ae();if(e.id){if(!be){let n=await t.query(j.query.Update(j.query.Ref(j.query.Collection(ct),e.id),{data:{...e,user:le,update_date:Date.now()}}))}}else if(be)e.id="ledger_"+Date.now().toFixed();else{let n=await t.query(j.query.Create(j.query.Collection(ct),{data:{...e,user:le,create_date:Date.now()}}));e.id=n.ref.id}lt.updateLineItem(e)}async function ft(){if(!le)throw"user must be signed in";if(be||!lt.expired())return lt.get();let n=(await ae().query(j.query.Map(j.query.Paginate(j.query.Documents(j.query.Collection(ct)),{size:100}),j.query.Lambda("ref",j.query.Get(j.query.Var("ref")))))).data;n.forEach(i=>{i.data.id=i.ref.value.id});let a=n.filter(i=>i.data.items&&i.data.items[0]&&i.data.items[0].account).map(i=>i.data);return lt.set(a),a}var ie=_e(we());var Oo="invoices",en=new H(Oo);async function Io(){if(!le)throw"user must be signed in";if(be||!en.expired())return en.get();let n=(await ae().query(ie.query.Map(ie.query.Paginate(ie.query.Documents(ie.query.Collection(Oo)),{size:100}),ie.query.Lambda("ref",ie.query.Get(ie.query.Var("ref")))))).data;n.forEach(i=>{i.data.id=i.ref.value.id,i.data.paid&&i.data.mop&&(i.data.mops.push({mop:i.data.mop,paid:i.data.paid}),delete i.data.paid,delete i.data.mop)});let a=n.filter(i=>i.data.items).map(i=>i.data).map(i=>(i.date=i.date||i.create_date,i.labor=(i.labor||0)-0,i.additional=(i.additional||0)-0,i.items.forEach(u=>{u.item=(u.item||"").toLocaleUpperCase(),u.quantity=(u.quantity||0)-0,u.price=(u.price||0)-0,u.total=(u.total||0)-0}),i)).sortBy({date:"date"}).reverse();return en.set(a),a}function Ro(e,t){let n=[[],[]];return e.forEach(a=>n[t(a)?0:1].push(a)),n}async function No(){let e=await Io(),t=await ft(),[n,a]=Ro(e,i=>!t.find(u=>u.description===`INVOICE ${i.id}`));for(a.forEach(async i=>{let u=t.find(f=>f.description===`INVOICE ${i.id}`);if(!u)throw`ledger must exist for invoice: ${i.id}`;let l={...Do(i),id:u.id};JSON.stringify([l.date,l.items])!==JSON.stringify([u.date,u.items])&&await Zt({...l,id:u.id})});n.length;){let i=n.shift(),u=Do(i);await Zt(u)}}function Do(e){let t=So(e.items.map(f=>f.total)),n=t*bo,a=e.labor,i=e.additional>0?e.additional:0,u=e.additional<0?e.additional:0,l={date:e.date,description:`INVOICE ${e.id}`,items:[{account:"AR",amount:t,comment:"INVENTORY"},{account:"INVENTORY",amount:-t,comment:"INVENTORY"},{account:"AR",amount:n,comment:"TAX"},{account:"TAX",amount:-n,comment:"TAX"},{account:"AR",amount:i,comment:"RENT"},{account:"RENT",amount:-i,comment:"RENT"},{account:"AR",amount:a,comment:"LABOR"},{account:"LABOR",amount:-a,comment:"LABOR"},{account:"AR",amount:u,comment:"DISCOUNT"},{account:"LABOR",amount:-u,comment:"DISCOUNT"}]};return l.items=l.items.filter(f=>f.amount!=0),l}function Po(e){localStorage.setItem("accounts",JSON.stringify(e))}function jo(){return JSON.parse(localStorage.getItem("accounts")||"{}")}var Ue={light_mode:"light",dark_mode:"dark",holiday_mode:"holiday"};function tn(e){e||(e=localStorage.getItem("mode")||"holiday"),localStorage.setItem("mode",e),document.body.classList.remove(...Object.values(Ue)),document.body.classList.add(e)}tn(localStorage.getItem("mode")||Ue.holiday_mode);var wc=["AP","AR","CASH","INVENTORY","LABOR","OPEX","Phone","Rental","SALE TAX","SALES","STORAGE","TOOLS","Utilities"];async function Kl(){await _o();let e=document.body;xo(e),Object.keys(Ue).forEach(t=>ee(e,t,()=>{tn(Ue[t])})),ee(e,"clear-local-storage",()=>{let t=new H("invoices");t.clear(),t=new H("general_ledger"),t.clear()}),ee(e,"set-api-key",()=>{bc("Enter API Key",t=>{!t||localStorage.setItem("FAUNADB_SERVER_SECRET",t)})}),ee(e,"ping-local-storage",()=>{let t=new H("invoices");t.renew(),t=new H("general_ledger"),t.renew()}),ee(e,"invoice-to-gl",async()=>{!confirm("import invoices into general ledger?")||await No()}),ee(e,"gl-to-list-of-accounts",async()=>{let t=jo();wc.forEach(a=>qo(t,a)),(await ft()).forEach(a=>a.items.forEach(i=>{qo(t,i.account)})),Po(t)})}function bc(e,t){let n=document.createElement("input");n.placeholder=e,document.body.appendChild(n),n.onchange=()=>{t(n.value.trim()),n.remove()}}function qo(e,t){e[t]||(e[t]={code:t})}export{Kl as init};
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
//# sourceMappingURL=admin.js.map
