var Cu=Object.create;var At=Object.defineProperty;var Iu=Object.getOwnPropertyDescriptor;var Ou=Object.getOwnPropertyNames;var Nu=Object.getPrototypeOf,Ru=Object.prototype.hasOwnProperty;var Lu=e=>At(e,"__esModule",{value:!0});var b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Du=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Ou(t))!Ru.call(e,r)&&r!=="default"&&At(e,r,{get:()=>t[r],enumerable:!(n=Iu(t,r))||n.enumerable});return e},_t=e=>Du(Lu(At(e!=null?Cu(Nu(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var yn=b((Fc,gn)=>{"use strict";gn.exports=Pu;function Pu(e){if(typeof e!="function")throw new Error("Could not parse function signature for injection dependencies: Object is not a function");if(!e.length)return[];var t=/^()\(?([^)=]*)\)? *=>/.exec(e+"")||/^[^(]+([^ \(]*) *\(([^\)]*)\)/.exec(e+"");if(!t)throw new Error("Could not parse function signature for injection dependencies: "+e+"");var n=t[2].replace(/\/\*[\S\s]*?\*\//g," ").replace(/\/\/.*/g," ");function r(i,u,l){return u+l.split(",").map(function(d){return d&&d.trim()}).filter(Boolean).join("@")}return n=n.replace(/(\{)([^}]*)\}/g,r),n=n.replace(/(\[)([^}]*)\]/g,r),n.split(",").map(function(i){return i&&i.trim()}).map(function(i){return i[0]==="{"?i.substring(1).split("@"):i[0]==="["?{items:i.substring(1).split("@")}:i}).filter(Boolean)}});var Ct=b((Mc,bn)=>{bn.exports=ju;function ju(e,t){if(St("noDeprecation"))return e;var n=!1;function r(){if(!n){if(St("throwDeprecation"))throw new Error(t);St("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}return r}function St(e){try{if(!global.localStorage)return!1}catch{return!1}var t=global.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}});var ze=b((Pc,qu)=>{qu.exports={name:"faunadb",version:"4.4.1",apiVersion:"4",description:"FaunaDB Javascript driver for Node.JS and Browsers",homepage:"https://fauna.com",repository:"fauna/faunadb-js",license:"MPL-2.0",keywords:["database","fauna","official","driver"],bugs:{url:"https://github.com/fauna/faunadb-js/issues"},files:["index.d.ts","src/","dist/","tools/printReleaseNotes.js"],main:"index.js",scripts:{doc:"jsdoc -c ./jsdoc.json",browserify:"browserify index.js --standalone faunadb -o dist/faunadb.js","browserify-min":"browserify index.js --standalone faunadb | terser -c -m --keep-fnames --keep-classnames -o dist/faunadb-min.js",prettify:'prettier --write "{src,test}/**/*.{js,ts}"',test:"jest --env=node --verbose=false --forceExit ./test","semantic-release":"semantic-release",wp:"webpack",postinstall:"node ./tools/printReleaseNotes",postupdate:"node ./tools/printReleaseNotes","load-test":"node ./tools/loadTest"},types:"index.d.ts",dependencies:{"abort-controller":"^3.0.0","base64-js":"^1.2.0",boxen:"^5.0.1","btoa-lite":"^1.0.0",chalk:"^4.1.1","cross-fetch":"^3.0.6",dotenv:"^8.2.0","fn-annotate":"^1.1.3","object-assign":"^4.1.0","util-deprecate":"^1.0.2"},devDependencies:{browserify:"^16.2.2",eslint:"^5.3.0","eslint-config-prettier":"^6.5.0","eslint-plugin-prettier":"^3.1.1",husky:">=1","ink-docstrap":"^1.2.1",jest:"^24.9.0",jsdoc:"^3.6.3","lint-staged":">=8",prettier:"1.18.2","semantic-release":"^17.1.2",terser:"^4.3.9",webpack:"^5.23.0","webpack-cli":"^4.5.0",yargs:"^16.2.0"},husky:{hooks:{"pre-commit":"lint-staged"}},"lint-staged":{"*.{js,css,json,md}":["prettier --write","git add"],"*.js":["eslint --fix","git add"]},release:{branches:["main"]},browser:{http2:!1,http:!1,https:!1,os:!1,util:!1,boxen:!1,chalk:!1}}});var vn=b(()=>{});var wn=b(()=>{});var xn=b((K,Tn)=>{var En=typeof self!="undefined"?self:K,Ye=function(){function e(){this.fetch=!1,this.DOMException=En.DOMException}return e.prototype=En,new e}();(function(e){var t=function(n){var r={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function i(c){return c&&DataView.prototype.isPrototypeOf(c)}if(r.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(c){return c&&u.indexOf(Object.prototype.toString.call(c))>-1};function d(c){if(typeof c!="string"&&(c=String(c)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(c))throw new TypeError("Invalid character in header field name");return c.toLowerCase()}function p(c){return typeof c!="string"&&(c=String(c)),c}function h(c){var m={next:function(){var y=c.shift();return{done:y===void 0,value:y}}};return r.iterable&&(m[Symbol.iterator]=function(){return m}),m}function g(c){this.map={},c instanceof g?c.forEach(function(m,y){this.append(y,m)},this):Array.isArray(c)?c.forEach(function(m){this.append(m[0],m[1])},this):c&&Object.getOwnPropertyNames(c).forEach(function(m){this.append(m,c[m])},this)}g.prototype.append=function(c,m){c=d(c),m=p(m);var y=this.map[c];this.map[c]=y?y+", "+m:m},g.prototype.delete=function(c){delete this.map[d(c)]},g.prototype.get=function(c){return c=d(c),this.has(c)?this.map[c]:null},g.prototype.has=function(c){return this.map.hasOwnProperty(d(c))},g.prototype.set=function(c,m){this.map[d(c)]=p(m)},g.prototype.forEach=function(c,m){for(var y in this.map)this.map.hasOwnProperty(y)&&c.call(m,this.map[y],y,this)},g.prototype.keys=function(){var c=[];return this.forEach(function(m,y){c.push(y)}),h(c)},g.prototype.values=function(){var c=[];return this.forEach(function(m){c.push(m)}),h(c)},g.prototype.entries=function(){var c=[];return this.forEach(function(m,y){c.push([y,m])}),h(c)},r.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function x(c){if(c.bodyUsed)return Promise.reject(new TypeError("Already read"));c.bodyUsed=!0}function S(c){return new Promise(function(m,y){c.onload=function(){m(c.result)},c.onerror=function(){y(c.error)}})}function X(c){var m=new FileReader,y=S(m);return m.readAsArrayBuffer(c),y}function H(c){var m=new FileReader,y=S(m);return m.readAsText(c),y}function $(c){for(var m=new Uint8Array(c),y=new Array(m.length),R=0;R<m.length;R++)y[R]=String.fromCharCode(m[R]);return y.join("")}function re(c){if(c.slice)return c.slice(0);var m=new Uint8Array(c.byteLength);return m.set(new Uint8Array(c)),m.buffer}function z(){return this.bodyUsed=!1,this._initBody=function(c){this._bodyInit=c,c?typeof c=="string"?this._bodyText=c:r.blob&&Blob.prototype.isPrototypeOf(c)?this._bodyBlob=c:r.formData&&FormData.prototype.isPrototypeOf(c)?this._bodyFormData=c:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(c)?this._bodyText=c.toString():r.arrayBuffer&&r.blob&&i(c)?(this._bodyArrayBuffer=re(c.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(c)||l(c))?this._bodyArrayBuffer=re(c):this._bodyText=c=Object.prototype.toString.call(c):this._bodyText="",this.headers.get("content-type")||(typeof c=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(c)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var c=x(this);if(c)return c;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?x(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(X)}),this.text=function(){var c=x(this);if(c)return c;if(this._bodyBlob)return H(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve($(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(Ae)}),this.json=function(){return this.text().then(JSON.parse)},this}var P=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Y(c){var m=c.toUpperCase();return P.indexOf(m)>-1?m:c}function Q(c,m){m=m||{};var y=m.body;if(c instanceof Q){if(c.bodyUsed)throw new TypeError("Already read");this.url=c.url,this.credentials=c.credentials,m.headers||(this.headers=new g(c.headers)),this.method=c.method,this.mode=c.mode,this.signal=c.signal,!y&&c._bodyInit!=null&&(y=c._bodyInit,c.bodyUsed=!0)}else this.url=String(c);if(this.credentials=m.credentials||this.credentials||"same-origin",(m.headers||!this.headers)&&(this.headers=new g(m.headers)),this.method=Y(m.method||this.method||"GET"),this.mode=m.mode||this.mode||null,this.signal=m.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&y)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(y)}Q.prototype.clone=function(){return new Q(this,{body:this._bodyInit})};function Ae(c){var m=new FormData;return c.trim().split("&").forEach(function(y){if(y){var R=y.split("="),N=R.shift().replace(/\+/g," "),w=R.join("=").replace(/\+/g," ");m.append(decodeURIComponent(N),decodeURIComponent(w))}}),m}function Xe(c){var m=new g,y=c.replace(/\r?\n[\t ]+/g," ");return y.split(/\r?\n/).forEach(function(R){var N=R.split(":"),w=N.shift().trim();if(w){var $e=N.join(":").trim();m.append(w,$e)}}),m}z.call(Q.prototype);function q(c,m){m||(m={}),this.type="default",this.status=m.status===void 0?200:m.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in m?m.statusText:"OK",this.headers=new g(m.headers),this.url=m.url||"",this._initBody(c)}z.call(q.prototype),q.prototype.clone=function(){return new q(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},q.error=function(){var c=new q(null,{status:0,statusText:""});return c.type="error",c};var Tt=[301,302,303,307,308];q.redirect=function(c,m){if(Tt.indexOf(m)===-1)throw new RangeError("Invalid status code");return new q(null,{status:m,headers:{location:c}})},n.DOMException=e.DOMException;try{new n.DOMException}catch{n.DOMException=function(m,y){this.message=m,this.name=y;var R=Error(m);this.stack=R.stack},n.DOMException.prototype=Object.create(Error.prototype),n.DOMException.prototype.constructor=n.DOMException}function pe(c,m){return new Promise(function(y,R){var N=new Q(c,m);if(N.signal&&N.signal.aborted)return R(new n.DOMException("Aborted","AbortError"));var w=new XMLHttpRequest;function $e(){w.abort()}w.onload=function(){var _e={status:w.status,statusText:w.statusText,headers:Xe(w.getAllResponseHeaders()||"")};_e.url="responseURL"in w?w.responseURL:_e.headers.get("X-Request-URL");var xt="response"in w?w.response:w.responseText;y(new q(xt,_e))},w.onerror=function(){R(new TypeError("Network request failed"))},w.ontimeout=function(){R(new TypeError("Network request failed"))},w.onabort=function(){R(new n.DOMException("Aborted","AbortError"))},w.open(N.method,N.url,!0),N.credentials==="include"?w.withCredentials=!0:N.credentials==="omit"&&(w.withCredentials=!1),"responseType"in w&&r.blob&&(w.responseType="blob"),N.headers.forEach(function(_e,xt){w.setRequestHeader(xt,_e)}),N.signal&&(N.signal.addEventListener("abort",$e),w.onreadystatechange=function(){w.readyState===4&&N.signal.removeEventListener("abort",$e)}),w.send(typeof N._bodyInit=="undefined"?null:N._bodyInit)})}return pe.polyfill=!0,e.fetch||(e.fetch=pe,e.Headers=g,e.Request=Q,e.Response=q),n.Headers=g,n.Request=Q,n.Response=q,n.fetch=pe,Object.defineProperty(n,"__esModule",{value:!0}),n}({})})(Ye);Ye.fetch.ponyfill=!0;delete Ye.fetch.polyfill;var he=Ye;K=he.fetch;K.default=he.fetch;K.fetch=he.fetch;K.Headers=he.Headers;K.Request=he.Request;K.Response=he.Response;Tn.exports=K});var j=b((Hc,On)=>{"use strict";var Se=ze(),It=vn(),Bu=wn(),Ce=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:self;function ku(e,t){if(e==null)throw new TypeError('The constructor to "inherits" must not be null or undefined');if(t==null)throw new TypeError('The super constructor to "inherits" must not be null or undefined');if(t.prototype===void 0)throw new TypeError('The super constructor to "inherits" must have a prototype');e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function An(){return typeof window=="undefined"&&typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null}function Hu(e){var t=!!(typeof process!="undefined"&&process&&process.env);if(t&&process.env[e]!=null)return process.env[e]}function Uu(){var e=navigator.appName,t=""+parseFloat(navigator.appVersion),n,r,i;return(r=navigator.userAgent.indexOf("Opera"))!=-1?(e="Opera",t=navigator.userAgent.substring(r+6),(r=navigator.userAgent.indexOf("Version"))!=-1&&(t=navigator.userAgent.substring(r+8))):(r=navigator.userAgent.indexOf("MSIE"))!=-1?(e="Microsoft Internet Explorer",t=navigator.userAgent.substring(r+5)):e=="Netscape"&&navigator.userAgent.indexOf("Trident/")!=-1?(e="Microsoft Internet Explorer",t=navigator.userAgent.substring(r+5),(r=navigator.userAgent.indexOf("rv:"))!=-1&&(t=navigator.userAgent.substring(r+3))):(r=navigator.userAgent.indexOf("Chrome"))!=-1?(e="Chrome",t=navigator.userAgent.substring(r+7)):(r=navigator.userAgent.indexOf("Safari"))!=-1?(e="Safari",t=navigator.userAgent.substring(r+7),(r=navigator.userAgent.indexOf("Version"))!=-1&&(t=navigator.userAgent.substring(r+8)),navigator.userAgent.indexOf("CriOS")!=-1&&(e="Chrome")):(r=navigator.userAgent.indexOf("Firefox"))!=-1?(e="Firefox",t=navigator.userAgent.substring(r+8)):(n=navigator.userAgent.lastIndexOf(" ")+1)<(r=navigator.userAgent.lastIndexOf("/"))&&(e=navigator.userAgent.substring(n,r),t=navigator.userAgent.substring(r+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),(i=t.indexOf(";"))!=-1&&(t=t.substring(0,i)),(i=t.indexOf(" "))!=-1&&(t=t.substring(0,i)),(i=t.indexOf(")"))!=-1&&(t=t.substring(0,i)),[e,t].join("-")}function Wu(){var e="unknown",t=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Chrome OS",r:/CrOS/},{s:"Linux",r:/(Linux|X11(?!.*CrOS))/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var n in t){var r=t[n];if(r.r.test(navigator.userAgent)){e=r.s;break}}var i="unknown";switch(/Windows/.test(e)&&(i=/Windows (.*)/.exec(e)[1],e="Windows"),e){case"Mac OS":case"Mac OS X":case"Android":i=/(?:Android|Mac OS|Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh) ([\.\_\d]+)/.exec(navigator.userAgent)[1];break;case"iOS":i=/OS (\d+)_(\d+)_?(\d+)?/.exec(navigator.appVersion),i=i[1]+"."+i[2]+"."+(i[3]|0);break}return[e,i].join("-")}function Vu(){var e=[{name:"Netlify",check:function(){return process.env.hasOwnProperty("NETLIFY_IMAGES_CDN_DOMAIN")}},{name:"Vercel",check:function(){return process.env.hasOwnProperty("VERCEL")}},{name:"Heroku",check:function(){return process.env.hasOwnProperty("PATH")&&process.env.PATH.indexOf(".heroku")!==-1}},{name:"AWS Lambda",check:function(){return process.env.hasOwnProperty("AWS_LAMBDA_FUNCTION_VERSION")}},{name:"GCP Cloud Functions",check:function(){return process.env.hasOwnProperty("_")&&process.env._.indexOf("google")!==-1}},{name:"GCP Compute Instances",check:function(){return process.env.hasOwnProperty("GOOGLE_CLOUD_PROJECT")}},{name:"Azure Cloud Functions",check:function(){return process.env.hasOwnProperty("WEBSITE_FUNCTIONS_AZUREMONITOR_CATEGORIES")}},{name:"Azure Compute",check:function(){return process.env.hasOwnProperty("ORYX_ENV_TYPE")&&process.env.hasOwnProperty("WEBSITE_INSTANCE_ID")&&process.env.ORYX_ENV_TYPE==="AppService"}},{name:"Mongo Stitch",check:function(){return typeof Ce.StitchError=="function"}},{name:"Render",check:function(){return process.env.hasOwnProperty("RENDER_SERVICE_ID")}},{name:"Begin",check:function(){return process.env.hasOwnProperty("BEGIN_DATA_SCOPE_ID")}}],t=e.find(n=>n.check());return t?t.name:"unknown"}function Gu(e,t){return e===void 0?t:e}function Ju(e,t){var n={};for(var r in e){if(!(r in t))throw new Error("No such option "+r);n[r]=e[r]}for(var i in t)i in n||(n[i]=t[i]);return n}function Xu(e){var t={};for(var n in e){var r=e[n];r!=null&&(t[n]=r)}return t}function $u(e){var t={};for(var n in e){var r=e[n];r!==void 0&&(t[n]=r)}return t}function _n(e,t){return typeof e=="object"&&e!==null&&Boolean(e[t])}function zu(e,t,n){return n=typeof n=="object"?Sn(n):n,[e,t?t.charAt(0)==="/"?"":"/"+t:"",n?n.charAt(0)==="?"?"":"?"+n:""].join("")}function Sn(e,t){t=t||"";var n=[],r,i;typeof t!="string"&&(t="?");for(i in e)if(_n(e,i)){if(r=e[i],!r&&(r==null||isNaN(r))&&(r=""),i=Cn(i),r=Cn(r),i===null||r===null)continue;n.push(i+"="+r)}return n.length?t+n.join("&"):""}function Cn(e){try{return encodeURIComponent(e)}catch{return null}}function Yu(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n}function In(e){return typeof e=="function"?e:typeof Ce.fetch=="function"?Ce.fetch.bind(Ce):xn()}function Qu(){var e;return n=>{if(!An()||e||!n)return;function r(i){var u=i>Se.version;u&&console.info(Bu("New "+Se.name+" version available "+It.dim(Se.version)+It.reset(" \u2192 ")+It.green(i)+`
Changelog: https://github.com/${Se.repository}/blob/main/CHANGELOG.md`,{padding:1,borderColor:"yellow"}))}e=!0,In()("https://registry.npmjs.org/"+Se.name).then(i=>i.json()).then(i=>r(i["dist-tags"].latest)).catch(i=>{console.error("Unable to check new driver version"),console.error(i)})}}On.exports={notifyAboutNewVersion:Qu,crossGlobal:Ce,mergeObjects:Yu,formatUrl:zu,querystringify:Sn,inherits:ku,isNodeEnv:An,getEnvVariable:Hu,defaults:Gu,applyDefaults:Ju,removeNullAndUndefinedValues:Xu,removeUndefinedValues:$u,checkInstanceHasProperty:_n,getBrowserDetails:Uu,getBrowserOsDetails:Wu,getNodeRuntimeEnv:Vu,resolveFetch:In}});var Ke=b((Uc,Ln)=>{"use strict";var Ku=j();function ge(e){this.raw=e}ge.prototype._isFaunaExpr=!0;ge.prototype.toJSON=function(){return this.raw};ge.prototype.toFQL=function(){return E(this.raw)};var Zu=["Do","Call","Union","Intersection","Difference","Equals","Add","BitAnd","BitOr","BitXor","Divide","Max","Min","Modulo","Multiply","Subtract","LT","LTE","GT","GTE","And","Or"],Nn={containsstrregex:"ContainsStrRegex",endswith:"EndsWith",findstr:"FindStr",findstrregex:"FindStrRegex",gt:"GT",gte:"GTE",is_nonempty:"is_non_empty",lowercase:"LowerCase",lt:"LT",lte:"LTE",ltrim:"LTrim",ngram:"NGram",rtrim:"RTrim",regexescape:"RegexEscape",replacestr:"ReplaceStr",replacestrregex:"ReplaceStrRegex",startswith:"StartsWith",substring:"SubString",titlecase:"TitleCase",uppercase:"UpperCase"};function Rn(e){return e instanceof ge||Ku.checkInstanceHasProperty(e,"_isFaunaExpr")}function Qe(e){return"{"+Object.keys(e).map(function(t){return'"'+t+'": '+E(e[t])}).join(", ")+"}"}function Ot(e,t){return e.map(function(n){return t(n)}).join(", ")}function el(e){return e in Nn&&(e=Nn[e]),e.split("_").map(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}).join("")}var E=function(e,t){if(Rn(e)){if("value"in e)return e.toString();e=e.raw}if(e===null)return"null";switch(typeof e){case"string":return JSON.stringify(e);case"symbol":case"number":case"boolean":return e.toString();case"undefined":return"undefined"}if(Array.isArray(e)){var n=Ot(e,E);return Zu.indexOf(t)!=-1?n:"["+n+"]"}if("match"in e){var r=E(e.match),i=e.terms||[];return Rn(i)&&(i=i.raw),Array.isArray(i)&&i.length==0?"Match("+r+")":Array.isArray(i)?"Match("+r+", ["+Ot(i,E)+"])":"Match("+r+", "+E(i)+")"}if("paginate"in e){var u=Object.keys(e);if(u.length===1)return"Paginate("+E(e.paginate)+")";var l=Object.assign({},e);return delete l.paginate,"Paginate("+E(e.paginate)+", "+Qe(l)+")"}if("let"in e&&"in"in e){var d="";return Array.isArray(e.let)?d="["+Ot(e.let,Qe)+"]":d=Qe(e.let),"Let("+d+", "+E(e.in)+")"}if("object"in e)return Qe(e.object);if("merge"in e)return e.lambda?"Merge("+E(e.merge)+", "+E(e.with)+", "+E(e.lambda)+")":"Merge("+E(e.merge)+", "+E(e.with)+")";if("lambda"in e)return"Lambda("+E(e.lambda)+", "+E(e.expr)+")";if("filter"in e)return"Filter("+E(e.collection)+", "+E(e.filter)+")";if("call"in e)return"Call("+E(e.call)+", "+E(e.arguments)+")";if("map"in e)return"Map("+E(e.collection)+", "+E(e.map)+")";if("foreach"in e)return"Foreach("+E(e.collection)+", "+E(e.foreach)+")";var p=Object.keys(e),h=p[0];h=el(h);var g=p.filter(x=>e[x]!==null||p.length>1).map(x=>E(e[x],h)).join(", ");return h+"("+g+")"};ge.toString=E;Ln.exports=ge});var ae=b((Wc,qn)=>{"use strict";var D=j();function M(e,t,n){Error.call(this),this.name=e,this.message=t,this.description=n}D.inherits(M,Error);function Dn(e){M.call(this,"InvalidValue",e)}D.inherits(Dn,M);function Fn(e,t,n,r){var i=`${r} function requires ${l(e,t)} argument(s) but ${n} were given`,u=d(r);M.call(this,"InvalidArity",`${i}
${u}`),this.min=e,this.max=t,this.actual=n;function l(p,h){return h===null?"at least "+p:p===null?"up to "+h:p===h?p:"from "+p+" to "+h}function d(p){var h="https://docs.fauna.com/fauna/current/api/fql/functions/";return`For more info, see the docs: ${h}${p.toLowerCase()}`}}D.inherits(Fn,M);function C(e,t){var n=t.responseContent,r=n.errors,i=r.length===0?'(empty "errors")':r[0].code,u=r.length===0?'(empty "errors")':r[0].description;M.call(this,e,i,u),this.requestResult=t}D.inherits(C,M);C.prototype.errors=function(){return this.requestResult.responseContent.errors};C.raiseForStatusCode=function(e){var t=e.statusCode;if(t<200||t>=300)switch(t){case 400:throw new Nt(e);case 401:throw new Rt(e);case 403:throw new Lt(e);case 404:throw new Dt(e);case 405:throw new Ft(e);case 429:throw new Mt(e);case 500:throw new Pt(e);case 503:throw new jt(e);default:throw new C("UnknownError",e)}};function Nt(e){C.call(this,"BadRequest",e)}D.inherits(Nt,C);function Rt(e){C.call(this,"Unauthorized",e)}D.inherits(Rt,C);function Lt(e){C.call(this,"PermissionDenied",e)}D.inherits(Lt,C);function Dt(e){C.call(this,"NotFound",e)}D.inherits(Dt,C);function Ft(e){C.call(this,"MethodNotAllowed",e)}D.inherits(Ft,C);function Mt(e){C.call(this,"TooManyRequests",e)}D.inherits(Mt,C);function Pt(e){C.call(this,"InternalError",e)}D.inherits(Pt,C);function jt(e){C.call(this,"UnavailableError",e)}D.inherits(jt,C);function Ze(e,t,n){M.call(this,e,t,n)}D.inherits(Ze,M);function Mn(e){M.call(this,"StreamsNotSupported","streams not supported",e)}D.inherits(Mn,Ze);function Pn(e){var t=e.data||{};M.call(this,"StreamErrorEvent",t.code,t.description),this.event=e}D.inherits(Pn,Ze);function jn(e,t){M.call(this,"ClientClosed",e,t)}D.inherits(jn,M);qn.exports={FaunaError:M,ClientClosed:jn,FaunaHTTPError:C,InvalidValue:Dn,InvalidArity:Fn,BadRequest:Nt,Unauthorized:Rt,PermissionDenied:Lt,NotFound:Dt,MethodNotAllowed:Ft,TooManyRequests:Mt,InternalError:Pt,UnavailableError:jt,StreamError:Ze,StreamsNotSupported:Mn,StreamErrorEvent:Pn}});var Hn=b(et=>{"use strict";et.byteLength=nl;et.toByteArray=al;et.fromByteArray=ol;var V=[],B=[],tl=typeof Uint8Array!="undefined"?Uint8Array:Array,qt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(le=0,Bn=qt.length;le<Bn;++le)V[le]=qt[le],B[qt.charCodeAt(le)]=le;var le,Bn;B["-".charCodeAt(0)]=62;B["_".charCodeAt(0)]=63;function kn(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function nl(e){var t=kn(e),n=t[0],r=t[1];return(n+r)*3/4-r}function rl(e,t,n){return(t+n)*3/4-n}function al(e){var t,n=kn(e),r=n[0],i=n[1],u=new tl(rl(e,r,i)),l=0,d=i>0?r-4:r,p;for(p=0;p<d;p+=4)t=B[e.charCodeAt(p)]<<18|B[e.charCodeAt(p+1)]<<12|B[e.charCodeAt(p+2)]<<6|B[e.charCodeAt(p+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=t&255;return i===2&&(t=B[e.charCodeAt(p)]<<2|B[e.charCodeAt(p+1)]>>4,u[l++]=t&255),i===1&&(t=B[e.charCodeAt(p)]<<10|B[e.charCodeAt(p+1)]<<4|B[e.charCodeAt(p+2)]>>2,u[l++]=t>>8&255,u[l++]=t&255),u}function il(e){return V[e>>18&63]+V[e>>12&63]+V[e>>6&63]+V[e&63]}function sl(e,t,n){for(var r,i=[],u=t;u<n;u+=3)r=(e[u]<<16&16711680)+(e[u+1]<<8&65280)+(e[u+2]&255),i.push(il(r));return i.join("")}function ol(e){for(var t,n=e.length,r=n%3,i=[],u=16383,l=0,d=n-r;l<d;l+=u)i.push(sl(e,l,l+u>d?d:l+u));return r===1?(t=e[n-1],i.push(V[t>>2]+V[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(V[t>>10]+V[t>>4&63]+V[t<<2&63]+"=")),i.join("")}});var Un=b(()=>{});var Ne=b((Xc,Vn)=>{"use strict";var Bt=Hn(),ul=Ct(),kt=ae(),Ht=Ke(),Z=j(),tt=Z.isNodeEnv()?Un():null,Wn=tt&&tt.inspect.custom,ll=tt?tt.inspect:JSON.stringify;function ee(){}ee.prototype._isFaunaValue=!0;Z.inherits(ee,Ht);function I(e,t,n){if(!e)throw new kt.InvalidValue("id cannot be null or undefined");this.value={id:e},t&&(this.value.collection=t),n&&(this.value.database=n)}I.prototype._isFaunaRef=!0;Z.inherits(I,ee);Object.defineProperty(I.prototype,"collection",{get:function(){return this.value.collection}});Object.defineProperty(I.prototype,"class",{get:ul(function(){return this.value.collection},"class is deprecated, use collection instead")});Object.defineProperty(I.prototype,"database",{get:function(){return this.value.database}});Object.defineProperty(I.prototype,"id",{get:function(){return this.value.id}});I.prototype.toJSON=function(){return{"@ref":this.value}};ye(I,function(){var e={collections:"Collection",databases:"Database",indexes:"Index",functions:"Function",roles:"Role",access_providers:"AccessProvider"},t=function(r){return r.collection===void 0},n=function(r){if(t(r)){var i=r.database!==void 0?r.database.toString():"";return r.id==="access_providers"?"AccessProviders("+i+")":r.id.charAt(0).toUpperCase()+r.id.slice(1)+"("+i+")"}if(t(r.collection)){var u=e[r.collection.id];if(u!==void 0){var i=r.database!==void 0?", "+r.database.toString():"";return u+'("'+r.id+'"'+i+")"}}return"Ref("+n(r.collection)+', "'+r.id+'")'};return n(this)});I.prototype.valueOf=function(){return this.value};I.prototype.equals=function(e){return(e instanceof I||Z.checkInstanceHasProperty(e,"_isFaunaRef"))&&this.id===e.id&&(this.collection===void 0&&e.collection===void 0||this.collection.equals(e.collection))&&(this.database===void 0&&e.database===void 0||this.database.equals(e.database))};var te={COLLECTIONS:new I("collections"),INDEXES:new I("indexes"),DATABASES:new I("databases"),FUNCTIONS:new I("functions"),ROLES:new I("roles"),KEYS:new I("keys"),ACCESS_PROVIDERS:new I("access_providers")};te.fromName=function(e){switch(e){case"collections":return te.COLLECTIONS;case"indexes":return te.INDEXES;case"databases":return te.DATABASES;case"functions":return te.FUNCTIONS;case"roles":return te.ROLES;case"keys":return te.KEYS;case"access_providers":return te.ACCESS_PROVIDERS}return new I(e)};function nt(e){this.value=e}Z.inherits(nt,ee);ye(nt,function(){return Ht.toString(this.value)});nt.prototype.toJSON=function(){return{"@set":this.value}};function Ie(e){if(e instanceof Date)e=e.toISOString();else if(e.charAt(e.length-1)!=="Z")throw new kt.InvalidValue("Only allowed timezone is 'Z', got: "+e);this.value=e}Z.inherits(Ie,ee);Object.defineProperty(Ie.prototype,"date",{get:function(){return new Date(this.value)}});ye(Ie,function(){return'Time("'+this.value+'")'});Ie.prototype.toJSON=function(){return{"@ts":this.value}};function Oe(e){e instanceof Date&&(e=e.toISOString().slice(0,10)),this.value=e}Z.inherits(Oe,ee);Object.defineProperty(Oe.prototype,"date",{get:function(){return new Date(this.value)}});ye(Oe,function(){return'Date("'+this.value+'")'});Oe.prototype.toJSON=function(){return{"@date":this.value}};function rt(e){if(e instanceof ArrayBuffer)this.value=new Uint8Array(e);else if(typeof e=="string")this.value=Bt.toByteArray(e);else if(e instanceof Uint8Array)this.value=e;else throw new kt.InvalidValue("Bytes type expect argument to be either Uint8Array|ArrayBuffer|string, got: "+ll(e))}Z.inherits(rt,ee);ye(rt,function(){return'Bytes("'+Bt.fromByteArray(this.value)+'")'});rt.prototype.toJSON=function(){return{"@bytes":Bt.fromByteArray(this.value)}};function at(e){this.value=e}Z.inherits(at,ee);ye(at,function(){return"Query("+Ht.toString(this.value)+")"});at.prototype.toJSON=function(){return{"@query":this.value}};function ye(e,t){e.prototype.toString=t,e.prototype.inspect=t,Wn&&(e.prototype[Wn]=t)}Vn.exports={Value:ee,Ref:I,Native:te,SetRef:nt,FaunaTime:Ie,FaunaDate:Oe,Bytes:rt,Query:at}});var Ut=b(($c,Jn)=>{"use strict";var Gn=Object.getOwnPropertySymbols,cl=Object.prototype.hasOwnProperty,fl=Object.prototype.propertyIsEnumerable;function dl(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function ml(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(u){return t[u]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(u){i[u]=u}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}Jn.exports=ml()?Object.assign:function(e,t){for(var n,r=dl(e),i,u=1;u<arguments.length;u++){n=Object(arguments[u]);for(var l in n)cl.call(n,l)&&(r[l]=n[l]);if(Gn){i=Gn(n);for(var d=0;d<i.length;d++)fl.call(n,i[d])&&(r[i[d]]=n[i[d]])}}return r}});var Re=b((zc,Ps)=>{"use strict";var pl=yn(),ie=Ct(),s=Ke(),Wt=ae(),Xn=Ne(),hl=Ut(),v=j();function $n(){switch(o.between(1,2,arguments,$n.name),arguments.length){case 1:return new s({"@ref":a(arguments[0])});case 2:return new s({ref:a(arguments[0]),id:a(arguments[1])})}}function zn(e){return o.exact(1,arguments,zn.name),new Xn.Bytes(e)}function Yn(e){return o.exact(1,arguments,Yn.name),new s({abort:a(e)})}function Qn(e,t){return o.exact(2,arguments,Qn.name),new s({at:a(e),expr:a(t)})}function Kn(e,t){o.exact(2,arguments,Kn.name);var n=[];if(Array.isArray(e)?n=e.map(function(i){return st(i)}):n=Object.keys(e).filter(function(i){return e[i]!==void 0}).map(function(i){var u={};return u[i]=a(e[i]),u}),typeof t=="function")if(Array.isArray(e)){var r=[];e.forEach(function(i){Object.keys(i).forEach(function(u){r.push(be(u))})}),t=t.apply(null,r)}else t=t.apply(null,Object.keys(e).map(function(i){return be(i)}));return new s({let:n,in:a(t)})}function be(e){return o.exact(1,arguments,be.name),new s({var:a(e)})}function Zn(e,t,n){return o.exact(3,arguments,Zn.name),new s({if:a(e),then:a(t),else:a(n)})}function er(){o.min(1,arguments,er.name);var e=it(arguments);return new s({do:a(e)})}var tr=function(e){return o.exact(1,arguments,tr.name),new s({object:st(e)})};function Vt(){switch(o.between(1,2,arguments,Vt.name),arguments.length){case 1:var e=arguments[0];if(typeof e=="function")return gl(e);if(e instanceof s||v.checkInstanceHasProperty(e,"_isFaunaExpr"))return e;throw new Wt.InvalidValue("Lambda function takes either a Function or an Expr.");case 2:var t=arguments[0],n=arguments[1];return Gt(t,n)}}function gl(e){var t=pl(e);switch(t.length){case 0:throw new Wt.InvalidValue("Provided Function must take at least 1 argument.");case 1:return Gt(t[0],e(be(t[0])));default:return Gt(t,e.apply(null,t.map(function(n){return be(n)})))}}function Gt(e,t){return new s({lambda:a(e),expr:a(t)})}function nr(e){o.min(1,arguments,nr.name);var t=it(arguments);return t.shift(),new s({call:a(e),arguments:a(_(t))})}function rr(e){return o.exact(1,arguments,rr.name),new s({query:a(e)})}function ar(e,t){return o.exact(2,arguments,ar.name),new s({map:a(t),collection:a(e)})}function ir(e,t){return o.exact(2,arguments,ir.name),new s({foreach:a(t),collection:a(e)})}function sr(e,t){return o.exact(2,arguments,sr.name),new s({filter:a(t),collection:a(e)})}function or(e,t){return o.exact(2,arguments,or.name),new s({take:a(e),collection:a(t)})}function ur(e,t){return o.exact(2,arguments,ur.name),new s({drop:a(e),collection:a(t)})}function lr(e,t){return o.exact(2,arguments,lr.name),new s({prepend:a(e),collection:a(t)})}function cr(e,t){return o.exact(2,arguments,cr.name),new s({append:a(e),collection:a(t)})}function fr(e){return o.exact(1,arguments,fr.name),new s({is_empty:a(e)})}function dr(e){return o.exact(1,arguments,dr.name),new s({is_nonempty:a(e)})}function mr(e){return o.exact(1,arguments,mr.name),new s({is_number:a(e)})}function pr(e){return o.exact(1,arguments,pr.name),new s({is_double:a(e)})}function hr(e){return o.exact(1,arguments,hr.name),new s({is_integer:a(e)})}function gr(e){return o.exact(1,arguments,gr.name),new s({is_boolean:a(e)})}function yr(e){return o.exact(1,arguments,yr.name),new s({is_null:a(e)})}function br(e){return o.exact(1,arguments,br.name),new s({is_bytes:a(e)})}function vr(e){return o.exact(1,arguments,vr.name),new s({is_timestamp:a(e)})}function wr(e){return o.exact(1,arguments,wr.name),new s({is_date:a(e)})}function Er(e){return o.exact(1,arguments,Er.name),new s({is_string:a(e)})}function Tr(e){return o.exact(1,arguments,Tr.name),new s({is_array:a(e)})}function xr(e){return o.exact(1,arguments,xr.name),new s({is_object:a(e)})}function Ar(e){return o.exact(1,arguments,Ar.name),new s({is_ref:a(e)})}function _r(e){return o.exact(1,arguments,_r.name),new s({is_set:a(e)})}function Sr(e){return o.exact(1,arguments,Sr.name),new s({is_doc:a(e)})}function Cr(e){return o.exact(1,arguments,Cr.name),new s({is_lambda:a(e)})}function Ir(e){return o.exact(1,arguments,Ir.name),new s({is_collection:a(e)})}function Or(e){return o.exact(1,arguments,Or.name),new s({is_database:a(e)})}function Nr(e){return o.exact(1,arguments,Nr.name),new s({is_index:a(e)})}function Rr(e){return o.exact(1,arguments,Rr.name),new s({is_function:a(e)})}function Lr(e){return o.exact(1,arguments,Lr.name),new s({is_key:a(e)})}function Dr(e){return o.exact(1,arguments,Dr.name),new s({is_token:a(e)})}function Fr(e){return o.exact(1,arguments,Fr.name),new s({is_credentials:a(e)})}function Mr(e){return o.exact(1,arguments,Mr.name),new s({is_role:a(e)})}function Pr(e,t){return o.between(1,2,arguments,Pr.name),t=v.defaults(t,null),new s(F({get:a(e)},{ts:a(t)}))}function jr(e){return o.exact(1,arguments,jr.name),new s({key_from_secret:a(e)})}function qr(e,t,n){return o.exact(3,arguments,qr.name),new s({reduce:a(e),initial:a(t),collection:a(n)})}function Br(e,t){return o.between(1,2,arguments,Br.name),t=v.defaults(t,{}),new s(hl({paginate:a(e)},st(t)))}function kr(e,t){return o.between(1,2,arguments,kr.name),t=v.defaults(t,null),new s(F({exists:a(e)},{ts:a(t)}))}function Hr(e,t){return o.between(1,2,arguments,Hr.name),new s({create:a(e),params:a(t)})}function Ur(e,t){return o.exact(2,arguments,Ur.name),new s({update:a(e),params:a(t)})}function Wr(e,t){return o.exact(2,arguments,Wr.name),new s({replace:a(e),params:a(t)})}function Vr(e){return o.exact(1,arguments,Vr.name),new s({delete:a(e)})}function Gr(e,t,n,r){return o.exact(4,arguments,Gr.name),new s({insert:a(e),ts:a(t),action:a(n),params:a(r)})}function Jr(e,t,n){return o.exact(3,arguments,Jr.name),new s({remove:a(e),ts:a(t),action:a(n)})}function Xr(e){return o.exact(1,arguments,Xr.name),new s({create_class:a(e)})}function $r(e){return o.exact(1,arguments,$r.name),new s({create_collection:a(e)})}function zr(e){return o.exact(1,arguments,zr.name),new s({create_database:a(e)})}function Yr(e){return o.exact(1,arguments,Yr.name),new s({create_index:a(e)})}function Qr(e){return o.exact(1,arguments,Qr.name),new s({create_key:a(e)})}function Kr(e){return o.exact(1,arguments,Kr.name),new s({create_function:a(e)})}function Zr(e){return o.exact(1,arguments,Zr.name),new s({create_role:a(e)})}function ea(e){return o.exact(1,arguments,ea.name),new s({create_access_provider:a(e)})}function ta(e){return o.exact(1,arguments,ta.name),new s({singleton:a(e)})}function na(e){return o.exact(1,arguments,na.name),new s({events:a(e)})}function ra(e){o.min(1,arguments,ra.name);var t=it(arguments);return t.shift(),new s({match:a(e),terms:a(_(t))})}function aa(){return o.min(1,arguments,aa.name),new s({union:a(_(arguments))})}function ia(e,t,n){return o.between(2,3,arguments,ia.name),new s(F({merge:a(e),with:a(t)},{lambda:a(n)}))}function sa(){return o.min(1,arguments,sa.name),new s({intersection:a(_(arguments))})}function oa(){return o.min(1,arguments,oa.name),new s({difference:a(_(arguments))})}function ua(e){return o.exact(1,arguments,ua.name),new s({distinct:a(e)})}function la(e,t){return o.exact(2,arguments,la.name),new s({join:a(e),with:a(t)})}function ca(e,t,n){return o.exact(3,arguments,ca.name),new s({range:a(e),from:a(t),to:a(n)})}function fa(e,t){return o.exact(2,arguments,fa.name),new s({login:a(e),params:a(t)})}function da(e){return o.exact(1,arguments,da.name),new s({logout:a(e)})}function ma(e,t){return o.exact(2,arguments,ma.name),new s({identify:a(e),password:a(t)})}function pa(){return o.exact(0,arguments,pa.name),new s({identity:null})}function ha(){return o.exact(0,arguments,ha.name),new s({current_identity:null})}function ga(){return o.exact(0,arguments,ga.name),new s({has_identity:null})}function ya(){return o.exact(0,arguments,ya.name),new s({has_current_identity:null})}function ba(){return o.exact(0,arguments,ba.name),new s({current_token:null})}function va(){return o.exact(0,arguments,va.name),new s({has_current_token:null})}function wa(e,t){return o.min(1,arguments,wa.name),t=v.defaults(t,null),new s(F({concat:a(e)},{separator:a(t)}))}function Ea(e,t){return o.min(1,arguments,Ea.name),new s(F({casefold:a(e)},{normalizer:a(t)}))}function Ta(e,t){return o.exact(2,arguments,Ta.name),new s({containsstr:a(e),search:a(t)})}function xa(e,t){return o.exact(2,arguments,xa.name),new s({containsstrregex:a(e),pattern:a(t)})}function Aa(e,t){return o.exact(2,arguments,Aa.name),new s({startswith:a(e),search:a(t)})}function _a(e,t){return o.exact(2,arguments,_a.name),new s({endswith:a(e),search:a(t)})}function Sa(e){return o.exact(1,arguments,Sa.name),new s({regexescape:a(e)})}function Ca(e,t,n){return o.between(2,3,arguments,Ca.name),n=v.defaults(n,null),new s(F({findstr:a(e),find:a(t)},{start:a(n)}))}function Ia(e,t,n,r){return o.between(2,4,arguments,Ia.name),n=v.defaults(n,null),new s(F({findstrregex:a(e),pattern:a(t)},{start:a(n),num_results:a(r)}))}function Oa(e){return o.exact(1,arguments,Oa.name),new s({length:a(e)})}function Na(e){return o.exact(1,arguments,Na.name),new s({lowercase:a(e)})}function Ra(e){return o.exact(1,arguments,Ra.name),new s({ltrim:a(e)})}function La(e,t,n){return o.between(1,3,arguments,La.name),t=v.defaults(t,null),n=v.defaults(n,null),new s(F({ngram:a(e)},{min:a(t),max:a(n)}))}function Da(e,t){return o.between(1,2,arguments,Da.name),t=v.defaults(t,null),new s(F({repeat:a(e)},{number:a(t)}))}function Fa(e,t,n){return o.exact(3,arguments,Fa.name),new s({replacestr:a(e),find:a(t),replace:a(n)})}function Ma(e,t,n,r){return o.between(3,4,arguments,Ma.name),r=v.defaults(r,null),new s(F({replacestrregex:a(e),pattern:a(t),replace:a(n)},{first:a(r)}))}function Pa(e){return o.exact(1,arguments,Pa.name),new s({rtrim:a(e)})}function ja(e){return o.exact(1,arguments,ja.name),new s({space:a(e)})}function qa(e,t,n){return o.between(1,3,arguments,qa.name),t=v.defaults(t,null),n=v.defaults(n,null),new s(F({substring:a(e)},{start:a(t),length:a(n)}))}function Ba(e){return o.exact(1,arguments,Ba.name),new s({titlecase:a(e)})}function ka(e){return o.exact(1,arguments,ka.name),new s({trim:a(e)})}function Ha(e){return o.exact(1,arguments,Ha.name),new s({uppercase:a(e)})}function Ua(e){o.min(1,arguments,Ua.name);var t=it(arguments);return t.shift(),new s({format:a(e),values:a(_(t))})}function Wa(e){return o.exact(1,arguments,Wa.name),new s({time:a(e)})}function Va(e,t){return o.exact(2,arguments,Va.name),new s({epoch:a(e),unit:a(t)})}function Ga(e,t,n){return o.exact(3,arguments,Ga.name),new s({time_add:a(e),offset:a(t),unit:a(n)})}function Ja(e,t,n){return o.exact(3,arguments,Ja.name),new s({time_subtract:a(e),offset:a(t),unit:a(n)})}function Xa(e,t,n){return o.exact(3,arguments,Xa.name),new s({time_diff:a(e),other:a(t),unit:a(n)})}function $a(e){return o.exact(1,arguments,$a.name),new s({date:a(e)})}function za(){return o.exact(0,arguments,za.name),new s({now:a(null)})}function Ya(){return o.exact(0,arguments,Ya.name),new s({next_id:null})}function Qa(){return o.exact(0,arguments,Qa.name),new s({new_id:null})}function Ka(e,t){switch(o.between(1,2,arguments,Ka.name),arguments.length){case 1:return new s({database:a(e)});case 2:return new s({database:a(e),scope:a(t)})}}function Za(e,t){switch(o.between(1,2,arguments,Za.name),arguments.length){case 1:return new s({index:a(e)});case 2:return new s({index:a(e),scope:a(t)})}}function ei(e,t){switch(o.between(1,2,arguments,ei.name),arguments.length){case 1:return new s({class:a(e)});case 2:return new s({class:a(e),scope:a(t)})}}function ti(e,t){switch(o.between(1,2,arguments,ti.name),arguments.length){case 1:return new s({collection:a(e)});case 2:return new s({collection:a(e),scope:a(t)})}}function ni(e,t){switch(o.between(1,2,arguments,ni.name),arguments.length){case 1:return new s({function:a(e)});case 2:return new s({function:a(e),scope:a(t)})}}function ri(e,t){return o.between(1,2,arguments,ri.name),t=v.defaults(t,null),new s(F({role:a(e)},{scope:a(t)}))}function ai(e){return o.max(1,arguments,ai.name),e=v.defaults(e,null),new s({access_providers:a(e)})}function ii(e){return o.max(1,arguments,ii.name),e=v.defaults(e,null),new s({classes:a(e)})}function si(e){return o.max(1,arguments,si.name),e=v.defaults(e,null),new s({collections:a(e)})}function oi(e){return o.max(1,arguments,oi.name),e=v.defaults(e,null),new s({databases:a(e)})}function ui(e){return o.max(1,arguments,ui.name),e=v.defaults(e,null),new s({indexes:a(e)})}function li(e){return o.max(1,arguments,li.name),e=v.defaults(e,null),new s({functions:a(e)})}function ci(e){return o.max(1,arguments,ci.name),e=v.defaults(e,null),new s({roles:a(e)})}function fi(e){return o.max(1,arguments,fi.name),e=v.defaults(e,null),new s({keys:a(e)})}function di(e){return o.max(1,arguments,di.name),e=v.defaults(e,null),new s({tokens:a(e)})}function mi(e){return o.max(1,arguments,mi.name),e=v.defaults(e,null),new s({credentials:a(e)})}function pi(){return o.min(1,arguments,pi.name),new s({equals:a(_(arguments))})}function hi(e,t){return o.exact(2,arguments,hi.name),new s({contains:a(e),in:a(t)})}function gi(e,t){return o.exact(2,arguments,gi.name),new s({contains_value:a(e),in:a(t)})}function yi(e,t){return o.exact(2,arguments,yi.name),new s({contains_field:a(e),in:a(t)})}function bi(e,t){return o.exact(2,arguments,bi.name),new s({contains_path:a(e),in:a(t)})}function vi(e,t,n){o.between(2,3,arguments,vi.name);var r={select:a(e),from:a(t)};return n!==void 0&&(r.default=a(n)),new s(r)}function wi(e,t){return o.exact(2,arguments,wi.name),new s({select_all:a(e),from:a(t)})}function Ei(e){return o.exact(1,arguments,Ei.name),new s({abs:a(e)})}function Ti(){return o.min(1,arguments,Ti.name),new s({add:a(_(arguments))})}function xi(){return o.min(1,arguments,xi.name),new s({bitand:a(_(arguments))})}function Ai(e){return o.exact(1,arguments,Ai.name),new s({bitnot:a(e)})}function _i(){return o.min(1,arguments,_i.name),new s({bitor:a(_(arguments))})}function Si(){return o.min(1,arguments,Si.name),new s({bitxor:a(_(arguments))})}function Ci(e){return o.exact(1,arguments,Ci.name),new s({ceil:a(e)})}function Ii(){return o.min(1,arguments,Ii.name),new s({divide:a(_(arguments))})}function Oi(e){return o.exact(1,arguments,Oi.name),new s({floor:a(e)})}function Ni(){return o.min(1,arguments,Ni.name),new s({max:a(_(arguments))})}function Ri(){return o.min(1,arguments,Ri.name),new s({min:a(_(arguments))})}function Li(){return o.min(1,arguments,Li.name),new s({modulo:a(_(arguments))})}function Di(){return o.min(1,arguments,Di.name),new s({multiply:a(_(arguments))})}function Fi(e,t){return o.min(1,arguments,Fi.name),t=v.defaults(t,null),new s(F({round:a(e)},{precision:a(t)}))}function Mi(){return o.min(1,arguments,Mi.name),new s({subtract:a(_(arguments))})}function Pi(e){return o.exact(1,arguments,Pi.name),new s({sign:a(e)})}function ji(e){return o.exact(1,arguments,ji.name),new s({sqrt:a(e)})}function qi(e,t){return o.min(1,arguments,qi.name),t=v.defaults(t,null),new s(F({trunc:a(e)},{precision:a(t)}))}function Bi(e){return o.exact(1,arguments,Bi.name),new s({count:a(e)})}function ki(e){return o.exact(1,arguments,ki.name),new s({sum:a(e)})}function Hi(e){return o.exact(1,arguments,Hi.name),new s({mean:a(e)})}function Ui(e){return o.exact(1,arguments,Ui.name),new s({any:a(e)})}function Wi(e){return o.exact(1,arguments,Wi.name),new s({all:a(e)})}function Vi(e){return o.exact(1,arguments,Vi.name),new s({acos:a(e)})}function Gi(e){return o.exact(1,arguments,Gi.name),new s({asin:a(e)})}function Ji(e){return o.exact(1,arguments,Ji.name),new s({atan:a(e)})}function Xi(e){return o.exact(1,arguments,Xi.name),new s({cos:a(e)})}function $i(e){return o.exact(1,arguments,$i.name),new s({cosh:a(e)})}function zi(e){return o.exact(1,arguments,zi.name),new s({degrees:a(e)})}function Yi(e){return o.exact(1,arguments,Yi.name),new s({exp:a(e)})}function Qi(e,t){return o.min(1,arguments,Qi.name),t=v.defaults(t,null),new s(F({hypot:a(e)},{b:a(t)}))}function Ki(e){return o.exact(1,arguments,Ki.name),new s({ln:a(e)})}function Zi(e){return o.exact(1,arguments,Zi.name),new s({log:a(e)})}function es(e,t){return o.min(1,arguments,es.name),t=v.defaults(t,null),new s(F({pow:a(e)},{exp:a(t)}))}function ts(e){return o.exact(1,arguments,ts.name),new s({radians:a(e)})}function ns(e){return o.exact(1,arguments,ns.name),new s({sin:a(e)})}function rs(e){return o.exact(1,arguments,rs.name),new s({sinh:a(e)})}function as(e){return o.exact(1,arguments,as.name),new s({tan:a(e)})}function is(e){return o.exact(1,arguments,is.name),new s({tanh:a(e)})}function ss(){return o.min(1,arguments,ss.name),new s({lt:a(_(arguments))})}function os(){return o.min(1,arguments,os.name),new s({lte:a(_(arguments))})}function us(){return o.min(1,arguments,us.name),new s({gt:a(_(arguments))})}function ls(){return o.min(1,arguments,ls.name),new s({gte:a(_(arguments))})}function cs(){return o.min(1,arguments,cs.name),new s({and:a(_(arguments))})}function fs(){return o.min(1,arguments,fs.name),new s({or:a(_(arguments))})}function ds(e){return o.exact(1,arguments,ds.name),new s({not:a(e)})}function ms(e){return o.exact(1,arguments,ms.name),new s({to_string:a(e)})}function ps(e){return o.exact(1,arguments,ps.name),new s({to_number:a(e)})}function hs(e){return o.exact(1,arguments,hs.name),new s({to_object:a(e)})}function gs(e){return o.exact(1,arguments,gs.name),new s({to_array:a(e)})}function ys(e){return o.exact(1,arguments,ys.name),new s({to_double:a(e)})}function bs(e){return o.exact(1,arguments,bs.name),new s({to_integer:a(e)})}function vs(e){return o.exact(1,arguments,vs.name),new s({to_time:a(e)})}function ws(e){return o.exact(1,arguments,ws.name),new s({to_seconds:a(e)})}function Es(e){return o.exact(1,arguments,Es.name),new s({to_millis:a(e)})}function Ts(e){return o.exact(1,arguments,Ts.name),new s({to_micros:a(e)})}function xs(e){return o.exact(1,arguments,xs.name),new s({day_of_week:a(e)})}function As(e){return o.exact(1,arguments,As.name),new s({day_of_year:a(e)})}function _s(e){return o.exact(1,arguments,_s.name),new s({day_of_month:a(e)})}function Ss(e){return o.exact(1,arguments,Ss.name),new s({hour:a(e)})}function Cs(e){return o.exact(1,arguments,Cs.name),new s({minute:a(e)})}function Is(e){return o.exact(1,arguments,Is.name),new s({second:a(e)})}function Os(e){return o.exact(1,arguments,Os.name),new s({month:a(e)})}function Ns(e){return o.exact(1,arguments,Ns.name),new s({year:a(e)})}function Rs(e){return o.exact(1,arguments,Rs.name),new s({to_date:a(e)})}function Ls(e,t){return o.exact(2,arguments,Ls.name),new s({move_database:a(e),to:a(t)})}function Ds(e){return o.exact(1,arguments,Ds.name),new s({documents:a(e)})}function Fs(e){return o.exact(1,arguments,Fs.name),new s({reverse:a(e)})}function Ms(e){return o.exact(1,arguments,Ms.name),new s({access_provider:a(e)})}function o(e,t,n,r){if(e!==null&&n.length<e||t!==null&&n.length>t)throw new Wt.InvalidArity(e,t,n.length,r)}o.exact=function(e,t,n){o(e,e,t,n)};o.max=function(e,t,n){o(null,e,t,n)};o.min=function(e,t,n){o(e,null,t,n)};o.between=function(e,t,n,r){o(e,t,n,r)};function F(e,t){for(var n in t){var r=t[n];r!=null&&(e[n]=r)}return e}function _(e){var t=Array.isArray(e)?e:Array.prototype.slice.call(e);return e.length===1?e[0]:t}function it(e){var t=[];return t.push.apply(t,e),t}function a(e){return o.exact(1,arguments,a.name),e===null?null:e instanceof s||v.checkInstanceHasProperty(e,"_isFaunaExpr")?e:typeof e=="symbol"?e.toString().replace(/Symbol\((.*)\)/,function(t,n){return n}):typeof e=="function"?Vt(e):Array.isArray(e)?new s(e.map(function(t){return a(t)})):e instanceof Uint8Array||e instanceof ArrayBuffer?new Xn.Bytes(e):typeof e=="object"?new s({object:st(e)}):e}function st(e){if(e!==null){var t={};return Object.keys(e).forEach(function(n){t[n]=a(e[n])}),t}else return null}Ps.exports={Ref:$n,Bytes:zn,Abort:Yn,At:Qn,Let:Kn,Var:be,If:Zn,Do:er,Object:tr,Lambda:Vt,Call:nr,Query:rr,Map:ar,Foreach:ir,Filter:sr,Take:or,Drop:ur,Prepend:lr,Append:cr,IsEmpty:fr,IsNonEmpty:dr,IsNumber:mr,IsDouble:pr,IsInteger:hr,IsBoolean:gr,IsNull:yr,IsBytes:br,IsTimestamp:vr,IsDate:wr,IsString:Er,IsArray:Tr,IsObject:xr,IsRef:Ar,IsSet:_r,IsDoc:Sr,IsLambda:Cr,IsCollection:Ir,IsDatabase:Or,IsIndex:Nr,IsFunction:Rr,IsKey:Lr,IsToken:Dr,IsCredentials:Fr,IsRole:Mr,Get:Pr,KeyFromSecret:jr,Reduce:qr,Paginate:Br,Exists:kr,Create:Hr,Update:Ur,Replace:Wr,Delete:Vr,Insert:Gr,Remove:Jr,CreateClass:ie(Xr,"CreateClass() is deprecated, use CreateCollection() instead"),CreateCollection:$r,CreateDatabase:zr,CreateIndex:Yr,CreateKey:Qr,CreateFunction:Kr,CreateRole:Zr,CreateAccessProvider:ea,Singleton:ta,Events:na,Match:ra,Union:aa,Merge:ia,Intersection:sa,Difference:oa,Distinct:ua,Join:la,Range:ca,Login:fa,Logout:da,Identify:ma,Identity:ie(pa,"Identity() is deprecated, use CurrentIdentity() instead"),CurrentIdentity:ha,HasIdentity:ie(ga,"HasIdentity() is deprecated, use HasCurrentIdentity() instead"),HasCurrentIdentity:ya,CurrentToken:ba,HasCurrentToken:va,Concat:wa,Casefold:Ea,ContainsStr:Ta,ContainsStrRegex:xa,StartsWith:Aa,EndsWith:_a,FindStr:Ca,FindStrRegex:Ia,Length:Oa,LowerCase:Na,LTrim:Ra,NGram:La,Repeat:Da,ReplaceStr:Fa,ReplaceStrRegex:Ma,RegexEscape:Sa,RTrim:Pa,Space:ja,SubString:qa,TitleCase:Ba,Trim:ka,UpperCase:Ha,Format:Ua,Time:Wa,TimeAdd:Ga,TimeSubtract:Ja,TimeDiff:Xa,Epoch:Va,Date:$a,Now:za,NextId:ie(Ya,"NextId() is deprecated, use NewId() instead"),NewId:Qa,Database:Ka,Index:Za,Class:ie(ei,"Class() is deprecated, use Collection() instead"),Collection:ti,Function:ni,Role:ri,AccessProviders:ai,Classes:ie(ii,"Classes() is deprecated, use Collections() instead"),Collections:si,Databases:oi,Indexes:ui,Functions:li,Roles:ci,Keys:fi,Tokens:di,Credentials:mi,Equals:pi,Contains:ie(hi,"Contains() is deprecated, use ContainsPath() instead"),ContainsPath:bi,ContainsField:yi,ContainsValue:gi,Select:vi,SelectAll:ie(wi,"SelectAll() is deprecated. Avoid use."),Abs:Ei,Add:Ti,BitAnd:xi,BitNot:Ai,BitOr:_i,BitXor:Si,Ceil:Ci,Divide:Ii,Floor:Oi,Max:Ni,Min:Ri,Modulo:Li,Multiply:Di,Round:Fi,Subtract:Mi,Sign:Pi,Sqrt:ji,Trunc:qi,Count:Bi,Sum:ki,Mean:Hi,Any:Ui,All:Wi,Acos:Vi,Asin:Gi,Atan:Ji,Cos:Xi,Cosh:$i,Degrees:zi,Exp:Yi,Hypot:Qi,Ln:Ki,Log:Zi,Pow:es,Radians:ts,Sin:ns,Sinh:rs,Tan:as,Tanh:is,LT:ss,LTE:os,GT:us,GTE:ls,And:cs,Or:fs,Not:ds,ToString:ms,ToNumber:ps,ToObject:hs,ToArray:gs,ToDouble:ys,ToInteger:bs,ToTime:vs,ToSeconds:ws,ToMicros:Ts,ToMillis:Es,DayOfMonth:_s,DayOfWeek:xs,DayOfYear:As,Second:Is,Minute:Cs,Hour:Ss,Month:Os,Year:Ns,ToDate:Rs,MoveDatabase:Ls,Documents:Ds,Reverse:Fs,AccessProvider:Ms,wrap:a}});var Le=b((Yc,js)=>{"use strict";var ce=Ne();function yl(e,t){return t=typeof t!="undefined"?t:!1,t?JSON.stringify(e,null,"  "):JSON.stringify(e)}function Jt(e){return JSON.parse(e,Xt)}function bl(e){var t=[];try{t.push(Jt(e)),e=""}catch{for(;;){var n=e.indexOf(`
`)+1;if(n<=0)break;var r=e.slice(0,n).trim();r.length>0&&t.push(Jt(r)),e=e.slice(n)}}return{values:t,buffer:e}}function Xt(e,t){if(typeof t!="object"||t===null)return t;if("@ref"in t){var n=t["@ref"];if(!("collection"in n)&&!("database"in n))return ce.Native.fromName(n.id);var r=Xt("collection",n.collection),i=Xt("database",n.database);return new ce.Ref(n.id,r,i)}else return"@obj"in t?t["@obj"]:"@set"in t?new ce.SetRef(t["@set"]):"@ts"in t?new ce.FaunaTime(t["@ts"]):"@date"in t?new ce.FaunaDate(t["@date"]):"@bytes"in t?new ce.Bytes(t["@bytes"]):"@query"in t?new ce.Query(t["@query"]):t}js.exports={toJSON:yl,parseJSON:Jt,parseJSONStreaming:bl}});var Yt=b((Qc,qs)=>{"use strict";var $t=Re(),zt=Ut();function k(e,t,n,r){n===void 0&&(n={}),r===void 0&&(r={}),this.reverse=!1,this.params={},this.before=void 0,this.after=void 0,zt(this.params,n);var i=this.params.cursor||this.params;"before"in i?(this.before=i.before,delete i.before):"after"in i&&(this.after=i.after,delete i.after),this.options={},zt(this.options,r),this.client=e,this.set=t,this._faunaFunctions=[]}k.prototype.map=function(e){var t=this._clone();return t._faunaFunctions.push(function(n){return $t.Map(n,e)}),t};k.prototype.filter=function(e){var t=this._clone();return t._faunaFunctions.push(function(n){return $t.Filter(n,e)}),t};k.prototype.each=function(e){return this._retrieveNextPage(this.after,!1).then(this._consumePages(e,!1))};k.prototype.eachReverse=function(e){return this._retrieveNextPage(this.before,!0).then(this._consumePages(e,!0))};k.prototype.previousPage=function(){var e=this;return this._retrieveNextPage(this.before,!0).then(this._adjustCursors.bind(e))};k.prototype.nextPage=function(){var e=this;return this._retrieveNextPage(this.after,!1).then(this._adjustCursors.bind(e))};k.prototype._adjustCursors=function(e){return e.after!==void 0&&(this.after=e.after),e.before!==void 0&&(this.before=e.before),e.data};k.prototype._consumePages=function(e,t){var n=this;return function(r){var i=[];r.data.forEach(function(l){l.document&&(l.instance=l.document),l.value&&l.value.document&&(l.value.instance=l.value.document),i.push(l)}),e(i);var u;return t?u=r.before:u=r.after,u!==void 0?n._retrieveNextPage(u,t).then(n._consumePages(e,t)):Promise.resolve()}};k.prototype._retrieveNextPage=function(e,t){var n={};zt(n,this.params);var r=n.cursor||n;e!==void 0?t?r.before=e:r.after=e:t&&(r.before=null);var i=$t.Paginate(this.set,n);return this._faunaFunctions.length>0&&this._faunaFunctions.forEach(function(u){i=u(i)}),this.client.query(i,this.options)};k.prototype._clone=function(){return Object.create(k.prototype,{client:{value:this.client},set:{value:this.set},_faunaFunctions:{value:this._faunaFunctions},before:{value:this.before},after:{value:this.after},params:{value:this.params}})};qs.exports=k});var ot=b((Kc,ks)=>{"use strict";function Bs(e,t,n,r,i,u,l,d,p,h,g){this.method=e,this.path=t,this.query=n,this.requestRaw=r,this.requestContent=i,this.responseRaw=u,this.responseContent=l,this.statusCode=d,this.responseHeaders=p,this.startTime=h,this.endTime=g}Object.defineProperty(Bs.prototype,"timeTaken",{get:function(){return this.endTime-this.startTime}});ks.exports=Bs});var ut=b((Zc,Vs)=>{"use strict";var Hs=j();function Us(e){Error.call(this),this.message=e||"Request aborted due to timeout",this.isTimeoutError=!0}Hs.inherits(Us,Error);function Ws(e){Error.call(this),this.message=e||"Request aborted",this.isAbortError=!0}Hs.inherits(Ws,Error);Vs.exports={TimeoutError:Us,AbortError:Ws}});var Qt=b(()=>{});var zs=b((nf,$s)=>{"use strict";var ve=Qt(),Gs=ut(),Js=ae(),vl=j(),Xs="stream::";function De(e){this.type="http2",this._sessionMap={},this._http2SessionIdleTime=e.http2SessionIdleTime,this._closed=!1}De.prototype._resolveSessionFor=function(e,t){var n=t?Xs+e:e;if(this._sessionMap[n])return this._sessionMap[n];var r=this,i=null,u=0,l=function(){r._cleanupSessionFor(e,t)},d=function(){i&&(clearTimeout(i),i=null)},p=function(){if(d(),r._http2SessionIdleTime!==1/0){var H=function(){i=null,u===0&&l()};i=setTimeout(H,r._http2SessionIdleTime)}},h=function(H){d();var $=H||t;return $?(S.destroy(),Promise.resolve()):new Promise(function(re){S.close(re)})},g=function(){++u,d()},x=function(){--u;var H=u===0,$=r._closed||S.closed||S.destroyed;H&&!$&&p()},S=ve.connect(e).once("error",l).once("goaway",l),X={session:S,close:h,onRequestStart:g,onRequestEnd:x};return this._sessionMap[n]=X,X};De.prototype._cleanupSessionFor=function(e,t){var n=t?Xs+e:e;this._sessionMap[n]&&(this._sessionMap[n].session.close(),delete this._sessionMap[n])};De.prototype.execute=function(e){if(this._closed)return Promise.reject(new Js.ClientClosed("The Client has already been closed","No subsequent requests can be issued after the .close method is called. Consider creating a new Client instance"));var t=this,n=e.streamConsumer!=null;return new Promise(function(r,i){var u=!1,l=!1,d=function(P){u=!0,r(P)},p=function(P){var Y=wl({error:P,isClosed:t._closed});if(u&&n)return e.streamConsumer.onError(Y);u=!0,i(Y)},h=function(){re.onRequestEnd(),e.signal&&e.signal.removeEventListener("abort",x)},g=function(P){h(),p(P)},x=function(){l=!0,h(),z.close(ve.constants.NGHTTP2_CANCEL),p(new Gs.AbortError)},S=function(){l=!0,h(),z.close(ve.constants.NGHTTP2_CANCEL),p(new Gs.TimeoutError)},X=function(P){var Y=P[ve.constants.HTTP2_HEADER_STATUS],Q=Y>=200&&Y<400,Ae=Q&&n,Xe="",q=function(pe){if(Ae)return e.streamConsumer.onData(pe);Xe+=pe},Tt=function(){if(l||h(),!Ae)return d({body:Xe,headers:P,status:Y});!l&&!t._closed&&e.streamConsumer.onError(new TypeError("network error"))};Ae&&d({body:"[stream]",headers:P,status:Y}),z.on("data",q).on("end",Tt)};try{var H=(e.path[0]==="/"?e.path:"/"+e.path)+vl.querystringify(e.query,"?"),$=Object.assign({},e.headers,{[ve.constants.HTTP2_HEADER_PATH]:H,[ve.constants.HTTP2_HEADER_METHOD]:e.method}),re=t._resolveSessionFor(e.origin,n),z=re.session.request($).setEncoding("utf8").on("error",g).on("response",X);re.onRequestStart(),!e.signal&&e.timeout&&z.setTimeout(e.timeout,S),e.signal&&e.signal.addEventListener("abort",x),e.body!=null&&z.write(e.body),z.end()}catch(P){t._cleanupSessionFor(e.origin,n),p(P)}})};De.prototype.close=function(e){e=e||{},this._closed=!0;var t=function(){};return Promise.all(Object.values(this._sessionMap).map(function(n){return n.close(e.force)})).then(t)};function wl({error:e,isClosed:t}){var n=t&&(e.code==="ERR_HTTP2_GOAWAY_SESSION"||e.code==="ERR_HTTP2_STREAM_CANCEL");return n?new Js.ClientClosed("The request is aborted due to the Client#close call"):e}$s.exports=De});var io=b((Me,Pe)=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});var Ys=new WeakMap,Kt=new WeakMap;function T(e){let t=Ys.get(e);return console.assert(t!=null,"'this' is expected an Event object, but got",e),t}function Qs(e){if(e.passiveListener!=null){typeof console!="undefined"&&typeof console.error=="function"&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener);return}!e.event.cancelable||(e.canceled=!0,typeof e.event.preventDefault=="function"&&e.event.preventDefault())}function we(e,t){Ys.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let n=Object.keys(t);for(let r=0;r<n.length;++r){let i=n[r];i in this||Object.defineProperty(this,i,Ks(i))}}we.prototype={get type(){return T(this).event.type},get target(){return T(this).eventTarget},get currentTarget(){return T(this).currentTarget},composedPath(){let e=T(this).currentTarget;return e==null?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return T(this).eventPhase},stopPropagation(){let e=T(this);e.stopped=!0,typeof e.event.stopPropagation=="function"&&e.event.stopPropagation()},stopImmediatePropagation(){let e=T(this);e.stopped=!0,e.immediateStopped=!0,typeof e.event.stopImmediatePropagation=="function"&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(T(this).event.bubbles)},get cancelable(){return Boolean(T(this).event.cancelable)},preventDefault(){Qs(T(this))},get defaultPrevented(){return T(this).canceled},get composed(){return Boolean(T(this).event.composed)},get timeStamp(){return T(this).timeStamp},get srcElement(){return T(this).eventTarget},get cancelBubble(){return T(this).stopped},set cancelBubble(e){if(!e)return;let t=T(this);t.stopped=!0,typeof t.event.cancelBubble=="boolean"&&(t.event.cancelBubble=!0)},get returnValue(){return!T(this).canceled},set returnValue(e){e||Qs(T(this))},initEvent(){}};Object.defineProperty(we.prototype,"constructor",{value:we,configurable:!0,writable:!0});typeof window!="undefined"&&typeof window.Event!="undefined"&&(Object.setPrototypeOf(we.prototype,window.Event.prototype),Kt.set(window.Event.prototype,we));function Ks(e){return{get(){return T(this).event[e]},set(t){T(this).event[e]=t},configurable:!0,enumerable:!0}}function El(e){return{value(){let t=T(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function Tl(e,t){let n=Object.keys(t);if(n.length===0)return e;function r(i,u){e.call(this,i,u)}r.prototype=Object.create(e.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(let i=0;i<n.length;++i){let u=n[i];if(!(u in e.prototype)){let d=typeof Object.getOwnPropertyDescriptor(t,u).value=="function";Object.defineProperty(r.prototype,u,d?El(u):Ks(u))}}return r}function Zs(e){if(e==null||e===Object.prototype)return we;let t=Kt.get(e);return t==null&&(t=Tl(Zs(Object.getPrototypeOf(e)),e),Kt.set(e,t)),t}function xl(e,t){let n=Zs(Object.getPrototypeOf(t));return new n(e,t)}function Al(e){return T(e).immediateStopped}function _l(e,t){T(e).eventPhase=t}function Sl(e,t){T(e).currentTarget=t}function eo(e,t){T(e).passiveListener=t}var to=new WeakMap,no=1,ro=2,lt=3;function ct(e){return e!==null&&typeof e=="object"}function Fe(e){let t=to.get(e);if(t==null)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function Cl(e){return{get(){let n=Fe(this).get(e);for(;n!=null;){if(n.listenerType===lt)return n.listener;n=n.next}return null},set(t){typeof t!="function"&&!ct(t)&&(t=null);let n=Fe(this),r=null,i=n.get(e);for(;i!=null;)i.listenerType===lt?r!==null?r.next=i.next:i.next!==null?n.set(e,i.next):n.delete(e):r=i,i=i.next;if(t!==null){let u={listener:t,listenerType:lt,passive:!1,once:!1,next:null};r===null?n.set(e,u):r.next=u}},configurable:!0,enumerable:!0}}function Zt(e,t){Object.defineProperty(e,`on${t}`,Cl(t))}function ao(e){function t(){U.call(this)}t.prototype=Object.create(U.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let n=0;n<e.length;++n)Zt(t.prototype,e[n]);return t}function U(){if(this instanceof U){to.set(this,new Map);return}if(arguments.length===1&&Array.isArray(arguments[0]))return ao(arguments[0]);if(arguments.length>0){let e=new Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return ao(e)}throw new TypeError("Cannot call a class as a function")}U.prototype={addEventListener(e,t,n){if(t==null)return;if(typeof t!="function"&&!ct(t))throw new TypeError("'listener' should be a function or an object.");let r=Fe(this),i=ct(n),l=Boolean(i?n.capture:n)?no:ro,d={listener:t,listenerType:l,passive:i&&Boolean(n.passive),once:i&&Boolean(n.once),next:null},p=r.get(e);if(p===void 0){r.set(e,d);return}let h=null;for(;p!=null;){if(p.listener===t&&p.listenerType===l)return;h=p,p=p.next}h.next=d},removeEventListener(e,t,n){if(t==null)return;let r=Fe(this),u=(ct(n)?Boolean(n.capture):Boolean(n))?no:ro,l=null,d=r.get(e);for(;d!=null;){if(d.listener===t&&d.listenerType===u){l!==null?l.next=d.next:d.next!==null?r.set(e,d.next):r.delete(e);return}l=d,d=d.next}},dispatchEvent(e){if(e==null||typeof e.type!="string")throw new TypeError('"event.type" should be a string.');let t=Fe(this),n=e.type,r=t.get(n);if(r==null)return!0;let i=xl(this,e),u=null;for(;r!=null;){if(r.once?u!==null?u.next=r.next:r.next!==null?t.set(n,r.next):t.delete(n):u=r,eo(i,r.passive?r.listener:null),typeof r.listener=="function")try{r.listener.call(this,i)}catch(l){typeof console!="undefined"&&typeof console.error=="function"&&console.error(l)}else r.listenerType!==lt&&typeof r.listener.handleEvent=="function"&&r.listener.handleEvent(i);if(Al(i))break;r=r.next}return eo(i,null),_l(i,0),Sl(i,null),!i.defaultPrevented}};Object.defineProperty(U.prototype,"constructor",{value:U,configurable:!0,writable:!0});typeof window!="undefined"&&typeof window.EventTarget!="undefined"&&Object.setPrototypeOf(U.prototype,window.EventTarget.prototype);Me.defineEventAttribute=Zt;Me.EventTarget=U;Me.default=U;Pe.exports=U;Pe.exports.EventTarget=Pe.exports.default=U;Pe.exports.defineEventAttribute=Zt});var uo=b((je,qe)=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});var en=io(),fe=class extends en.EventTarget{constructor(){super();throw new TypeError("AbortSignal cannot be constructed directly")}get aborted(){let t=ft.get(this);if(typeof t!="boolean")throw new TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return t}};en.defineEventAttribute(fe.prototype,"abort");function Il(){let e=Object.create(fe.prototype);return en.EventTarget.call(e),ft.set(e,!1),e}function Ol(e){ft.get(e)===!1&&(ft.set(e,!0),e.dispatchEvent({type:"abort"}))}var ft=new WeakMap;Object.defineProperties(fe.prototype,{aborted:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(fe.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});var de=class{constructor(){so.set(this,Il())}get signal(){return oo(this)}abort(){Ol(oo(this))}},so=new WeakMap;function oo(e){let t=so.get(e);if(t==null)throw new TypeError(`Expected 'this' to be an 'AbortController' object, but got ${e===null?"null":typeof e}`);return t}Object.defineProperties(de.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(de.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});je.AbortController=de;je.AbortSignal=fe;je.default=de;qe.exports=de;qe.exports.AbortController=qe.exports.default=de;qe.exports.AbortSignal=fe});var tn=b(()=>{"use strict";var lo=uo(),Be=typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:void 0;Be&&(typeof Be.AbortController=="undefined"&&(Be.AbortController=lo.AbortController),typeof Be.AbortSignal=="undefined"&&(Be.AbortSignal=lo.AbortSignal))});var co=b(()=>{});var fo=b(()=>{});var ho=b((cf,po)=>{"use strict";tn();var dt=j(),nn=ae(),rn=ut();function an(e){e=e||{},this.type="fetch",this._closed=!1,this._fetch=dt.resolveFetch(e.fetch),this._pendingRequests=new Map,dt.isNodeEnv()&&e.keepAlive&&(this._keepAliveEnabledAgent=new(e.isHttps?co():fo()).Agent({keepAlive:!0}))}an.prototype.execute=function(e){if(this._closed)return Promise.reject(new nn.ClientClosed("The Client has already been closed","No subsequent requests can be issued after the .close method is called. Consider creating a new Client instance"));var t=this,n=null,r=e.streamConsumer!=null,i=!e.signal&&!!e.timeout,u=new AbortController,l={isStreaming:r,isAbortedByClose:!1,onComplete:null};t._pendingRequests.set(u,l);var d=function(){t._pendingRequests.delete(u),e.signal&&e.signal.removeEventListener("abort",x),l.onComplete&&l.onComplete()},p=function(){n&&clearTimeout(n)},h=function(S){p();var X=Rl(S.headers),H=r&&S.ok;return H?(Nl(S,e.streamConsumer,d),{body:"[stream]",headers:X,status:S.status}):(d(),S.text().then(function($){return{body:$,headers:X,status:S.status}}))},g=function(S){return p(),d(),Promise.reject(mo(S,function(){return!r&&l.isAbortedByClose?new nn.ClientClosed("The request is aborted due to the Client#close call with the force=true option"):i?new rn.TimeoutError:new rn.AbortError}))},x=function(){u.abort()};return i&&(n=setTimeout(function(){n=null,u.abort()},e.timeout)),e.signal&&e.signal.addEventListener("abort",x),this._fetch(dt.formatUrl(e.origin,e.path,e.query),{method:e.method,headers:e.headers,body:e.body,agent:this._keepAliveEnabledAgent,signal:u.signal}).then(h).catch(g)};an.prototype.close=function(e){e=e||{},this._closed=!0;var t=[],n=function(i,u){var l=i.isStreaming||e.force;if(l)return i.isAbortedByClose=!0,u.abort();t.push(new Promise(function(d){i.onComplete=d}))};this._pendingRequests.forEach(n);var r=function(){};return Promise.all(t).then(r)};function Nl(e,t,n){var r=function(l){n(),t.onError(mo(l))};if(dt.isNodeEnv()){e.body.on("error",r).on("data",t.onData).on("end",function(){n(),t.onError(new TypeError("network error"))});return}try{let l=function(){return i.read().then(function(d){if(!d.done){var p=u.decode(d.value,{stream:!0});return t.onData(p),l()}n(),t.onError(new TypeError("network error"))})};var i=e.body.getReader(),u=new TextDecoder("utf-8");l().catch(r)}catch(l){throw new nn.StreamsNotSupported("Please, consider providing a Fetch API-compatible function with streamable response bodies. "+l)}}function mo(e,t){var n=e&&e.name==="AbortError";return n?t?t():new rn.AbortError:e}function Rl(e){var t={};for(var n of e.entries()){var r=n[0],i=n[1];t[r]=i}return t}po.exports=an});var go=b(()=>{});var sn=b((mf,vo)=>{"use strict";var yo=ze(),{getBrowserOsDetails:Ll}=j(),Ee=j(),bo=ut();function ke(e){var t=e.scheme==="https";e.port||(e.port=t?443:80);var n=!e.fetch&&Ee.isNodeEnv()&&Ml();this._adapter=n?new(zs())({http2SessionIdleTime:e.http2SessionIdleTime}):new(ho())({isHttps:t,fetch:e.fetch,keepAlive:e.keepAlive}),this._baseUrl=e.scheme+"://"+e.domain+":"+e.port,this._secret=e.secret,this._headers=Object.assign({},e.headers,Fl()),this._queryTimeout=e.queryTimeout,this._lastSeen=null,this._timeout=Math.floor(e.timeout*1e3)}ke.prototype.getLastTxnTime=function(){return this._lastSeen};ke.prototype.syncLastTxnTime=function(e){(this._lastSeen==null||this._lastSeen<e)&&(this._lastSeen=e)};ke.prototype.close=function(e){return this._adapter.close(e)};ke.prototype.execute=function(e){e=e||{};var t=e.streamConsumer&&(typeof e.streamConsumer.onData!="function"||typeof e.streamConsumer.onError!="function");if(t)return Promise.reject(new TypeError('Invalid "streamConsumer" provided'));var n=e.secret||this._secret,r=e.queryTimeout||this._queryTimeout,i=this._headers;return i.Authorization=n&&Dl(n),i["X-Last-Seen-Txn"]=this._lastSeen,i["X-Query-Timeout"]=r,this._adapter.execute({origin:this._baseUrl,path:e.path||"/",query:e.query,method:e.method||"GET",headers:Ee.removeNullAndUndefinedValues(i),body:e.body,signal:e.signal,timeout:this._timeout,streamConsumer:e.streamConsumer})};function Dl(e){return"Bearer "+e}function Fl(){var e={driver:["javascript",yo.version].join("-")},t;try{t=global instanceof ServiceWorkerGlobalScope}catch{t=!1}try{if(Ee.isNodeEnv()){e.runtime=["nodejs",process.version].join("-"),e.env=Ee.getNodeRuntimeEnv();var n=go();e.os=[n.platform(),n.release()].join("-")}else t?e.runtime="Service Worker":(e.runtime=Ee.getBrowserDetails(),e.env="browser",e.os=Ll())}catch{}var r={"X-FaunaDB-API-Version":yo.apiVersion};return Ee.isNodeEnv()&&(r["X-Driver-Env"]=Object.keys(e).map(i=>[i,e[i].toLowerCase()].join("=")).join("; ")),r}function Ml(){try{return Qt(),!0}catch{return!1}}vo.exports={HttpClient:ke,TimeoutError:bo.TimeoutError,AbortError:bo.AbortError}});var Ao=b((pf,xo)=>{"use strict";tn();var Pl=ot(),jl=ae(),wo=Le(),ql=sn(),Eo=Re(),Bl=j(),To=["start","error","version","history_rewrite"],kl=To.concat(["snapshot"]);function He(e,t,n,r){n=Bl.applyDefaults(n,{fields:null}),this._client=e,this._onEvent=r,this._query=Eo.wrap(t),this._urlParams=n.fields?{fields:n.fields.join(",")}:null,this._abort=new AbortController,this._state="idle"}He.prototype.snapshot=function(){var e=this;e._client.query(Eo.Get(e._query)).then(function(t){e._onEvent({type:"snapshot",event:t})}).catch(function(t){e._onEvent({type:"error",event:t})})};He.prototype.subscribe=function(){var e=this;if(e._state==="idle")e._state="open";else throw new Error("Subscription#start should not be called several times, consider instantiating a new stream instead.");var t=JSON.stringify(e._query),n=Date.now(),r="";function i(d){var p=Date.now(),h;try{h=wo.parseJSON(d.body)}catch{h=d.body}var g=new Pl("POST","stream",e._urlParams,t,e._query,d.body,h,d.status,d.headers,n,p);e._client._handleRequestResult(d,g)}function u(d){var p=wo.parseJSONStreaming(r+d);r=p.buffer,p.values.forEach(function(h){h.txn!==void 0&&e._client.syncLastTxnTime(h.txn),h.event==="error"?l(new jl.StreamErrorEvent(h)):e._onEvent(h)})}function l(d){d instanceof ql.AbortError||e._onEvent({type:"error",event:d})}e._client._http.execute({method:"POST",path:"stream",body:t,query:e._urlParams,signal:this._abort.signal,streamConsumer:{onError:l,onData:u}}).then(i).catch(l)};He.prototype.close=function(){this._state!=="closed"&&(this._state="closed",this._abort.abort())};function mt(e){this._allowedEvents=e,this._listeners={}}mt.prototype.on=function(e,t){if(this._allowedEvents.indexOf(e)===-1)throw new Error("Unknown event type: "+e);this._listeners[e]===void 0&&(this._listeners[e]=[]),this._listeners[e].push(t)};mt.prototype.dispatch=function(e){var t=this._listeners[e.type];if(!!t)for(var n=0;n<t.length;n++)t[n].call(null,e.event,e)};function Ue(e,t){this._client=e,this._dispatcher=t}Ue.prototype.on=function(e,t){return this._dispatcher.on(e,t),this};Ue.prototype.start=function(){return this._client.subscribe(),this};Ue.prototype.close=function(){this._client.close()};function Hl(e){var t=function(n,r){var i=new mt(To),u=new He(e,n,r,function(l){i.dispatch(l)});return new Ue(u,i)};return t.document=function(n,r){var i=[],u=!0,l=new mt(kl),d=new He(e,n,r,p);function p(g){switch(g.type){case"start":l.dispatch(g),d.snapshot();break;case"snapshot":h(g);break;case"error":l.dispatch(g);break;default:u?i.push(g):l.dispatch(g)}}function h(g){l.dispatch(g);for(var x=0;x<i.length;x++){var S=i[x];S.txn>g.event.ts&&l.dispatch(S)}u=!1,i=null}return new Ue(d,l)},t}xo.exports={StreamAPI:Hl}});var So=b((hf,on)=>{"use strict";var Ul=ze(),Wl=Yt(),Vl=ot(),Gl=ae(),Jl=sn(),Xl=Le(),$l=Re(),zl=Ao(),ne=j(),Yl=Ne(),_o=ne.notifyAboutNewVersion();function G(e){var t=Ql();e=ne.applyDefaults(e,{domain:"db.fauna.com",scheme:"https",port:null,secret:null,timeout:60,observer:null,keepAlive:!0,headers:{},fetch:void 0,queryTimeout:null,http2SessionIdleTime:t.value,checkNewVersion:!0}),_o(e.checkNewVersion),t.shouldOverride&&(e.http2SessionIdleTime=t.value),this._observer=e.observer,this._http=new Jl.HttpClient(e),this.stream=zl.StreamAPI(this)}G.apiVersion=Ul.apiVersion;G.prototype.query=function(e,t){return this._execute("POST","",$l.wrap(e),null,t)};G.prototype.paginate=function(e,t,n){return t=ne.defaults(t,{}),n=ne.defaults(n,{}),new Wl(this,e,t,n)};G.prototype.ping=function(e,t){return this._execute("GET","ping",null,{scope:e,timeout:t})};G.prototype.getLastTxnTime=function(){return this._http.getLastTxnTime()};G.prototype.syncLastTxnTime=function(e){this._http.syncLastTxnTime(e)};G.prototype.close=function(e){return this._http.close(e)};G.prototype._execute=function(e,t,n,r,i){r=ne.defaults(r,null),(t instanceof Yl.Ref||ne.checkInstanceHasProperty(t,"_isFaunaRef"))&&(t=t.value),r!==null&&(r=ne.removeUndefinedValues(r));var u=Date.now(),l=this,d=["GET","HEAD"].indexOf(e)>=0?void 0:JSON.stringify(n);return this._http.execute(Object.assign({},i,{path:t,query:r,method:e,body:d})).then(function(p){var h=Date.now(),g=Xl.parseJSON(p.body),x=new Vl(e,t,r,d,n,p.body,g,p.status,p.headers,u,h);return l._handleRequestResult(p,x,i),g.resource})};G.prototype._handleRequestResult=function(e,t,n){var r="x-txn-time";e.headers[r]!=null&&this.syncLastTxnTime(parseInt(e.headers[r],10));var i=[this._observer,n&&n.observer];i.forEach(u=>{typeof u=="function"&&u(t,this)}),Gl.FaunaHTTPError.raiseForStatusCode(t)};function Ql(){var e=ne.getEnvVariable("FAUNADB_HTTP2_SESSION_IDLE_TIME"),t=e==="Infinity"?1/0:parseInt(e,10),n=!isNaN(t);return{shouldOverride:n,value:n?t:500}}on.exports=G;on.exports.resetNotifyAboutNewVersion=function(){_o=ne.notifyAboutNewVersion()}});var Oo=b((gf,Io)=>{"use strict";var Kl=Le();function Zl(e){return function(t,n){return e(Co(t),n)}}function Co(e){var t=e.query,n=e.method,r=e.path,i=e.requestContent,u=e.responseHeaders,l=e.responseContent,d=e.statusCode,p=e.timeTaken,h="";function g(x){h=h+x}return g("Fauna "+n+" /"+r+tc(t)+`
`),i!=null&&g("  Request JSON: "+un(i)+`
`),g("  Response headers: "+un(u)+`
`),g("  Response JSON: "+un(l)+`
`),g("  Response ("+d+"): Network latency "+p+`ms
`),h}function ec(e){var t="  ";return e.split(`
`).join(`
`+t)}function un(e){return ec(Kl.toJSON(e,!0))}function tc(e){if(e==null)return"";var t=Object.keys(e);if(t.length===0)return"";var n=t.map(function(r){return r+"="+e[r]});return"?"+n.join("&")}Io.exports={logger:Zl,showRequestResult:Co}});var pt=b((yf,Ro)=>{var No=Re(),nc=j(),rc=Le().parseJSON;Ro.exports=nc.mergeObjects({Client:So(),Expr:Ke(),PageHelper:Yt(),RequestResult:ot(),clientLogger:Oo(),errors:ae(),values:Ne(),query:No,parseJSON:rc},No)});var Fu={number:(e,t)=>e-t,"-number":(e,t)=>-(e-t),gl:(e,t)=>e>=0?e-t:t-e,"abs(number)":(e,t)=>Math.abs(e)-Math.abs(t),"-abs(number)":(e,t)=>-(Math.abs(e)-Math.abs(t)),string:(e,t)=>e.localeCompare(t),date:(e,t)=>e.valueOf()-t.valueOf(),noop:()=>0};Array.prototype.sortBy=function(e){return Mu(this,e)};function Mu(e,t){let n=Object.keys(t);return[...e].sort((r,i)=>{let u=0;return n.some(l=>!!(u=Fu[t[l]](r[l],i[l]))),u})}function A(e,t,n){e.addEventListener(t,n)}function L(e,t){console.log("trigger",t),e.dispatchEvent(new Event(t))}var Lo=_t(pt()),se=.06,Do=20,Fo=location.href.includes("localhost"),Mo=()=>ln("work_offline")?.value===!0,Te={companyName:"Little Light Show",fullName:"Nathan Alix",addressLine1:"4 Andrea Lane",addressLine2:"Greenville, SC 29615"},W={FAUNADB_SERVER_SECRET:"",FAUNADB_ADMIN_SECRET:"",FAUNADB_DOMAIN:"db.us.fauna.com"};if(globalThis.process?.env)W.FAUNADB_SERVER_SECRET=process.env.FAUNADB_SERVER_SECRET,W.FAUNADB_ADMIN_SECRET=process.env.FAUNADB_ADMIN_SECRET;else if(localStorage){if(W.FAUNADB_SERVER_SECRET=localStorage.getItem("FAUNADB_SERVER_SECRET"),W.FAUNADB_ADMIN_SECRET=localStorage.getItem("FAUNADB_ADMIN_SECRET"),!W.FAUNADB_SERVER_SECRET){let e=prompt("Provide the FAUNADB_SERVER_SECRET")||"";W.FAUNADB_SERVER_SECRET=e,localStorage.setItem("FAUNADB_SERVER_SECRET",e)}W.FAUNADB_SERVER_SECRET||console.error("set FAUNADB_SERVER_SECRET in local storage"),W.FAUNADB_ADMIN_SECRET||console.error("set FAUNADB_ADMIN_SECRET in local storage")}function ac(){return 0<=location.href.indexOf("netlify")}var ic=W.FAUNADB_DOMAIN,sc=W.FAUNADB_SERVER_SECRET,bf=W.FAUNADB_ADMIN_SECRET,Po=ac()?"NETLIFY":"dev",oe=localStorage.getItem("user");function me(){return new Lo.default.Client({secret:sc,domain:ic})}var jo;function qo(){return jo=jo||JSON.parse(localStorage.getItem("__GLOBAL_STATE__")||"{}")}function Bo(e,t){let n=qo(),r=typeof t;n[e]={type:r,value:t},localStorage.setItem("__GLOBAL_STATE__",JSON.stringify(n))}function ln(e){return qo()[e]}function ko(e){return e/1e3}var oc=Fo?365*24*3600:(7-.2)*24*3600,cn=class{constructor(t){this.options=t;t.maxAge=t.maxAge||oc,this.table=t.table;let n=localStorage.getItem(`table_${this.table}`);if(!n)this.data=[],this.lastWrite=0;else{let r=JSON.parse(n);this.lastWrite=r.lastWrite,this.data=r.data}}clear(){this.lastWrite=0,this.save()}renew(){this.lastWrite=Date.now(),this.save()}save(){localStorage.setItem(`table_${this.table}`,JSON.stringify({lastWrite:this.lastWrite,data:this.data}))}deleteLineItem(t){let n=this.data.findIndex(r=>r.id===t);this.data.splice(n,1),this.save()}updateLineItem(t){let n=this.data.findIndex(r=>r.id===t.id);-1<n&&this.data.splice(n,1),this.data.push(t),this.save()}expired(){let t=ko(Date.now()-this.lastWrite);return this.options.maxAge<t}getById(t){return this.data.find(n=>n.id===t)}get(){return this.data}set(t){this.lastWrite=Date.now(),this.data=t,this.save()}};var O=_t(pt());var We={DELETED:"___DELETED___",UPDATED:"___UPDATED___"};function Ho(e){Object.values(We).forEach(t=>e[t]&&delete e[t])}function uc(e){delete e.id}function fn(e){return"9"<e[0]}function lc(e){e[We.UPDATED]=Date.now()}function Uo(e){return!!e[We.UPDATED]}function cc(e){e[We.DELETED]=Date.now()}function dn(e){return!!e[We.DELETED]}var Ve=class{constructor(t){this.options=t;this.tableName=t.tableName,this.cache=new cn({table:t.tableName,maxAge:t.maxAge})}isOffline(){return this.options.offline||Mo()}async synchronize(){if(!oe)throw"user must be signed in";if(this.isOffline())throw"cannot synchronize in offline mode";this.cache.get().filter(dn).forEach(async n=>{if(!n.id)throw"all items must have an id";fn(n.id)?this.cache.deleteLineItem(n.id):await this.removeItem(n.id)}),this.cache.get().filter(Uo).forEach(async n=>{await this.upsertItem(n)});let t=await this.forceFetchAllItems();return this.cache.set(t),t}async removeItem(t){if(!oe)throw"user must be signed in";if(this.isOffline()){let r=this.cache.getById(t);if(!r)throw"cannot remove an item that is not already there";cc(r),fn(t)?this.cache.deleteLineItem(t):this.cache.updateLineItem(r);return}await me().query(O.query.Delete(O.query.Ref(O.query.Collection(this.tableName),t))),this.cache.deleteLineItem(t)}async getItem(t){if(!oe)throw"user must be signed in";if(this.isOffline()||!this.cache.expired()){let i=this.cache.getById(t);if(i){if(dn(i))throw"item marked for deletion";return i}}if(this.isOffline())throw`unable to load item: ${this.tableName} ${t}`;let r=await me().query(O.query.Get(O.query.Ref(O.query.Collection(this.tableName),t)));return this.cache.updateLineItem(r.data),r.data}async upsertItem(t){if(!oe)throw"user must be signed in";let n=me();if(this.isOffline()){t.id=t.id||`${this.tableName}:${Date.now().toFixed()}`,lc(t),this.cache.updateLineItem(t);return}if(!t.id||Uo(t)&&fn(t.id)){Ho(t),uc(t);let r=await n.query(O.query.Create(O.query.Collection(this.tableName),{data:{...t,user:oe,create_date:Date.now()}}));t.id=r.ref.id,this.cache.updateLineItem(t)}else await n.query(O.query.Update(O.query.Ref(O.query.Collection(this.tableName),t.id),{data:{...t,user:oe,update_date:Date.now()}}));this.cache.updateLineItem(t)}async getItems(){if(!oe)throw"user must be signed in";return this.isOffline()||!this.cache.expired()?this.cache.get().filter(t=>!dn(t)):await this.synchronize()}async forceFetchAllItems(){let r=(await me().query(O.query.Map(O.query.Paginate(O.query.Documents(O.query.Collection(this.tableName)),{size:Do}),O.query.Lambda("ref",O.query.Get(O.query.Var("ref")))))).data;return r.forEach(u=>{u.data.id=u.ref.value.id,Ho(u.data)}),r.map(u=>u.data)}};var fc="inventory",Ge=new Ve({tableName:fc,maxAge:Number.MAX_SAFE_INTEGER,offline:!0});async function Wo(){let e=document.querySelector("#inventory_list");return e||(e=document.createElement("datalist"),e.id="inventory_list",(await Ge.getItems()).forEach(n=>{let r=document.createElement("option");r.value=n.code,e.appendChild(r)}),document.body.appendChild(e),e)}var ue={home:()=>"/index.html",identity:({context:e,target:t})=>`/app/identity.html?target=${t}&context=${e}`,createInvoice:()=>"/app/invoice/invoice.html",invoice:e=>`/app/invoice/invoice.html?id=${e}`,allInvoices:()=>"/app/invoice/invoices.html",allLedgers:()=>"/app/gl/index.html?print=all",printLedger:e=>`/app/gl/index.html?print=${e}`,createLedger:()=>"/app/gl/index.html",dashboard:()=>"/app/index.html",admin:()=>"/app/admin/index.html"};var dc="invoices",ht=new Ve({tableName:dc,offline:!1});async function Vo(e){return ht.removeItem(e)}async function Go(e){return ht.getItem(e)}async function Jo(e){return ht.upsertItem(e)}async function Xo(){let e=await ht.getItems();return e.forEach(n=>{n.mops=n.mops||[],n.paid&&n.mop&&(n.mops.push({mop:n.mop,paid:n.paid}),delete n.paid,delete n.mop)}),e.filter(n=>n.items).map(n=>(n.date=n.date||n.create_date,n.labor=(n.labor||0)-0,n.additional=(n.additional||0)-0,n.items.forEach(r=>{r.item=(r.item||"").toLocaleUpperCase(),r.quantity=(r.quantity||0)-0,r.price=(r.price||0)-0,r.total=(r.total||0)-0}),n)).sortBy({date:"date"}).reverse()}var mc=_t(pt());async function $o(){await me().ping()}async function zo(){if(!localStorage.getItem("user"))return location.href=ue.identity({target:location.href,context:Po}),!1;try{await $o()}catch{return localStorage.setItem("FAUNADB_SERVER_SECRET",""),ue.home(),!1}return!0}function pc(e){return typeof e=="string"?e:Object.keys(e).map(t=>`${t}:${e[t]}`).join(";")}function hc(e,...t){return t.filter(n=>!!n).forEach(n=>{Object.keys(n).filter(r=>e[r]===void 0).forEach(r=>e[r]=n[r])}),e}var Yo={style:pc},Qo={button:{type:"button"}};function f(e,t,...n){if(typeof e=="string"){let r=document.createElement(e);Qo[e]&&(t=hc(t??{},Qo[e])),t&&Object.keys(t).forEach(u=>{let l=Yo[u]?Yo[u](t[u]):t[u];typeof l=="string"?r.setAttribute(u,l):l instanceof Function?r.addEventListener(u,l):r.setAttribute(u,l+"")});let i=u=>{u&&u.forEach(l=>{typeof l=="string"?r.appendChild(document.createTextNode(l)):l instanceof HTMLElement?r.appendChild(l):l instanceof Array?i(l):console.log("addChildren cannot add to dom node",l)})};return n&&i(n),r}{let r=e(t),i=u=>{u&&u.forEach(l=>{typeof l=="string"||l instanceof HTMLElement?r.setContent(l):l instanceof Array?i(l):typeof l=="object"?r.addChild(l):console.log("addChildren cannot add to widget",l)})};return n&&i(n),r}}function Ko(e=new Date){return e.toISOString().split("T")[0]}function J(e,t){for(;e.firstChild;)t.appendChild(e.firstChild)}function mn(e,t){for(;e.firstChild;)t.before(e.firstChild)}function gt(e){e.querySelectorAll("[data-event]").forEach(t=>{let n=t.dataset.event;if(!n)throw"item must define a data-event";let r=hn(t),i=pn(t),u=gc(t,r),l=Zo(t);if(u)A(t,"click",()=>{L(e,n)});else if(l)A(t,"click",()=>{let d=t.checked;L(e,n+(d?":yes":":no"))});else if(r)A(t,"change",()=>{L(e,n)});else throw`data-event not supported for this item: ${t.outerHTML}`}),e.querySelectorAll("[data-bind]").forEach(t=>{let n=t.dataset.bind;if(!n)throw"item must define a data-bind";let r=ln(n);if(Zo(t))t.checked=r?.value===!0,A(t,"change",()=>{Bo(n,t.checked)});else throw`unimplemented data-bind on element: ${t.outerHTML}`})}function Zo(e){return hn(e)&&pn(e)==="checkbox"}function gc(e,t){return e.tagName==="BUTTON"||t&&pn(e)==="button"}function pn(e){return hn(e)&&e.type}function hn(e){return e.tagName==="INPUT"}function eu(e){A(e,"focus",()=>e.select())}function tu(e){e.step="0.01",e.addEventListener("change",()=>{let t=e.value,n=e.valueAsNumber?.toFixed(2);t!=n&&(e.value=n)})}function yt(e){return e.value?e.valueAsNumber:0}function bt(e){let t=Array.from(e.querySelectorAll("input[type=number]"));t.forEach(eu),t.filter(r=>r.classList.contains("currency")).forEach(tu)}var vt="mops",nu=class{constructor(){this.data=JSON.parse(localStorage.getItem(vt)||"{}")}getItemByCode(t){return this.data[t]}persistItem(t){this.data[t.id]=t}persistItems(){localStorage.setItem(vt,JSON.stringify(this.data))}},wt=new nu;wt.persistItem({id:"CASH"});wt.persistItem({id:"CHECK"});wt.persistItems();function ru(){let e=document.querySelector(`#${vt}_list`);return e||(e=document.createElement("datalist"),e.id=`${vt}_list`,Object.entries(wt.data).forEach(([t,n])=>{let r=document.createElement("option");r.value=t,e.appendChild(r)}),document.body.appendChild(e),e)}function au(e){return e.toFixed(2)}function iu(e){return e.valueAsNumber||0}function xe(e){return e.length?e.reduce((t,n)=>t+n,0):0}var Et=[];async function su(e){await Wo();let t=f("form",{class:"grid-6",id:"invoice-form"},f("h1",{class:"col-1-6 centered"},`Invoice Form for ${Te.companyName}`),f("input",{class:"form-label hidden",readonly:!0,type:"text",name:"id",value:e.id}),f("div",{class:"section-title col-1-6"},"Client"),f("label",{class:"form-label col-1-3"},"Client Name"),f("label",{class:"form-label col-4-3"},"Date"),f("input",{class:"col-1-3",type:"text",placeholder:"clientname",name:"clientname",required:!0,value:e.clientname}),f("input",{class:"col-4-3",type:"date",placeholder:"Date",name:"date",required:!0,value:Ko(new Date(e.date||Date.now()))}),f("label",{class:"form-label col-1-3"},"Telephone"),f("label",{class:"form-label col-4-3"},"Email"),f("input",{type:"tel",class:"col-1-3",placeholder:"telephone",name:"telephone",value:e.telephone}),f("input",{type:"email",class:"col-4-3",placeholder:"email",name:"email",value:e.email}),f("label",{class:"form-label col-1-6"},"Bill To",f("textarea",{class:"address",placeholder:"billto",name:"billto"},e.billto)),f("label",{class:"form-label col-1-6"},"Comments",f("textarea",{class:"comments",placeholder:"comments",name:"comments"},e.comments)),f("div",{class:"vspacer col-1-6"}),f("section",{class:"line-items grid-6 col-1-6"},f("div",{class:"section-title col-1-6"},"Items")),f("div",{class:"vspacer col-1-6"}),f("button",{class:"button col-1-3","data-event":"add-another-item",type:"button"},"Add item"),f("button",{class:"button col-4-3","data-event":"remove-last-item",type:"button"},"Remove Last Item"),f("div",{class:"vspacer col-1-6"}),f("div",{class:"section-title col-1-6"},"Summary"),f("label",{class:"form-label col-1-2 currency"},"Labor"),f("label",{class:"form-label col-3-2 currency"},"Other"),f("label",{class:"form-label col-5-2 currency"},"Total + Tax"),f("input",{type:"number",class:"currency col-1-2",placeholder:"labor",name:"labor",id:"labor",value:e.labor.toFixed(2)}),f("input",{type:"number",class:"currency col-3-2",placeholder:"additional",name:"additional",value:e.additional.toFixed(2)}),f("input",{readonly:!0,type:"number",class:"currency col-5-2",id:"total_due",name:"total_due"}),f("div",{class:"col-1 vspacer-1"}),f("div",{class:"section-title col-1-6"},"Method of Payment"),f("div",{class:"col-1-4"},"Payment Type"),f("div",{class:"col-5-2 currency"},"Amount"),f("div",{id:"mop-line-item-end",class:"hidden"}),f("button",{class:"button col-1-2 if-desktop","data-event":"add-method-of-payment",type:"button"},"Add Payment"),f("div",{class:"form-label col-5-2 currency if-desktop"},"Balance Due"),f("input",{readonly:!0,class:"currency col-5-2 bold if-desktop",type:"number",id:"balance_due"}),f("div",{class:"vspacer-1 col-1-6 flex"},f("button",{class:"bold button","data-event":"submit",type:"button"},"Save"),f("button",{class:"button if-print-to-pdf","data-event":"print",type:"button"},"Print"),f("button",{class:"button if-desktop","data-event":"clear",type:"button"},"Clear"),f("button",{class:"button if-desktop","data-event":"delete",type:"button"},"Delete"),f("button",{class:"button if-desktop","data-event":"list-all-invoices",type:"button"},"Show All")),f("div",{class:"vspacer-2"})),n=t.querySelector("[name=labor]"),r=t.querySelector("[name=additional]");A(n,"change",()=>L(t,"change")),A(r,"change",()=>L(t,"change"));{let i=t.querySelector(".line-items"),u=e.items.map(cu);u.forEach(l=>fu(t,l)),u.forEach(l=>J(l,i))}{let i=t.querySelector("#mop-line-item-end"),u=e.mops?.map(uu);u?.forEach(l=>{}),u?.forEach(l=>mn(l,i))}return A(t,"change",()=>lu(t)),bt(t),gt(t),bc(t),e.mops?.length||L(t,"add-method-of-payment"),lu(t),t}function ou(e){return e.querySelector("input")}function yc(e){let t=cu({quantity:1,item:"",price:0,total:0});fu(e,t);let n=ou(t),r=e.querySelector(".line-items")||e;Et.splice(0,Et.length);for(let i=0;i<t.children.length;i++)Et.push(t.children[i]);bt(t),J(t,r),n?.focus()}function bc(e){A(e,"list-all-invoices",()=>{window.location.href=ue.allInvoices()}),A(e,"remove-last-item",()=>{Et.forEach(t=>t.remove()),L(e,"change")}),A(e,"add-another-item",()=>{!e.reportValidity()||(yc(e),L(e,"change"))}),A(e,"add-method-of-payment",()=>{let t=e.querySelector("#mop-line-item-end")||e,n=uu();bt(n);let r=ou(n);mn(n,t),r.focus()}),A(e,"clear",()=>{location.href=ue.createInvoice()})}function uu(e){return f("div",null,f("input",{type:"select",class:"col-1-4",name:"method_of_payment",value:e?.mop||"",list:ru().id}),f("input",{type:"number",class:"col-5-2 currency",name:"amount_paid",placeholder:"amount paid",value:au(e?.paid||0)}))}function lu(e){let t=e.querySelector("[name=labor]"),n=e.querySelector("[name=additional]"),r=e.querySelector("[name=total_due]"),i=e.querySelector("#balance_due"),l=Array.from(e.querySelectorAll("input[name=total]")).map(h=>parseFloat(h.value||"0")).reduce((h,g)=>h+g,0),d=t.valueAsNumber+n.valueAsNumber+l*(1+se);r.value=d.toFixed(2);let p=xe(Array.from(e.querySelectorAll("input[name=amount_paid]")).map(iu));i.value=(d-p).toFixed(2)}function cu(e){return f("div",null,f("label",{class:"form-label col-1-6"},"Item"),f("input",{name:"item",class:"bold col-1-6",required:!0,type:"text",value:e.item,list:"inventory_list"}),f("label",{class:"form-label col-1-2 quantity"},"Quantity"),f("label",{class:"form-label col-3-2 currency"},"Price"),f("label",{class:"form-label col-5-2 currency"},"Total"),f("input",{name:"quantity",required:!0,class:"quantity col-1-2",type:"number",value:e.quantity}),f("input",{name:"price",required:!0,class:"currency col-3-2",type:"number",value:e.price.toFixed(2)}),f("input",{readonly:!0,name:"total",class:"bold currency col-5-2",type:"number",value:e.total.toFixed(2)}))}function fu(e,t){let n=t.querySelector("[name=item]"),r=t.querySelector("[name=quantity]"),i=t.querySelector("[name=price]"),u=t.querySelector("[name=total]"),l=()=>{let d=yt(r),p=yt(i),h=d*p;console.log({qty:d,price:p,value:h}),u.value=h.toFixed(2),L(e,"change")};A(r,"change",l),A(i,"change",l),A(n,"change",async()=>{let d=await vc(n.value);if(!d)return;let p=yt(i);d.price!==p&&(i.value=d.price.toFixed(2),L(i,"change"))})}async function vc(e){return(await Ge.getItems()).find(n=>n.code===e)}function du(e){let t=f("div",{class:"print page grid-6"},f("label",{class:"bold col-1-2"},"Little Light Show"),f("label",{class:"bold col-3-4 align-right"},"Invoice"),f("div",{class:"line col-1-6"}),f("div",{class:"col-1-6 vspacer"}),f("label",{class:"col-1-2"},Te.fullName),f("label",{class:"col-5-2 align-right"},e.id),f("label",{class:"col-1-2"},Te.addressLine1),f("label",{class:"col-5-2 align-right"},new Date().toDateString()),f("label",{class:"col-1-2"},Te.addressLine2),f("div",{class:"vspacer-2 col-1-6"}),f("label",{class:"bold col-1"},"Bill To:"),f("label",{class:"col-2-2"},e.clientname),e.billto.split(`
`).map(n=>f("label",{class:"col-2-2"},n)),e.comments&&f("div",{class:"vspacer-2 col-1-6"}),e.comments&&e.comments.split(`
`).map(n=>f("label",{class:"col-2-5"},n)),f("div",{class:"vspacer-2 col-1-6"}),f("label",{class:"bold col-1-3"},"Description"),f("label",{class:"bold col-4 align-right"},"Quantity"),f("label",{class:"bold col-5 align-right"},"Rate"),f("label",{class:"bold col-6 align-right"},"Amount"),f("div",{class:"line col-1-6"}));{e.items.forEach(i=>{J(wc(i),t)});let n=e.items.reduce((i,u)=>i+((u.total||0)-0),0);console.log(e.items,n);let r=f("div",null,f("div",{class:"line col-1-6"}),f("div",{class:"vspacer-2 col-1-6"}),f("label",{class:"col-5"},"Total Supplies"),f("label",{class:"col-6 align-right"},n.toFixed(2)),f("label",{class:"col-5"},"Tax (",100*se+"","%)"),f("label",{class:"col-6 align-right"},(n*se).toFixed(2)),e.labor&&f("label",{class:"col-5"},"Labor"),e.labor&&f("label",{class:"col-6 align-right"},e.labor.toFixed(2)),e.additional&&f("label",{class:"col-5"},"Additional"),e.additional&&f("label",{class:"col-6 align-right"},e.additional.toFixed(2)),f("label",{class:"bold col-5"},"Balance Due"),f("label",{class:"bold col-6 align-right"},((e.labor||0)+(e.additional||0)+n*(1+se)).toFixed(2)));J(r,t)}return t}function wc(e){return console.log("invoiceItem",{item:e}),f("div",null,f("label",{class:"tall col-1-3"},e.item),f("label",{class:"tall col-4 align-right"},e.quantity.toFixed(2)),f("label",{class:"tall col-5 align-right"},e.price.toFixed(2)),f("label",{class:"tall col-6 align-right"},e.total.toFixed(2)))}function mu(e){let t=xe(e.map(pu)),n=xe(e.map(i=>i.labor)),r=e.length?f("form",{class:"grid-6"},f("label",{class:"bold col-1-4"},"Client"),f("label",{class:"bold col-5 align-right"},"Labor"),f("label",{class:"bold col-6 align-right"},"Total"),f("div",{class:"line col-1-6"})):f("form",{class:"grid-6"},f("div",{class:"col-1-6 centered"},"No invoices defined"),f("div",{class:"line col-1-6"}));return e.map(Ec).forEach(i=>J(i,r)),e.length&&J(f("div",null,f("div",{class:"vspacer-1 col-1-6"}),f("div",{class:"line col-1-6"}),f("label",{class:"bold col-1-4"},"Total"),f("label",{class:"bold col-5 currency"},n.toFixed(2)),f("label",{class:"bold col-6 currency"},t.toFixed(2)),f("div",{class:"vspacer-2 col-1-6"}),f("button",{type:"button",class:"button col-1-2","data-event":"create-invoice"},"Create Invoice")),r),J(f("div",null,f("button",{type:"button",class:"button col-1-2","data-event":"create-invoice"},"Create Invoice")),r),gt(r),r}function pu(e){return xe(e.items.map(n=>n.total||0))*(1+se)+e.labor+e.additional}function Ec(e){return f("div",null,f("a",{class:"col-1-4",href:`invoice?id=${e.id}`},e.clientname),f("label",{class:"col-5 align-right"},e.labor.toFixed(2)),f("label",{class:"col-6 align-right"},pu(e).toFixed(2)))}function hu(e){return typeof e!="undefined"}function gu(e,t){if(!hu(e[t]))throw`form element not found: ${t}`;return e[t].value}function yu(e,t){Object.keys(t).forEach(r=>{if(!hu(e[r]))throw`form element not found: ${r}`;e[r].value=t[r]})}var Tc=navigator.userAgent.toLocaleUpperCase(),xc=Tc.includes("CHROME"),Ac=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);function bu(){xc&&vu(".if-print-to-pdf"),Ac||vu(".if-desktop")}function vu(e){let t=document.styleSheets;for(let n=0;n<t.length;n++){let r=t[n];for(let i=0;i<r.cssRules.length;i++)if(r.cssRules[i].selectorText===e){r.deleteRule(i);return}}}var wu={light_mode:"light",dark_mode:"dark",holiday_mode:"holiday"};function Eu(e){e||(e=localStorage.getItem("mode")||wu.light_mode),localStorage.setItem("mode",e),document.body.classList.remove(...Object.values(wu)),document.body.classList.add(e)}var _c=5e3,Tu=class{toast(t){let n=document.querySelector("#toaster");n||(n=document.createElement("div"),n.id="toaster",n.classList.add("toaster","border","rounded","fixed","bottom","right"),document.body.appendChild(n));let r=document.createElement("div");r.classList.add(t.mode||"error","padding","margin"),r.innerHTML=t.message,r.addEventListener("click",()=>r.remove()),setTimeout(()=>r.remove(),_c),n.insertBefore(r,null)}},Sc=new Tu;function Cc(e,t){t||(t={mode:"info"}),Sc.toast({message:e,...t})}function Je(e){Cc(e+"",{mode:"error"})}async function xu(){await zo(),Eu(),bu()}async function Wd(){try{await xu();let e=new URLSearchParams(window.location.search);e.has("id")?Au(e.get("id")):Au()}catch(e){Je(e)}}async function Vd(e){try{await xu();let t=await Xo(),n=mu(t);e.appendChild(n),A(n,"create-invoice",()=>{try{location.href=ue.createInvoice()}catch(r){Je(r)}})}catch(t){Je(t)}}async function Au(e){let t;if(e){if(t=await Go(e),!t)throw"invoice not found"}else t={id:"",date:Date.now(),clientname:"",billto:"",comments:"",email:"",telephone:"",items:[],labor:0,additional:0,mops:[]};let n=await su(t);document.body.appendChild(n),Ic(n),L(n,"change")}function Ic(e){A(e,"print",async()=>{if(await _u(e)){let t=Su(e);Nc(t)}}),A(e,"delete",async()=>{await Oc(e)&&L(e,"list-all-invoices")}),A(e,"submit",async()=>{await _u(e)&&L(e,"list-all-invoices")})}async function Oc(e){let t=gu(e,"id");if(!t)throw"unable to delete this invoice";return await Vo(t),!0}async function _u(e){if(!e.checkValidity())return e.reportValidity(),!1;e.querySelectorAll(".line-item").forEach(n=>{let[r,i]=["#item","#price"].map(u=>n.querySelector(u));Ge.upsertItem({id:r.value,code:r.value,price:i.valueAsNumber})});let t=Su(e);return console.log({requestModel:t}),await Jo(t),yu(e,{id:t.id}),!0}function Su(e){let t=new FormData(e),n={id:t.get("id"),clientname:t.get("clientname"),date:new Date(t.get("date")).valueOf(),billto:t.get("billto"),telephone:t.get("telephone"),email:t.get("email"),comments:t.get("comments"),items:[],labor:Number.parseFloat(t.get("labor")||"0"),additional:Number.parseFloat(t.get("additional")||"0"),mops:[]},r=t.getAll("method_of_payment"),i=t.getAll("amount_paid");n.mops=r.map((l,d)=>({mop:l,paid:parseFloat(i[d])})),console.log("mops",n.mops);let u=null;for(let[l,d]of t.entries())switch(l){case"item":u={},n.items.push(u),u.item=d;break;case"quantity":if(!u)throw"item expected";u.quantity=parseFloat(d);break;case"price":if(!u)throw"item expected";u.price=parseFloat(d);break;case"total":if(!u)throw"item expected";u.total=parseFloat(d);break}return n}function Nc(e){try{document.body.classList.add("print");let t=du(e);document.body.innerHTML="",document.body.appendChild(t),window.document.title=e.clientname,window.print()}catch(t){Je(t)}}export{Wd as init,Nc as print,Vd as renderInvoices};
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
//# sourceMappingURL=invoice.js.map
