var au=Object.create;var Tt=Object.defineProperty;var iu=Object.getOwnPropertyDescriptor;var su=Object.getOwnPropertyNames;var ou=Object.getPrototypeOf,uu=Object.prototype.hasOwnProperty;var cu=e=>Tt(e,"__esModule",{value:!0});var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var lu=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of su(t))!uu.call(e,r)&&r!=="default"&&Tt(e,r,{get:()=>t[r],enumerable:!(n=iu(t,r))||n.enumerable});return e},xt=e=>lu(cu(Tt(e!=null?au(ou(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var Sn=y((el,An)=>{"use strict";An.exports=mu;function mu(e){if(typeof e!="function")throw new Error("Could not parse function signature for injection dependencies: Object is not a function");if(!e.length)return[];var t=/^()\(?([^)=]*)\)? *=>/.exec(e+"")||/^[^(]+([^ \(]*) *\(([^\)]*)\)/.exec(e+"");if(!t)throw new Error("Could not parse function signature for injection dependencies: "+e+"");var n=t[2].replace(/\/\*[\S\s]*?\*\//g," ").replace(/\/\/.*/g," ");function r(i,c,u){return c+u.split(",").map(function(f){return f&&f.trim()}).filter(Boolean).join("@")}return n=n.replace(/(\{)([^}]*)\}/g,r),n=n.replace(/(\[)([^}]*)\]/g,r),n.split(",").map(function(i){return i&&i.trim()}).map(function(i){return i[0]==="{"?i.substring(1).split("@"):i[0]==="["?{items:i.substring(1).split("@")}:i}).filter(Boolean)}});var _t=y((tl,_n)=>{_n.exports=pu;function pu(e,t){if(St("noDeprecation"))return e;var n=!1;function r(){if(!n){if(St("throwDeprecation"))throw new Error(t);St("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}return r}function St(e){try{if(!global.localStorage)return!1}catch{return!1}var t=global.localStorage[e];return t==null?!1:String(t).toLowerCase()==="true"}});var ze=y((nl,hu)=>{hu.exports={name:"faunadb",version:"4.4.1",apiVersion:"4",description:"FaunaDB Javascript driver for Node.JS and Browsers",homepage:"https://fauna.com",repository:"fauna/faunadb-js",license:"MPL-2.0",keywords:["database","fauna","official","driver"],bugs:{url:"https://github.com/fauna/faunadb-js/issues"},files:["index.d.ts","src/","dist/","tools/printReleaseNotes.js"],main:"index.js",scripts:{doc:"jsdoc -c ./jsdoc.json",browserify:"browserify index.js --standalone faunadb -o dist/faunadb.js","browserify-min":"browserify index.js --standalone faunadb | terser -c -m --keep-fnames --keep-classnames -o dist/faunadb-min.js",prettify:'prettier --write "{src,test}/**/*.{js,ts}"',test:"jest --env=node --verbose=false --forceExit ./test","semantic-release":"semantic-release",wp:"webpack",postinstall:"node ./tools/printReleaseNotes",postupdate:"node ./tools/printReleaseNotes","load-test":"node ./tools/loadTest"},types:"index.d.ts",dependencies:{"abort-controller":"^3.0.0","base64-js":"^1.2.0",boxen:"^5.0.1","btoa-lite":"^1.0.0",chalk:"^4.1.1","cross-fetch":"^3.0.6",dotenv:"^8.2.0","fn-annotate":"^1.1.3","object-assign":"^4.1.0","util-deprecate":"^1.0.2"},devDependencies:{browserify:"^16.2.2",eslint:"^5.3.0","eslint-config-prettier":"^6.5.0","eslint-plugin-prettier":"^3.1.1",husky:">=1","ink-docstrap":"^1.2.1",jest:"^24.9.0",jsdoc:"^3.6.3","lint-staged":">=8",prettier:"1.18.2","semantic-release":"^17.1.2",terser:"^4.3.9",webpack:"^5.23.0","webpack-cli":"^4.5.0",yargs:"^16.2.0"},husky:{hooks:{"pre-commit":"lint-staged"}},"lint-staged":{"*.{js,css,json,md}":["prettier --write","git add"],"*.js":["eslint --fix","git add"]},release:{branches:["main"]},browser:{http2:!1,http:!1,https:!1,os:!1,util:!1,boxen:!1,chalk:!1}}});var Cn=y(()=>{});var On=y(()=>{});var Dn=y((Z,Rn)=>{var In=typeof self!="undefined"?self:Z,Ye=function(){function e(){this.fetch=!1,this.DOMException=In.DOMException}return e.prototype=In,new e}();(function(e){var t=function(n){var r={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function i(l){return l&&DataView.prototype.isPrototypeOf(l)}if(r.arrayBuffer)var c=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(l){return l&&c.indexOf(Object.prototype.toString.call(l))>-1};function f(l){if(typeof l!="string"&&(l=String(l)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(l))throw new TypeError("Invalid character in header field name");return l.toLowerCase()}function p(l){return typeof l!="string"&&(l=String(l)),l}function g(l){var m={next:function(){var v=l.shift();return{done:v===void 0,value:v}}};return r.iterable&&(m[Symbol.iterator]=function(){return m}),m}function h(l){this.map={},l instanceof h?l.forEach(function(m,v){this.append(v,m)},this):Array.isArray(l)?l.forEach(function(m){this.append(m[0],m[1])},this):l&&Object.getOwnPropertyNames(l).forEach(function(m){this.append(m,l[m])},this)}h.prototype.append=function(l,m){l=f(l),m=p(m);var v=this.map[l];this.map[l]=v?v+", "+m:m},h.prototype.delete=function(l){delete this.map[f(l)]},h.prototype.get=function(l){return l=f(l),this.has(l)?this.map[l]:null},h.prototype.has=function(l){return this.map.hasOwnProperty(f(l))},h.prototype.set=function(l,m){this.map[f(l)]=p(m)},h.prototype.forEach=function(l,m){for(var v in this.map)this.map.hasOwnProperty(v)&&l.call(m,this.map[v],v,this)},h.prototype.keys=function(){var l=[];return this.forEach(function(m,v){l.push(v)}),g(l)},h.prototype.values=function(){var l=[];return this.forEach(function(m){l.push(m)}),g(l)},h.prototype.entries=function(){var l=[];return this.forEach(function(m,v){l.push([v,m])}),g(l)},r.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);function E(l){if(l.bodyUsed)return Promise.reject(new TypeError("Already read"));l.bodyUsed=!0}function S(l){return new Promise(function(m,v){l.onload=function(){m(l.result)},l.onerror=function(){v(l.error)}})}function J(l){var m=new FileReader,v=S(m);return m.readAsArrayBuffer(l),v}function q(l){var m=new FileReader,v=S(m);return m.readAsText(l),v}function $(l){for(var m=new Uint8Array(l),v=new Array(m.length),D=0;D<m.length;D++)v[D]=String.fromCharCode(m[D]);return v.join("")}function ne(l){if(l.slice)return l.slice(0);var m=new Uint8Array(l.byteLength);return m.set(new Uint8Array(l)),m.buffer}function X(){return this.bodyUsed=!1,this._initBody=function(l){this._bodyInit=l,l?typeof l=="string"?this._bodyText=l:r.blob&&Blob.prototype.isPrototypeOf(l)?this._bodyBlob=l:r.formData&&FormData.prototype.isPrototypeOf(l)?this._bodyFormData=l:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(l)?this._bodyText=l.toString():r.arrayBuffer&&r.blob&&i(l)?(this._bodyArrayBuffer=ne(l.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(l)||u(l))?this._bodyArrayBuffer=ne(l):this._bodyText=l=Object.prototype.toString.call(l):this._bodyText="",this.headers.get("content-type")||(typeof l=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(l)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var l=E(this);if(l)return l;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?E(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(J)}),this.text=function(){var l=E(this);if(l)return l;if(this._bodyBlob)return q(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve($(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(xe)}),this.json=function(){return this.text().then(JSON.parse)},this}var j=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function z(l){var m=l.toUpperCase();return j.indexOf(m)>-1?m:l}function Y(l,m){m=m||{};var v=m.body;if(l instanceof Y){if(l.bodyUsed)throw new TypeError("Already read");this.url=l.url,this.credentials=l.credentials,m.headers||(this.headers=new h(l.headers)),this.method=l.method,this.mode=l.mode,this.signal=l.signal,!v&&l._bodyInit!=null&&(v=l._bodyInit,l.bodyUsed=!0)}else this.url=String(l);if(this.credentials=m.credentials||this.credentials||"same-origin",(m.headers||!this.headers)&&(this.headers=new h(m.headers)),this.method=z(m.method||this.method||"GET"),this.mode=m.mode||this.mode||null,this.signal=m.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&v)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(v)}Y.prototype.clone=function(){return new Y(this,{body:this._bodyInit})};function xe(l){var m=new FormData;return l.trim().split("&").forEach(function(v){if(v){var D=v.split("="),R=D.shift().replace(/\+/g," "),w=D.join("=").replace(/\+/g," ");m.append(decodeURIComponent(R),decodeURIComponent(w))}}),m}function $e(l){var m=new h,v=l.replace(/\r?\n[\t ]+/g," ");return v.split(/\r?\n/).forEach(function(D){var R=D.split(":"),w=R.shift().trim();if(w){var Xe=R.join(":").trim();m.append(w,Xe)}}),m}X.call(Y.prototype);function M(l,m){m||(m={}),this.type="default",this.status=m.status===void 0?200:m.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in m?m.statusText:"OK",this.headers=new h(m.headers),this.url=m.url||"",this._initBody(l)}X.call(M.prototype),M.prototype.clone=function(){return new M(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},M.error=function(){var l=new M(null,{status:0,statusText:""});return l.type="error",l};var wt=[301,302,303,307,308];M.redirect=function(l,m){if(wt.indexOf(m)===-1)throw new RangeError("Invalid status code");return new M(null,{status:m,headers:{location:l}})},n.DOMException=e.DOMException;try{new n.DOMException}catch{n.DOMException=function(m,v){this.message=m,this.name=v;var D=Error(m);this.stack=D.stack},n.DOMException.prototype=Object.create(Error.prototype),n.DOMException.prototype.constructor=n.DOMException}function he(l,m){return new Promise(function(v,D){var R=new Y(l,m);if(R.signal&&R.signal.aborted)return D(new n.DOMException("Aborted","AbortError"));var w=new XMLHttpRequest;function Xe(){w.abort()}w.onload=function(){var Ae={status:w.status,statusText:w.statusText,headers:$e(w.getAllResponseHeaders()||"")};Ae.url="responseURL"in w?w.responseURL:Ae.headers.get("X-Request-URL");var Et="response"in w?w.response:w.responseText;v(new M(Et,Ae))},w.onerror=function(){D(new TypeError("Network request failed"))},w.ontimeout=function(){D(new TypeError("Network request failed"))},w.onabort=function(){D(new n.DOMException("Aborted","AbortError"))},w.open(R.method,R.url,!0),R.credentials==="include"?w.withCredentials=!0:R.credentials==="omit"&&(w.withCredentials=!1),"responseType"in w&&r.blob&&(w.responseType="blob"),R.headers.forEach(function(Ae,Et){w.setRequestHeader(Et,Ae)}),R.signal&&(R.signal.addEventListener("abort",Xe),w.onreadystatechange=function(){w.readyState===4&&R.signal.removeEventListener("abort",Xe)}),w.send(typeof R._bodyInit=="undefined"?null:R._bodyInit)})}return he.polyfill=!0,e.fetch||(e.fetch=he,e.Headers=h,e.Request=Y,e.Response=M),n.Headers=h,n.Request=Y,n.Response=M,n.fetch=he,Object.defineProperty(n,"__esModule",{value:!0}),n}({})})(Ye);Ye.fetch.ponyfill=!0;delete Ye.fetch.polyfill;var ge=Ye;Z=ge.fetch;Z.default=ge.fetch;Z.fetch=ge.fetch;Z.Headers=ge.Headers;Z.Request=ge.Request;Z.Response=ge.Response;Rn.exports=Z});var F=y((ol,Mn)=>{"use strict";var Se=ze(),Ct=Cn(),gu=On(),_e=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:typeof global!="undefined"?global:self;function vu(e,t){if(e==null)throw new TypeError('The constructor to "inherits" must not be null or undefined');if(t==null)throw new TypeError('The super constructor to "inherits" must not be null or undefined');if(t.prototype===void 0)throw new TypeError('The super constructor to "inherits" must have a prototype');e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function Nn(){return typeof window=="undefined"&&typeof process!="undefined"&&process.versions!=null&&process.versions.node!=null}function yu(e){var t=!!(typeof process!="undefined"&&process&&process.env);if(t&&process.env[e]!=null)return process.env[e]}function bu(){var e=navigator.appName,t=""+parseFloat(navigator.appVersion),n,r,i;return(r=navigator.userAgent.indexOf("Opera"))!=-1?(e="Opera",t=navigator.userAgent.substring(r+6),(r=navigator.userAgent.indexOf("Version"))!=-1&&(t=navigator.userAgent.substring(r+8))):(r=navigator.userAgent.indexOf("MSIE"))!=-1?(e="Microsoft Internet Explorer",t=navigator.userAgent.substring(r+5)):e=="Netscape"&&navigator.userAgent.indexOf("Trident/")!=-1?(e="Microsoft Internet Explorer",t=navigator.userAgent.substring(r+5),(r=navigator.userAgent.indexOf("rv:"))!=-1&&(t=navigator.userAgent.substring(r+3))):(r=navigator.userAgent.indexOf("Chrome"))!=-1?(e="Chrome",t=navigator.userAgent.substring(r+7)):(r=navigator.userAgent.indexOf("Safari"))!=-1?(e="Safari",t=navigator.userAgent.substring(r+7),(r=navigator.userAgent.indexOf("Version"))!=-1&&(t=navigator.userAgent.substring(r+8)),navigator.userAgent.indexOf("CriOS")!=-1&&(e="Chrome")):(r=navigator.userAgent.indexOf("Firefox"))!=-1?(e="Firefox",t=navigator.userAgent.substring(r+8)):(n=navigator.userAgent.lastIndexOf(" ")+1)<(r=navigator.userAgent.lastIndexOf("/"))&&(e=navigator.userAgent.substring(n,r),t=navigator.userAgent.substring(r+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),(i=t.indexOf(";"))!=-1&&(t=t.substring(0,i)),(i=t.indexOf(" "))!=-1&&(t=t.substring(0,i)),(i=t.indexOf(")"))!=-1&&(t=t.substring(0,i)),[e,t].join("-")}function wu(){var e="unknown",t=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Chrome OS",r:/CrOS/},{s:"Linux",r:/(Linux|X11(?!.*CrOS))/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var n in t){var r=t[n];if(r.r.test(navigator.userAgent)){e=r.s;break}}var i="unknown";switch(/Windows/.test(e)&&(i=/Windows (.*)/.exec(e)[1],e="Windows"),e){case"Mac OS":case"Mac OS X":case"Android":i=/(?:Android|Mac OS|Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh) ([\.\_\d]+)/.exec(navigator.userAgent)[1];break;case"iOS":i=/OS (\d+)_(\d+)_?(\d+)?/.exec(navigator.appVersion),i=i[1]+"."+i[2]+"."+(i[3]|0);break}return[e,i].join("-")}function Eu(){var e=[{name:"Netlify",check:function(){return process.env.hasOwnProperty("NETLIFY_IMAGES_CDN_DOMAIN")}},{name:"Vercel",check:function(){return process.env.hasOwnProperty("VERCEL")}},{name:"Heroku",check:function(){return process.env.hasOwnProperty("PATH")&&process.env.PATH.indexOf(".heroku")!==-1}},{name:"AWS Lambda",check:function(){return process.env.hasOwnProperty("AWS_LAMBDA_FUNCTION_VERSION")}},{name:"GCP Cloud Functions",check:function(){return process.env.hasOwnProperty("_")&&process.env._.indexOf("google")!==-1}},{name:"GCP Compute Instances",check:function(){return process.env.hasOwnProperty("GOOGLE_CLOUD_PROJECT")}},{name:"Azure Cloud Functions",check:function(){return process.env.hasOwnProperty("WEBSITE_FUNCTIONS_AZUREMONITOR_CATEGORIES")}},{name:"Azure Compute",check:function(){return process.env.hasOwnProperty("ORYX_ENV_TYPE")&&process.env.hasOwnProperty("WEBSITE_INSTANCE_ID")&&process.env.ORYX_ENV_TYPE==="AppService"}},{name:"Mongo Stitch",check:function(){return typeof _e.StitchError=="function"}},{name:"Render",check:function(){return process.env.hasOwnProperty("RENDER_SERVICE_ID")}},{name:"Begin",check:function(){return process.env.hasOwnProperty("BEGIN_DATA_SCOPE_ID")}}],t=e.find(n=>n.check());return t?t.name:"unknown"}function Tu(e,t){return e===void 0?t:e}function xu(e,t){var n={};for(var r in e){if(!(r in t))throw new Error("No such option "+r);n[r]=e[r]}for(var i in t)i in n||(n[i]=t[i]);return n}function Au(e){var t={};for(var n in e){var r=e[n];r!=null&&(t[n]=r)}return t}function Su(e){var t={};for(var n in e){var r=e[n];r!==void 0&&(t[n]=r)}return t}function Ln(e,t){return typeof e=="object"&&e!==null&&Boolean(e[t])}function _u(e,t,n){return n=typeof n=="object"?Pn(n):n,[e,t?t.charAt(0)==="/"?"":"/"+t:"",n?n.charAt(0)==="?"?"":"?"+n:""].join("")}function Pn(e,t){t=t||"";var n=[],r,i;typeof t!="string"&&(t="?");for(i in e)if(Ln(e,i)){if(r=e[i],!r&&(r==null||isNaN(r))&&(r=""),i=jn(i),r=jn(r),i===null||r===null)continue;n.push(i+"="+r)}return n.length?t+n.join("&"):""}function jn(e){try{return encodeURIComponent(e)}catch{return null}}function Cu(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n}function Fn(e){return typeof e=="function"?e:typeof _e.fetch=="function"?_e.fetch.bind(_e):Dn()}function Ou(){var e;return n=>{if(!Nn()||e||!n)return;function r(i){var c=i>Se.version;c&&console.info(gu("New "+Se.name+" version available "+Ct.dim(Se.version)+Ct.reset(" \u2192 ")+Ct.green(i)+`
Changelog: https://github.com/${Se.repository}/blob/main/CHANGELOG.md`,{padding:1,borderColor:"yellow"}))}e=!0,Fn()("https://registry.npmjs.org/"+Se.name).then(i=>i.json()).then(i=>r(i["dist-tags"].latest)).catch(i=>{console.error("Unable to check new driver version"),console.error(i)})}}Mn.exports={notifyAboutNewVersion:Ou,crossGlobal:_e,mergeObjects:Cu,formatUrl:_u,querystringify:Pn,inherits:vu,isNodeEnv:Nn,getEnvVariable:yu,defaults:Tu,applyDefaults:xu,removeNullAndUndefinedValues:Au,removeUndefinedValues:Su,checkInstanceHasProperty:Ln,getBrowserDetails:bu,getBrowserOsDetails:wu,getNodeRuntimeEnv:Eu,resolveFetch:Fn}});var Qe=y((ul,qn)=>{"use strict";var Iu=F();function ve(e){this.raw=e}ve.prototype._isFaunaExpr=!0;ve.prototype.toJSON=function(){return this.raw};ve.prototype.toFQL=function(){return T(this.raw)};var Ru=["Do","Call","Union","Intersection","Difference","Equals","Add","BitAnd","BitOr","BitXor","Divide","Max","Min","Modulo","Multiply","Subtract","LT","LTE","GT","GTE","And","Or"],kn={containsstrregex:"ContainsStrRegex",endswith:"EndsWith",findstr:"FindStr",findstrregex:"FindStrRegex",gt:"GT",gte:"GTE",is_nonempty:"is_non_empty",lowercase:"LowerCase",lt:"LT",lte:"LTE",ltrim:"LTrim",ngram:"NGram",rtrim:"RTrim",regexescape:"RegexEscape",replacestr:"ReplaceStr",replacestrregex:"ReplaceStrRegex",startswith:"StartsWith",substring:"SubString",titlecase:"TitleCase",uppercase:"UpperCase"};function Bn(e){return e instanceof ve||Iu.checkInstanceHasProperty(e,"_isFaunaExpr")}function Ze(e){return"{"+Object.keys(e).map(function(t){return'"'+t+'": '+T(e[t])}).join(", ")+"}"}function Ot(e,t){return e.map(function(n){return t(n)}).join(", ")}function Du(e){return e in kn&&(e=kn[e]),e.split("_").map(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}).join("")}var T=function(e,t){if(Bn(e)){if("value"in e)return e.toString();e=e.raw}if(e===null)return"null";switch(typeof e){case"string":return JSON.stringify(e);case"symbol":case"number":case"boolean":return e.toString();case"undefined":return"undefined"}if(Array.isArray(e)){var n=Ot(e,T);return Ru.indexOf(t)!=-1?n:"["+n+"]"}if("match"in e){var r=T(e.match),i=e.terms||[];return Bn(i)&&(i=i.raw),Array.isArray(i)&&i.length==0?"Match("+r+")":Array.isArray(i)?"Match("+r+", ["+Ot(i,T)+"])":"Match("+r+", "+T(i)+")"}if("paginate"in e){var c=Object.keys(e);if(c.length===1)return"Paginate("+T(e.paginate)+")";var u=Object.assign({},e);return delete u.paginate,"Paginate("+T(e.paginate)+", "+Ze(u)+")"}if("let"in e&&"in"in e){var f="";return Array.isArray(e.let)?f="["+Ot(e.let,Ze)+"]":f=Ze(e.let),"Let("+f+", "+T(e.in)+")"}if("object"in e)return Ze(e.object);if("merge"in e)return e.lambda?"Merge("+T(e.merge)+", "+T(e.with)+", "+T(e.lambda)+")":"Merge("+T(e.merge)+", "+T(e.with)+")";if("lambda"in e)return"Lambda("+T(e.lambda)+", "+T(e.expr)+")";if("filter"in e)return"Filter("+T(e.collection)+", "+T(e.filter)+")";if("call"in e)return"Call("+T(e.call)+", "+T(e.arguments)+")";if("map"in e)return"Map("+T(e.collection)+", "+T(e.map)+")";if("foreach"in e)return"Foreach("+T(e.collection)+", "+T(e.foreach)+")";var p=Object.keys(e),g=p[0];g=Du(g);var h=p.filter(E=>e[E]!==null||p.length>1).map(E=>T(e[E],g)).join(", ");return g+"("+h+")"};ve.toString=T;qn.exports=ve});var ae=y((cl,Jn)=>{"use strict";var N=F();function P(e,t,n){Error.call(this),this.name=e,this.message=t,this.description=n}N.inherits(P,Error);function Hn(e){P.call(this,"InvalidValue",e)}N.inherits(Hn,P);function Un(e,t,n,r){var i=`${r} function requires ${u(e,t)} argument(s) but ${n} were given`,c=f(r);P.call(this,"InvalidArity",`${i}
${c}`),this.min=e,this.max=t,this.actual=n;function u(p,g){return g===null?"at least "+p:p===null?"up to "+g:p===g?p:"from "+p+" to "+g}function f(p){var g="https://docs.fauna.com/fauna/current/api/fql/functions/";return`For more info, see the docs: ${g}${p.toLowerCase()}`}}N.inherits(Un,P);function _(e,t){var n=t.responseContent,r=n.errors,i=r.length===0?'(empty "errors")':r[0].code,c=r.length===0?'(empty "errors")':r[0].description;P.call(this,e,i,c),this.requestResult=t}N.inherits(_,P);_.prototype.errors=function(){return this.requestResult.responseContent.errors};_.raiseForStatusCode=function(e){var t=e.statusCode;if(t<200||t>=300)switch(t){case 400:throw new It(e);case 401:throw new Rt(e);case 403:throw new Dt(e);case 404:throw new Nt(e);case 405:throw new Lt(e);case 429:throw new Pt(e);case 500:throw new jt(e);case 503:throw new Ft(e);default:throw new _("UnknownError",e)}};function It(e){_.call(this,"BadRequest",e)}N.inherits(It,_);function Rt(e){_.call(this,"Unauthorized",e)}N.inherits(Rt,_);function Dt(e){_.call(this,"PermissionDenied",e)}N.inherits(Dt,_);function Nt(e){_.call(this,"NotFound",e)}N.inherits(Nt,_);function Lt(e){_.call(this,"MethodNotAllowed",e)}N.inherits(Lt,_);function Pt(e){_.call(this,"TooManyRequests",e)}N.inherits(Pt,_);function jt(e){_.call(this,"InternalError",e)}N.inherits(jt,_);function Ft(e){_.call(this,"UnavailableError",e)}N.inherits(Ft,_);function Ke(e,t,n){P.call(this,e,t,n)}N.inherits(Ke,P);function Wn(e){P.call(this,"StreamsNotSupported","streams not supported",e)}N.inherits(Wn,Ke);function Vn(e){var t=e.data||{};P.call(this,"StreamErrorEvent",t.code,t.description),this.event=e}N.inherits(Vn,Ke);function Gn(e,t){P.call(this,"ClientClosed",e,t)}N.inherits(Gn,P);Jn.exports={FaunaError:P,ClientClosed:Gn,FaunaHTTPError:_,InvalidValue:Hn,InvalidArity:Un,BadRequest:It,Unauthorized:Rt,PermissionDenied:Dt,NotFound:Nt,MethodNotAllowed:Lt,TooManyRequests:Pt,InternalError:jt,UnavailableError:Ft,StreamError:Ke,StreamsNotSupported:Wn,StreamErrorEvent:Vn}});var zn=y(et=>{"use strict";et.byteLength=Lu;et.toByteArray=ju;et.fromByteArray=ku;var W=[],k=[],Nu=typeof Uint8Array!="undefined"?Uint8Array:Array,Mt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(se=0,$n=Mt.length;se<$n;++se)W[se]=Mt[se],k[Mt.charCodeAt(se)]=se;var se,$n;k["-".charCodeAt(0)]=62;k["_".charCodeAt(0)]=63;function Xn(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Lu(e){var t=Xn(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Pu(e,t,n){return(t+n)*3/4-n}function ju(e){var t,n=Xn(e),r=n[0],i=n[1],c=new Nu(Pu(e,r,i)),u=0,f=i>0?r-4:r,p;for(p=0;p<f;p+=4)t=k[e.charCodeAt(p)]<<18|k[e.charCodeAt(p+1)]<<12|k[e.charCodeAt(p+2)]<<6|k[e.charCodeAt(p+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=t&255;return i===2&&(t=k[e.charCodeAt(p)]<<2|k[e.charCodeAt(p+1)]>>4,c[u++]=t&255),i===1&&(t=k[e.charCodeAt(p)]<<10|k[e.charCodeAt(p+1)]<<4|k[e.charCodeAt(p+2)]>>2,c[u++]=t>>8&255,c[u++]=t&255),c}function Fu(e){return W[e>>18&63]+W[e>>12&63]+W[e>>6&63]+W[e&63]}function Mu(e,t,n){for(var r,i=[],c=t;c<n;c+=3)r=(e[c]<<16&16711680)+(e[c+1]<<8&65280)+(e[c+2]&255),i.push(Fu(r));return i.join("")}function ku(e){for(var t,n=e.length,r=n%3,i=[],c=16383,u=0,f=n-r;u<f;u+=c)i.push(Mu(e,u,u+c>f?f:u+c));return r===1?(t=e[n-1],i.push(W[t>>2]+W[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(W[t>>10]+W[t>>4&63]+W[t<<2&63]+"=")),i.join("")}});var Yn=y(()=>{});var Ie=y((ml,Qn)=>{"use strict";var kt=zn(),Bu=_t(),Bt=ae(),qt=Qe(),Q=F(),tt=Q.isNodeEnv()?Yn():null,Zn=tt&&tt.inspect.custom,qu=tt?tt.inspect:JSON.stringify;function K(){}K.prototype._isFaunaValue=!0;Q.inherits(K,qt);function C(e,t,n){if(!e)throw new Bt.InvalidValue("id cannot be null or undefined");this.value={id:e},t&&(this.value.collection=t),n&&(this.value.database=n)}C.prototype._isFaunaRef=!0;Q.inherits(C,K);Object.defineProperty(C.prototype,"collection",{get:function(){return this.value.collection}});Object.defineProperty(C.prototype,"class",{get:Bu(function(){return this.value.collection},"class is deprecated, use collection instead")});Object.defineProperty(C.prototype,"database",{get:function(){return this.value.database}});Object.defineProperty(C.prototype,"id",{get:function(){return this.value.id}});C.prototype.toJSON=function(){return{"@ref":this.value}};ye(C,function(){var e={collections:"Collection",databases:"Database",indexes:"Index",functions:"Function",roles:"Role",access_providers:"AccessProvider"},t=function(r){return r.collection===void 0},n=function(r){if(t(r)){var i=r.database!==void 0?r.database.toString():"";return r.id==="access_providers"?"AccessProviders("+i+")":r.id.charAt(0).toUpperCase()+r.id.slice(1)+"("+i+")"}if(t(r.collection)){var c=e[r.collection.id];if(c!==void 0){var i=r.database!==void 0?", "+r.database.toString():"";return c+'("'+r.id+'"'+i+")"}}return"Ref("+n(r.collection)+', "'+r.id+'")'};return n(this)});C.prototype.valueOf=function(){return this.value};C.prototype.equals=function(e){return(e instanceof C||Q.checkInstanceHasProperty(e,"_isFaunaRef"))&&this.id===e.id&&(this.collection===void 0&&e.collection===void 0||this.collection.equals(e.collection))&&(this.database===void 0&&e.database===void 0||this.database.equals(e.database))};var ee={COLLECTIONS:new C("collections"),INDEXES:new C("indexes"),DATABASES:new C("databases"),FUNCTIONS:new C("functions"),ROLES:new C("roles"),KEYS:new C("keys"),ACCESS_PROVIDERS:new C("access_providers")};ee.fromName=function(e){switch(e){case"collections":return ee.COLLECTIONS;case"indexes":return ee.INDEXES;case"databases":return ee.DATABASES;case"functions":return ee.FUNCTIONS;case"roles":return ee.ROLES;case"keys":return ee.KEYS;case"access_providers":return ee.ACCESS_PROVIDERS}return new C(e)};function nt(e){this.value=e}Q.inherits(nt,K);ye(nt,function(){return qt.toString(this.value)});nt.prototype.toJSON=function(){return{"@set":this.value}};function Ce(e){if(e instanceof Date)e=e.toISOString();else if(e.charAt(e.length-1)!=="Z")throw new Bt.InvalidValue("Only allowed timezone is 'Z', got: "+e);this.value=e}Q.inherits(Ce,K);Object.defineProperty(Ce.prototype,"date",{get:function(){return new Date(this.value)}});ye(Ce,function(){return'Time("'+this.value+'")'});Ce.prototype.toJSON=function(){return{"@ts":this.value}};function Oe(e){e instanceof Date&&(e=e.toISOString().slice(0,10)),this.value=e}Q.inherits(Oe,K);Object.defineProperty(Oe.prototype,"date",{get:function(){return new Date(this.value)}});ye(Oe,function(){return'Date("'+this.value+'")'});Oe.prototype.toJSON=function(){return{"@date":this.value}};function rt(e){if(e instanceof ArrayBuffer)this.value=new Uint8Array(e);else if(typeof e=="string")this.value=kt.toByteArray(e);else if(e instanceof Uint8Array)this.value=e;else throw new Bt.InvalidValue("Bytes type expect argument to be either Uint8Array|ArrayBuffer|string, got: "+qu(e))}Q.inherits(rt,K);ye(rt,function(){return'Bytes("'+kt.fromByteArray(this.value)+'")'});rt.prototype.toJSON=function(){return{"@bytes":kt.fromByteArray(this.value)}};function at(e){this.value=e}Q.inherits(at,K);ye(at,function(){return"Query("+qt.toString(this.value)+")"});at.prototype.toJSON=function(){return{"@query":this.value}};function ye(e,t){e.prototype.toString=t,e.prototype.inspect=t,Zn&&(e.prototype[Zn]=t)}Qn.exports={Value:K,Ref:C,Native:ee,SetRef:nt,FaunaTime:Ce,FaunaDate:Oe,Bytes:rt,Query:at}});var Ht=y((pl,er)=>{"use strict";var Kn=Object.getOwnPropertySymbols,Hu=Object.prototype.hasOwnProperty,Uu=Object.prototype.propertyIsEnumerable;function Wu(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function Vu(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(c){return t[c]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(c){i[c]=c}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}er.exports=Vu()?Object.assign:function(e,t){for(var n,r=Wu(e),i,c=1;c<arguments.length;c++){n=Object(arguments[c]);for(var u in n)Hu.call(n,u)&&(r[u]=n[u]);if(Kn){i=Kn(n);for(var f=0;f<i.length;f++)Uu.call(n,i[f])&&(r[i[f]]=n[i[f]])}}return r}});var Re=y((hl,Vs)=>{"use strict";var Gu=Sn(),ie=_t(),s=Qe(),Ut=ae(),tr=Ie(),Ju=Ht(),b=F();function nr(){switch(o.between(1,2,arguments,nr.name),arguments.length){case 1:return new s({"@ref":a(arguments[0])});case 2:return new s({ref:a(arguments[0]),id:a(arguments[1])})}}function rr(e){return o.exact(1,arguments,rr.name),new tr.Bytes(e)}function ar(e){return o.exact(1,arguments,ar.name),new s({abort:a(e)})}function ir(e,t){return o.exact(2,arguments,ir.name),new s({at:a(e),expr:a(t)})}function sr(e,t){o.exact(2,arguments,sr.name);var n=[];if(Array.isArray(e)?n=e.map(function(i){return st(i)}):n=Object.keys(e).filter(function(i){return e[i]!==void 0}).map(function(i){var c={};return c[i]=a(e[i]),c}),typeof t=="function")if(Array.isArray(e)){var r=[];e.forEach(function(i){Object.keys(i).forEach(function(c){r.push(be(c))})}),t=t.apply(null,r)}else t=t.apply(null,Object.keys(e).map(function(i){return be(i)}));return new s({let:n,in:a(t)})}function be(e){return o.exact(1,arguments,be.name),new s({var:a(e)})}function or(e,t,n){return o.exact(3,arguments,or.name),new s({if:a(e),then:a(t),else:a(n)})}function ur(){o.min(1,arguments,ur.name);var e=it(arguments);return new s({do:a(e)})}var cr=function(e){return o.exact(1,arguments,cr.name),new s({object:st(e)})};function Wt(){switch(o.between(1,2,arguments,Wt.name),arguments.length){case 1:var e=arguments[0];if(typeof e=="function")return $u(e);if(e instanceof s||b.checkInstanceHasProperty(e,"_isFaunaExpr"))return e;throw new Ut.InvalidValue("Lambda function takes either a Function or an Expr.");case 2:var t=arguments[0],n=arguments[1];return Vt(t,n)}}function $u(e){var t=Gu(e);switch(t.length){case 0:throw new Ut.InvalidValue("Provided Function must take at least 1 argument.");case 1:return Vt(t[0],e(be(t[0])));default:return Vt(t,e.apply(null,t.map(function(n){return be(n)})))}}function Vt(e,t){return new s({lambda:a(e),expr:a(t)})}function lr(e){o.min(1,arguments,lr.name);var t=it(arguments);return t.shift(),new s({call:a(e),arguments:a(A(t))})}function fr(e){return o.exact(1,arguments,fr.name),new s({query:a(e)})}function dr(e,t){return o.exact(2,arguments,dr.name),new s({map:a(t),collection:a(e)})}function mr(e,t){return o.exact(2,arguments,mr.name),new s({foreach:a(t),collection:a(e)})}function pr(e,t){return o.exact(2,arguments,pr.name),new s({filter:a(t),collection:a(e)})}function hr(e,t){return o.exact(2,arguments,hr.name),new s({take:a(e),collection:a(t)})}function gr(e,t){return o.exact(2,arguments,gr.name),new s({drop:a(e),collection:a(t)})}function vr(e,t){return o.exact(2,arguments,vr.name),new s({prepend:a(e),collection:a(t)})}function yr(e,t){return o.exact(2,arguments,yr.name),new s({append:a(e),collection:a(t)})}function br(e){return o.exact(1,arguments,br.name),new s({is_empty:a(e)})}function wr(e){return o.exact(1,arguments,wr.name),new s({is_nonempty:a(e)})}function Er(e){return o.exact(1,arguments,Er.name),new s({is_number:a(e)})}function Tr(e){return o.exact(1,arguments,Tr.name),new s({is_double:a(e)})}function xr(e){return o.exact(1,arguments,xr.name),new s({is_integer:a(e)})}function Ar(e){return o.exact(1,arguments,Ar.name),new s({is_boolean:a(e)})}function Sr(e){return o.exact(1,arguments,Sr.name),new s({is_null:a(e)})}function _r(e){return o.exact(1,arguments,_r.name),new s({is_bytes:a(e)})}function Cr(e){return o.exact(1,arguments,Cr.name),new s({is_timestamp:a(e)})}function Or(e){return o.exact(1,arguments,Or.name),new s({is_date:a(e)})}function Ir(e){return o.exact(1,arguments,Ir.name),new s({is_string:a(e)})}function Rr(e){return o.exact(1,arguments,Rr.name),new s({is_array:a(e)})}function Dr(e){return o.exact(1,arguments,Dr.name),new s({is_object:a(e)})}function Nr(e){return o.exact(1,arguments,Nr.name),new s({is_ref:a(e)})}function Lr(e){return o.exact(1,arguments,Lr.name),new s({is_set:a(e)})}function Pr(e){return o.exact(1,arguments,Pr.name),new s({is_doc:a(e)})}function jr(e){return o.exact(1,arguments,jr.name),new s({is_lambda:a(e)})}function Fr(e){return o.exact(1,arguments,Fr.name),new s({is_collection:a(e)})}function Mr(e){return o.exact(1,arguments,Mr.name),new s({is_database:a(e)})}function kr(e){return o.exact(1,arguments,kr.name),new s({is_index:a(e)})}function Br(e){return o.exact(1,arguments,Br.name),new s({is_function:a(e)})}function qr(e){return o.exact(1,arguments,qr.name),new s({is_key:a(e)})}function Hr(e){return o.exact(1,arguments,Hr.name),new s({is_token:a(e)})}function Ur(e){return o.exact(1,arguments,Ur.name),new s({is_credentials:a(e)})}function Wr(e){return o.exact(1,arguments,Wr.name),new s({is_role:a(e)})}function Vr(e,t){return o.between(1,2,arguments,Vr.name),t=b.defaults(t,null),new s(L({get:a(e)},{ts:a(t)}))}function Gr(e){return o.exact(1,arguments,Gr.name),new s({key_from_secret:a(e)})}function Jr(e,t,n){return o.exact(3,arguments,Jr.name),new s({reduce:a(e),initial:a(t),collection:a(n)})}function $r(e,t){return o.between(1,2,arguments,$r.name),t=b.defaults(t,{}),new s(Ju({paginate:a(e)},st(t)))}function Xr(e,t){return o.between(1,2,arguments,Xr.name),t=b.defaults(t,null),new s(L({exists:a(e)},{ts:a(t)}))}function zr(e,t){return o.between(1,2,arguments,zr.name),new s({create:a(e),params:a(t)})}function Yr(e,t){return o.exact(2,arguments,Yr.name),new s({update:a(e),params:a(t)})}function Zr(e,t){return o.exact(2,arguments,Zr.name),new s({replace:a(e),params:a(t)})}function Qr(e){return o.exact(1,arguments,Qr.name),new s({delete:a(e)})}function Kr(e,t,n,r){return o.exact(4,arguments,Kr.name),new s({insert:a(e),ts:a(t),action:a(n),params:a(r)})}function ea(e,t,n){return o.exact(3,arguments,ea.name),new s({remove:a(e),ts:a(t),action:a(n)})}function ta(e){return o.exact(1,arguments,ta.name),new s({create_class:a(e)})}function na(e){return o.exact(1,arguments,na.name),new s({create_collection:a(e)})}function ra(e){return o.exact(1,arguments,ra.name),new s({create_database:a(e)})}function aa(e){return o.exact(1,arguments,aa.name),new s({create_index:a(e)})}function ia(e){return o.exact(1,arguments,ia.name),new s({create_key:a(e)})}function sa(e){return o.exact(1,arguments,sa.name),new s({create_function:a(e)})}function oa(e){return o.exact(1,arguments,oa.name),new s({create_role:a(e)})}function ua(e){return o.exact(1,arguments,ua.name),new s({create_access_provider:a(e)})}function ca(e){return o.exact(1,arguments,ca.name),new s({singleton:a(e)})}function la(e){return o.exact(1,arguments,la.name),new s({events:a(e)})}function fa(e){o.min(1,arguments,fa.name);var t=it(arguments);return t.shift(),new s({match:a(e),terms:a(A(t))})}function da(){return o.min(1,arguments,da.name),new s({union:a(A(arguments))})}function ma(e,t,n){return o.between(2,3,arguments,ma.name),new s(L({merge:a(e),with:a(t)},{lambda:a(n)}))}function pa(){return o.min(1,arguments,pa.name),new s({intersection:a(A(arguments))})}function ha(){return o.min(1,arguments,ha.name),new s({difference:a(A(arguments))})}function ga(e){return o.exact(1,arguments,ga.name),new s({distinct:a(e)})}function va(e,t){return o.exact(2,arguments,va.name),new s({join:a(e),with:a(t)})}function ya(e,t,n){return o.exact(3,arguments,ya.name),new s({range:a(e),from:a(t),to:a(n)})}function ba(e,t){return o.exact(2,arguments,ba.name),new s({login:a(e),params:a(t)})}function wa(e){return o.exact(1,arguments,wa.name),new s({logout:a(e)})}function Ea(e,t){return o.exact(2,arguments,Ea.name),new s({identify:a(e),password:a(t)})}function Ta(){return o.exact(0,arguments,Ta.name),new s({identity:null})}function xa(){return o.exact(0,arguments,xa.name),new s({current_identity:null})}function Aa(){return o.exact(0,arguments,Aa.name),new s({has_identity:null})}function Sa(){return o.exact(0,arguments,Sa.name),new s({has_current_identity:null})}function _a(){return o.exact(0,arguments,_a.name),new s({current_token:null})}function Ca(){return o.exact(0,arguments,Ca.name),new s({has_current_token:null})}function Oa(e,t){return o.min(1,arguments,Oa.name),t=b.defaults(t,null),new s(L({concat:a(e)},{separator:a(t)}))}function Ia(e,t){return o.min(1,arguments,Ia.name),new s(L({casefold:a(e)},{normalizer:a(t)}))}function Ra(e,t){return o.exact(2,arguments,Ra.name),new s({containsstr:a(e),search:a(t)})}function Da(e,t){return o.exact(2,arguments,Da.name),new s({containsstrregex:a(e),pattern:a(t)})}function Na(e,t){return o.exact(2,arguments,Na.name),new s({startswith:a(e),search:a(t)})}function La(e,t){return o.exact(2,arguments,La.name),new s({endswith:a(e),search:a(t)})}function Pa(e){return o.exact(1,arguments,Pa.name),new s({regexescape:a(e)})}function ja(e,t,n){return o.between(2,3,arguments,ja.name),n=b.defaults(n,null),new s(L({findstr:a(e),find:a(t)},{start:a(n)}))}function Fa(e,t,n,r){return o.between(2,4,arguments,Fa.name),n=b.defaults(n,null),new s(L({findstrregex:a(e),pattern:a(t)},{start:a(n),num_results:a(r)}))}function Ma(e){return o.exact(1,arguments,Ma.name),new s({length:a(e)})}function ka(e){return o.exact(1,arguments,ka.name),new s({lowercase:a(e)})}function Ba(e){return o.exact(1,arguments,Ba.name),new s({ltrim:a(e)})}function qa(e,t,n){return o.between(1,3,arguments,qa.name),t=b.defaults(t,null),n=b.defaults(n,null),new s(L({ngram:a(e)},{min:a(t),max:a(n)}))}function Ha(e,t){return o.between(1,2,arguments,Ha.name),t=b.defaults(t,null),new s(L({repeat:a(e)},{number:a(t)}))}function Ua(e,t,n){return o.exact(3,arguments,Ua.name),new s({replacestr:a(e),find:a(t),replace:a(n)})}function Wa(e,t,n,r){return o.between(3,4,arguments,Wa.name),r=b.defaults(r,null),new s(L({replacestrregex:a(e),pattern:a(t),replace:a(n)},{first:a(r)}))}function Va(e){return o.exact(1,arguments,Va.name),new s({rtrim:a(e)})}function Ga(e){return o.exact(1,arguments,Ga.name),new s({space:a(e)})}function Ja(e,t,n){return o.between(1,3,arguments,Ja.name),t=b.defaults(t,null),n=b.defaults(n,null),new s(L({substring:a(e)},{start:a(t),length:a(n)}))}function $a(e){return o.exact(1,arguments,$a.name),new s({titlecase:a(e)})}function Xa(e){return o.exact(1,arguments,Xa.name),new s({trim:a(e)})}function za(e){return o.exact(1,arguments,za.name),new s({uppercase:a(e)})}function Ya(e){o.min(1,arguments,Ya.name);var t=it(arguments);return t.shift(),new s({format:a(e),values:a(A(t))})}function Za(e){return o.exact(1,arguments,Za.name),new s({time:a(e)})}function Qa(e,t){return o.exact(2,arguments,Qa.name),new s({epoch:a(e),unit:a(t)})}function Ka(e,t,n){return o.exact(3,arguments,Ka.name),new s({time_add:a(e),offset:a(t),unit:a(n)})}function ei(e,t,n){return o.exact(3,arguments,ei.name),new s({time_subtract:a(e),offset:a(t),unit:a(n)})}function ti(e,t,n){return o.exact(3,arguments,ti.name),new s({time_diff:a(e),other:a(t),unit:a(n)})}function ni(e){return o.exact(1,arguments,ni.name),new s({date:a(e)})}function ri(){return o.exact(0,arguments,ri.name),new s({now:a(null)})}function ai(){return o.exact(0,arguments,ai.name),new s({next_id:null})}function ii(){return o.exact(0,arguments,ii.name),new s({new_id:null})}function si(e,t){switch(o.between(1,2,arguments,si.name),arguments.length){case 1:return new s({database:a(e)});case 2:return new s({database:a(e),scope:a(t)})}}function oi(e,t){switch(o.between(1,2,arguments,oi.name),arguments.length){case 1:return new s({index:a(e)});case 2:return new s({index:a(e),scope:a(t)})}}function ui(e,t){switch(o.between(1,2,arguments,ui.name),arguments.length){case 1:return new s({class:a(e)});case 2:return new s({class:a(e),scope:a(t)})}}function ci(e,t){switch(o.between(1,2,arguments,ci.name),arguments.length){case 1:return new s({collection:a(e)});case 2:return new s({collection:a(e),scope:a(t)})}}function li(e,t){switch(o.between(1,2,arguments,li.name),arguments.length){case 1:return new s({function:a(e)});case 2:return new s({function:a(e),scope:a(t)})}}function fi(e,t){return o.between(1,2,arguments,fi.name),t=b.defaults(t,null),new s(L({role:a(e)},{scope:a(t)}))}function di(e){return o.max(1,arguments,di.name),e=b.defaults(e,null),new s({access_providers:a(e)})}function mi(e){return o.max(1,arguments,mi.name),e=b.defaults(e,null),new s({classes:a(e)})}function pi(e){return o.max(1,arguments,pi.name),e=b.defaults(e,null),new s({collections:a(e)})}function hi(e){return o.max(1,arguments,hi.name),e=b.defaults(e,null),new s({databases:a(e)})}function gi(e){return o.max(1,arguments,gi.name),e=b.defaults(e,null),new s({indexes:a(e)})}function vi(e){return o.max(1,arguments,vi.name),e=b.defaults(e,null),new s({functions:a(e)})}function yi(e){return o.max(1,arguments,yi.name),e=b.defaults(e,null),new s({roles:a(e)})}function bi(e){return o.max(1,arguments,bi.name),e=b.defaults(e,null),new s({keys:a(e)})}function wi(e){return o.max(1,arguments,wi.name),e=b.defaults(e,null),new s({tokens:a(e)})}function Ei(e){return o.max(1,arguments,Ei.name),e=b.defaults(e,null),new s({credentials:a(e)})}function Ti(){return o.min(1,arguments,Ti.name),new s({equals:a(A(arguments))})}function xi(e,t){return o.exact(2,arguments,xi.name),new s({contains:a(e),in:a(t)})}function Ai(e,t){return o.exact(2,arguments,Ai.name),new s({contains_value:a(e),in:a(t)})}function Si(e,t){return o.exact(2,arguments,Si.name),new s({contains_field:a(e),in:a(t)})}function _i(e,t){return o.exact(2,arguments,_i.name),new s({contains_path:a(e),in:a(t)})}function Ci(e,t,n){o.between(2,3,arguments,Ci.name);var r={select:a(e),from:a(t)};return n!==void 0&&(r.default=a(n)),new s(r)}function Oi(e,t){return o.exact(2,arguments,Oi.name),new s({select_all:a(e),from:a(t)})}function Ii(e){return o.exact(1,arguments,Ii.name),new s({abs:a(e)})}function Ri(){return o.min(1,arguments,Ri.name),new s({add:a(A(arguments))})}function Di(){return o.min(1,arguments,Di.name),new s({bitand:a(A(arguments))})}function Ni(e){return o.exact(1,arguments,Ni.name),new s({bitnot:a(e)})}function Li(){return o.min(1,arguments,Li.name),new s({bitor:a(A(arguments))})}function Pi(){return o.min(1,arguments,Pi.name),new s({bitxor:a(A(arguments))})}function ji(e){return o.exact(1,arguments,ji.name),new s({ceil:a(e)})}function Fi(){return o.min(1,arguments,Fi.name),new s({divide:a(A(arguments))})}function Mi(e){return o.exact(1,arguments,Mi.name),new s({floor:a(e)})}function ki(){return o.min(1,arguments,ki.name),new s({max:a(A(arguments))})}function Bi(){return o.min(1,arguments,Bi.name),new s({min:a(A(arguments))})}function qi(){return o.min(1,arguments,qi.name),new s({modulo:a(A(arguments))})}function Hi(){return o.min(1,arguments,Hi.name),new s({multiply:a(A(arguments))})}function Ui(e,t){return o.min(1,arguments,Ui.name),t=b.defaults(t,null),new s(L({round:a(e)},{precision:a(t)}))}function Wi(){return o.min(1,arguments,Wi.name),new s({subtract:a(A(arguments))})}function Vi(e){return o.exact(1,arguments,Vi.name),new s({sign:a(e)})}function Gi(e){return o.exact(1,arguments,Gi.name),new s({sqrt:a(e)})}function Ji(e,t){return o.min(1,arguments,Ji.name),t=b.defaults(t,null),new s(L({trunc:a(e)},{precision:a(t)}))}function $i(e){return o.exact(1,arguments,$i.name),new s({count:a(e)})}function Xi(e){return o.exact(1,arguments,Xi.name),new s({sum:a(e)})}function zi(e){return o.exact(1,arguments,zi.name),new s({mean:a(e)})}function Yi(e){return o.exact(1,arguments,Yi.name),new s({any:a(e)})}function Zi(e){return o.exact(1,arguments,Zi.name),new s({all:a(e)})}function Qi(e){return o.exact(1,arguments,Qi.name),new s({acos:a(e)})}function Ki(e){return o.exact(1,arguments,Ki.name),new s({asin:a(e)})}function es(e){return o.exact(1,arguments,es.name),new s({atan:a(e)})}function ts(e){return o.exact(1,arguments,ts.name),new s({cos:a(e)})}function ns(e){return o.exact(1,arguments,ns.name),new s({cosh:a(e)})}function rs(e){return o.exact(1,arguments,rs.name),new s({degrees:a(e)})}function as(e){return o.exact(1,arguments,as.name),new s({exp:a(e)})}function is(e,t){return o.min(1,arguments,is.name),t=b.defaults(t,null),new s(L({hypot:a(e)},{b:a(t)}))}function ss(e){return o.exact(1,arguments,ss.name),new s({ln:a(e)})}function os(e){return o.exact(1,arguments,os.name),new s({log:a(e)})}function us(e,t){return o.min(1,arguments,us.name),t=b.defaults(t,null),new s(L({pow:a(e)},{exp:a(t)}))}function cs(e){return o.exact(1,arguments,cs.name),new s({radians:a(e)})}function ls(e){return o.exact(1,arguments,ls.name),new s({sin:a(e)})}function fs(e){return o.exact(1,arguments,fs.name),new s({sinh:a(e)})}function ds(e){return o.exact(1,arguments,ds.name),new s({tan:a(e)})}function ms(e){return o.exact(1,arguments,ms.name),new s({tanh:a(e)})}function ps(){return o.min(1,arguments,ps.name),new s({lt:a(A(arguments))})}function hs(){return o.min(1,arguments,hs.name),new s({lte:a(A(arguments))})}function gs(){return o.min(1,arguments,gs.name),new s({gt:a(A(arguments))})}function vs(){return o.min(1,arguments,vs.name),new s({gte:a(A(arguments))})}function ys(){return o.min(1,arguments,ys.name),new s({and:a(A(arguments))})}function bs(){return o.min(1,arguments,bs.name),new s({or:a(A(arguments))})}function ws(e){return o.exact(1,arguments,ws.name),new s({not:a(e)})}function Es(e){return o.exact(1,arguments,Es.name),new s({to_string:a(e)})}function Ts(e){return o.exact(1,arguments,Ts.name),new s({to_number:a(e)})}function xs(e){return o.exact(1,arguments,xs.name),new s({to_object:a(e)})}function As(e){return o.exact(1,arguments,As.name),new s({to_array:a(e)})}function Ss(e){return o.exact(1,arguments,Ss.name),new s({to_double:a(e)})}function _s(e){return o.exact(1,arguments,_s.name),new s({to_integer:a(e)})}function Cs(e){return o.exact(1,arguments,Cs.name),new s({to_time:a(e)})}function Os(e){return o.exact(1,arguments,Os.name),new s({to_seconds:a(e)})}function Is(e){return o.exact(1,arguments,Is.name),new s({to_millis:a(e)})}function Rs(e){return o.exact(1,arguments,Rs.name),new s({to_micros:a(e)})}function Ds(e){return o.exact(1,arguments,Ds.name),new s({day_of_week:a(e)})}function Ns(e){return o.exact(1,arguments,Ns.name),new s({day_of_year:a(e)})}function Ls(e){return o.exact(1,arguments,Ls.name),new s({day_of_month:a(e)})}function Ps(e){return o.exact(1,arguments,Ps.name),new s({hour:a(e)})}function js(e){return o.exact(1,arguments,js.name),new s({minute:a(e)})}function Fs(e){return o.exact(1,arguments,Fs.name),new s({second:a(e)})}function Ms(e){return o.exact(1,arguments,Ms.name),new s({month:a(e)})}function ks(e){return o.exact(1,arguments,ks.name),new s({year:a(e)})}function Bs(e){return o.exact(1,arguments,Bs.name),new s({to_date:a(e)})}function qs(e,t){return o.exact(2,arguments,qs.name),new s({move_database:a(e),to:a(t)})}function Hs(e){return o.exact(1,arguments,Hs.name),new s({documents:a(e)})}function Us(e){return o.exact(1,arguments,Us.name),new s({reverse:a(e)})}function Ws(e){return o.exact(1,arguments,Ws.name),new s({access_provider:a(e)})}function o(e,t,n,r){if(e!==null&&n.length<e||t!==null&&n.length>t)throw new Ut.InvalidArity(e,t,n.length,r)}o.exact=function(e,t,n){o(e,e,t,n)};o.max=function(e,t,n){o(null,e,t,n)};o.min=function(e,t,n){o(e,null,t,n)};o.between=function(e,t,n,r){o(e,t,n,r)};function L(e,t){for(var n in t){var r=t[n];r!=null&&(e[n]=r)}return e}function A(e){var t=Array.isArray(e)?e:Array.prototype.slice.call(e);return e.length===1?e[0]:t}function it(e){var t=[];return t.push.apply(t,e),t}function a(e){return o.exact(1,arguments,a.name),e===null?null:e instanceof s||b.checkInstanceHasProperty(e,"_isFaunaExpr")?e:typeof e=="symbol"?e.toString().replace(/Symbol\((.*)\)/,function(t,n){return n}):typeof e=="function"?Wt(e):Array.isArray(e)?new s(e.map(function(t){return a(t)})):e instanceof Uint8Array||e instanceof ArrayBuffer?new tr.Bytes(e):typeof e=="object"?new s({object:st(e)}):e}function st(e){if(e!==null){var t={};return Object.keys(e).forEach(function(n){t[n]=a(e[n])}),t}else return null}Vs.exports={Ref:nr,Bytes:rr,Abort:ar,At:ir,Let:sr,Var:be,If:or,Do:ur,Object:cr,Lambda:Wt,Call:lr,Query:fr,Map:dr,Foreach:mr,Filter:pr,Take:hr,Drop:gr,Prepend:vr,Append:yr,IsEmpty:br,IsNonEmpty:wr,IsNumber:Er,IsDouble:Tr,IsInteger:xr,IsBoolean:Ar,IsNull:Sr,IsBytes:_r,IsTimestamp:Cr,IsDate:Or,IsString:Ir,IsArray:Rr,IsObject:Dr,IsRef:Nr,IsSet:Lr,IsDoc:Pr,IsLambda:jr,IsCollection:Fr,IsDatabase:Mr,IsIndex:kr,IsFunction:Br,IsKey:qr,IsToken:Hr,IsCredentials:Ur,IsRole:Wr,Get:Vr,KeyFromSecret:Gr,Reduce:Jr,Paginate:$r,Exists:Xr,Create:zr,Update:Yr,Replace:Zr,Delete:Qr,Insert:Kr,Remove:ea,CreateClass:ie(ta,"CreateClass() is deprecated, use CreateCollection() instead"),CreateCollection:na,CreateDatabase:ra,CreateIndex:aa,CreateKey:ia,CreateFunction:sa,CreateRole:oa,CreateAccessProvider:ua,Singleton:ca,Events:la,Match:fa,Union:da,Merge:ma,Intersection:pa,Difference:ha,Distinct:ga,Join:va,Range:ya,Login:ba,Logout:wa,Identify:Ea,Identity:ie(Ta,"Identity() is deprecated, use CurrentIdentity() instead"),CurrentIdentity:xa,HasIdentity:ie(Aa,"HasIdentity() is deprecated, use HasCurrentIdentity() instead"),HasCurrentIdentity:Sa,CurrentToken:_a,HasCurrentToken:Ca,Concat:Oa,Casefold:Ia,ContainsStr:Ra,ContainsStrRegex:Da,StartsWith:Na,EndsWith:La,FindStr:ja,FindStrRegex:Fa,Length:Ma,LowerCase:ka,LTrim:Ba,NGram:qa,Repeat:Ha,ReplaceStr:Ua,ReplaceStrRegex:Wa,RegexEscape:Pa,RTrim:Va,Space:Ga,SubString:Ja,TitleCase:$a,Trim:Xa,UpperCase:za,Format:Ya,Time:Za,TimeAdd:Ka,TimeSubtract:ei,TimeDiff:ti,Epoch:Qa,Date:ni,Now:ri,NextId:ie(ai,"NextId() is deprecated, use NewId() instead"),NewId:ii,Database:si,Index:oi,Class:ie(ui,"Class() is deprecated, use Collection() instead"),Collection:ci,Function:li,Role:fi,AccessProviders:di,Classes:ie(mi,"Classes() is deprecated, use Collections() instead"),Collections:pi,Databases:hi,Indexes:gi,Functions:vi,Roles:yi,Keys:bi,Tokens:wi,Credentials:Ei,Equals:Ti,Contains:ie(xi,"Contains() is deprecated, use ContainsPath() instead"),ContainsPath:_i,ContainsField:Si,ContainsValue:Ai,Select:Ci,SelectAll:ie(Oi,"SelectAll() is deprecated. Avoid use."),Abs:Ii,Add:Ri,BitAnd:Di,BitNot:Ni,BitOr:Li,BitXor:Pi,Ceil:ji,Divide:Fi,Floor:Mi,Max:ki,Min:Bi,Modulo:qi,Multiply:Hi,Round:Ui,Subtract:Wi,Sign:Vi,Sqrt:Gi,Trunc:Ji,Count:$i,Sum:Xi,Mean:zi,Any:Yi,All:Zi,Acos:Qi,Asin:Ki,Atan:es,Cos:ts,Cosh:ns,Degrees:rs,Exp:as,Hypot:is,Ln:ss,Log:os,Pow:us,Radians:cs,Sin:ls,Sinh:fs,Tan:ds,Tanh:ms,LT:ps,LTE:hs,GT:gs,GTE:vs,And:ys,Or:bs,Not:ws,ToString:Es,ToNumber:Ts,ToObject:xs,ToArray:As,ToDouble:Ss,ToInteger:_s,ToTime:Cs,ToSeconds:Os,ToMicros:Rs,ToMillis:Is,DayOfMonth:Ls,DayOfWeek:Ds,DayOfYear:Ns,Second:Fs,Minute:js,Hour:Ps,Month:Ms,Year:ks,ToDate:Bs,MoveDatabase:qs,Documents:Hs,Reverse:Us,AccessProvider:Ws,wrap:a}});var De=y((gl,Gs)=>{"use strict";var oe=Ie();function Xu(e,t){return t=typeof t!="undefined"?t:!1,t?JSON.stringify(e,null,"  "):JSON.stringify(e)}function Gt(e){return JSON.parse(e,Jt)}function zu(e){var t=[];try{t.push(Gt(e)),e=""}catch{for(;;){var n=e.indexOf(`
`)+1;if(n<=0)break;var r=e.slice(0,n).trim();r.length>0&&t.push(Gt(r)),e=e.slice(n)}}return{values:t,buffer:e}}function Jt(e,t){if(typeof t!="object"||t===null)return t;if("@ref"in t){var n=t["@ref"];if(!("collection"in n)&&!("database"in n))return oe.Native.fromName(n.id);var r=Jt("collection",n.collection),i=Jt("database",n.database);return new oe.Ref(n.id,r,i)}else return"@obj"in t?t["@obj"]:"@set"in t?new oe.SetRef(t["@set"]):"@ts"in t?new oe.FaunaTime(t["@ts"]):"@date"in t?new oe.FaunaDate(t["@date"]):"@bytes"in t?new oe.Bytes(t["@bytes"]):"@query"in t?new oe.Query(t["@query"]):t}Gs.exports={toJSON:Xu,parseJSON:Gt,parseJSONStreaming:zu}});var zt=y((vl,Js)=>{"use strict";var $t=Re(),Xt=Ht();function B(e,t,n,r){n===void 0&&(n={}),r===void 0&&(r={}),this.reverse=!1,this.params={},this.before=void 0,this.after=void 0,Xt(this.params,n);var i=this.params.cursor||this.params;"before"in i?(this.before=i.before,delete i.before):"after"in i&&(this.after=i.after,delete i.after),this.options={},Xt(this.options,r),this.client=e,this.set=t,this._faunaFunctions=[]}B.prototype.map=function(e){var t=this._clone();return t._faunaFunctions.push(function(n){return $t.Map(n,e)}),t};B.prototype.filter=function(e){var t=this._clone();return t._faunaFunctions.push(function(n){return $t.Filter(n,e)}),t};B.prototype.each=function(e){return this._retrieveNextPage(this.after,!1).then(this._consumePages(e,!1))};B.prototype.eachReverse=function(e){return this._retrieveNextPage(this.before,!0).then(this._consumePages(e,!0))};B.prototype.previousPage=function(){var e=this;return this._retrieveNextPage(this.before,!0).then(this._adjustCursors.bind(e))};B.prototype.nextPage=function(){var e=this;return this._retrieveNextPage(this.after,!1).then(this._adjustCursors.bind(e))};B.prototype._adjustCursors=function(e){return e.after!==void 0&&(this.after=e.after),e.before!==void 0&&(this.before=e.before),e.data};B.prototype._consumePages=function(e,t){var n=this;return function(r){var i=[];r.data.forEach(function(u){u.document&&(u.instance=u.document),u.value&&u.value.document&&(u.value.instance=u.value.document),i.push(u)}),e(i);var c;return t?c=r.before:c=r.after,c!==void 0?n._retrieveNextPage(c,t).then(n._consumePages(e,t)):Promise.resolve()}};B.prototype._retrieveNextPage=function(e,t){var n={};Xt(n,this.params);var r=n.cursor||n;e!==void 0?t?r.before=e:r.after=e:t&&(r.before=null);var i=$t.Paginate(this.set,n);return this._faunaFunctions.length>0&&this._faunaFunctions.forEach(function(c){i=c(i)}),this.client.query(i,this.options)};B.prototype._clone=function(){return Object.create(B.prototype,{client:{value:this.client},set:{value:this.set},_faunaFunctions:{value:this._faunaFunctions},before:{value:this.before},after:{value:this.after},params:{value:this.params}})};Js.exports=B});var ot=y((yl,Xs)=>{"use strict";function $s(e,t,n,r,i,c,u,f,p,g,h){this.method=e,this.path=t,this.query=n,this.requestRaw=r,this.requestContent=i,this.responseRaw=c,this.responseContent=u,this.statusCode=f,this.responseHeaders=p,this.startTime=g,this.endTime=h}Object.defineProperty($s.prototype,"timeTaken",{get:function(){return this.endTime-this.startTime}});Xs.exports=$s});var ut=y((bl,Qs)=>{"use strict";var zs=F();function Ys(e){Error.call(this),this.message=e||"Request aborted due to timeout",this.isTimeoutError=!0}zs.inherits(Ys,Error);function Zs(e){Error.call(this),this.message=e||"Request aborted",this.isAbortError=!0}zs.inherits(Zs,Error);Qs.exports={TimeoutError:Ys,AbortError:Zs}});var Yt=y(()=>{});var ro=y((Tl,no)=>{"use strict";var we=Yt(),Ks=ut(),eo=ae(),Yu=F(),to="stream::";function Ne(e){this.type="http2",this._sessionMap={},this._http2SessionIdleTime=e.http2SessionIdleTime,this._closed=!1}Ne.prototype._resolveSessionFor=function(e,t){var n=t?to+e:e;if(this._sessionMap[n])return this._sessionMap[n];var r=this,i=null,c=0,u=function(){r._cleanupSessionFor(e,t)},f=function(){i&&(clearTimeout(i),i=null)},p=function(){if(f(),r._http2SessionIdleTime!==1/0){var q=function(){i=null,c===0&&u()};i=setTimeout(q,r._http2SessionIdleTime)}},g=function(q){f();var $=q||t;return $?(S.destroy(),Promise.resolve()):new Promise(function(ne){S.close(ne)})},h=function(){++c,f()},E=function(){--c;var q=c===0,$=r._closed||S.closed||S.destroyed;q&&!$&&p()},S=we.connect(e).once("error",u).once("goaway",u),J={session:S,close:g,onRequestStart:h,onRequestEnd:E};return this._sessionMap[n]=J,J};Ne.prototype._cleanupSessionFor=function(e,t){var n=t?to+e:e;this._sessionMap[n]&&(this._sessionMap[n].session.close(),delete this._sessionMap[n])};Ne.prototype.execute=function(e){if(this._closed)return Promise.reject(new eo.ClientClosed("The Client has already been closed","No subsequent requests can be issued after the .close method is called. Consider creating a new Client instance"));var t=this,n=e.streamConsumer!=null;return new Promise(function(r,i){var c=!1,u=!1,f=function(j){c=!0,r(j)},p=function(j){var z=Zu({error:j,isClosed:t._closed});if(c&&n)return e.streamConsumer.onError(z);c=!0,i(z)},g=function(){ne.onRequestEnd(),e.signal&&e.signal.removeEventListener("abort",E)},h=function(j){g(),p(j)},E=function(){u=!0,g(),X.close(we.constants.NGHTTP2_CANCEL),p(new Ks.AbortError)},S=function(){u=!0,g(),X.close(we.constants.NGHTTP2_CANCEL),p(new Ks.TimeoutError)},J=function(j){var z=j[we.constants.HTTP2_HEADER_STATUS],Y=z>=200&&z<400,xe=Y&&n,$e="",M=function(he){if(xe)return e.streamConsumer.onData(he);$e+=he},wt=function(){if(u||g(),!xe)return f({body:$e,headers:j,status:z});!u&&!t._closed&&e.streamConsumer.onError(new TypeError("network error"))};xe&&f({body:"[stream]",headers:j,status:z}),X.on("data",M).on("end",wt)};try{var q=(e.path[0]==="/"?e.path:"/"+e.path)+Yu.querystringify(e.query,"?"),$=Object.assign({},e.headers,{[we.constants.HTTP2_HEADER_PATH]:q,[we.constants.HTTP2_HEADER_METHOD]:e.method}),ne=t._resolveSessionFor(e.origin,n),X=ne.session.request($).setEncoding("utf8").on("error",h).on("response",J);ne.onRequestStart(),!e.signal&&e.timeout&&X.setTimeout(e.timeout,S),e.signal&&e.signal.addEventListener("abort",E),e.body!=null&&X.write(e.body),X.end()}catch(j){t._cleanupSessionFor(e.origin,n),p(j)}})};Ne.prototype.close=function(e){e=e||{},this._closed=!0;var t=function(){};return Promise.all(Object.values(this._sessionMap).map(function(n){return n.close(e.force)})).then(t)};function Zu({error:e,isClosed:t}){var n=t&&(e.code==="ERR_HTTP2_GOAWAY_SESSION"||e.code==="ERR_HTTP2_STREAM_CANCEL");return n?new eo.ClientClosed("The request is aborted due to the Client#close call"):e}no.exports=Ne});var po=y((Pe,je)=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});var ao=new WeakMap,Zt=new WeakMap;function x(e){let t=ao.get(e);return console.assert(t!=null,"'this' is expected an Event object, but got",e),t}function io(e){if(e.passiveListener!=null){typeof console!="undefined"&&typeof console.error=="function"&&console.error("Unable to preventDefault inside passive event listener invocation.",e.passiveListener);return}!e.event.cancelable||(e.canceled=!0,typeof e.event.preventDefault=="function"&&e.event.preventDefault())}function Ee(e,t){ao.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let n=Object.keys(t);for(let r=0;r<n.length;++r){let i=n[r];i in this||Object.defineProperty(this,i,so(i))}}Ee.prototype={get type(){return x(this).event.type},get target(){return x(this).eventTarget},get currentTarget(){return x(this).currentTarget},composedPath(){let e=x(this).currentTarget;return e==null?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return x(this).eventPhase},stopPropagation(){let e=x(this);e.stopped=!0,typeof e.event.stopPropagation=="function"&&e.event.stopPropagation()},stopImmediatePropagation(){let e=x(this);e.stopped=!0,e.immediateStopped=!0,typeof e.event.stopImmediatePropagation=="function"&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(x(this).event.bubbles)},get cancelable(){return Boolean(x(this).event.cancelable)},preventDefault(){io(x(this))},get defaultPrevented(){return x(this).canceled},get composed(){return Boolean(x(this).event.composed)},get timeStamp(){return x(this).timeStamp},get srcElement(){return x(this).eventTarget},get cancelBubble(){return x(this).stopped},set cancelBubble(e){if(!e)return;let t=x(this);t.stopped=!0,typeof t.event.cancelBubble=="boolean"&&(t.event.cancelBubble=!0)},get returnValue(){return!x(this).canceled},set returnValue(e){e||io(x(this))},initEvent(){}};Object.defineProperty(Ee.prototype,"constructor",{value:Ee,configurable:!0,writable:!0});typeof window!="undefined"&&typeof window.Event!="undefined"&&(Object.setPrototypeOf(Ee.prototype,window.Event.prototype),Zt.set(window.Event.prototype,Ee));function so(e){return{get(){return x(this).event[e]},set(t){x(this).event[e]=t},configurable:!0,enumerable:!0}}function Qu(e){return{value(){let t=x(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function Ku(e,t){let n=Object.keys(t);if(n.length===0)return e;function r(i,c){e.call(this,i,c)}r.prototype=Object.create(e.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(let i=0;i<n.length;++i){let c=n[i];if(!(c in e.prototype)){let f=typeof Object.getOwnPropertyDescriptor(t,c).value=="function";Object.defineProperty(r.prototype,c,f?Qu(c):so(c))}}return r}function oo(e){if(e==null||e===Object.prototype)return Ee;let t=Zt.get(e);return t==null&&(t=Ku(oo(Object.getPrototypeOf(e)),e),Zt.set(e,t)),t}function ec(e,t){let n=oo(Object.getPrototypeOf(t));return new n(e,t)}function tc(e){return x(e).immediateStopped}function nc(e,t){x(e).eventPhase=t}function rc(e,t){x(e).currentTarget=t}function uo(e,t){x(e).passiveListener=t}var co=new WeakMap,lo=1,fo=2,ct=3;function lt(e){return e!==null&&typeof e=="object"}function Le(e){let t=co.get(e);if(t==null)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function ac(e){return{get(){let n=Le(this).get(e);for(;n!=null;){if(n.listenerType===ct)return n.listener;n=n.next}return null},set(t){typeof t!="function"&&!lt(t)&&(t=null);let n=Le(this),r=null,i=n.get(e);for(;i!=null;)i.listenerType===ct?r!==null?r.next=i.next:i.next!==null?n.set(e,i.next):n.delete(e):r=i,i=i.next;if(t!==null){let c={listener:t,listenerType:ct,passive:!1,once:!1,next:null};r===null?n.set(e,c):r.next=c}},configurable:!0,enumerable:!0}}function Qt(e,t){Object.defineProperty(e,`on${t}`,ac(t))}function mo(e){function t(){H.call(this)}t.prototype=Object.create(H.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let n=0;n<e.length;++n)Qt(t.prototype,e[n]);return t}function H(){if(this instanceof H){co.set(this,new Map);return}if(arguments.length===1&&Array.isArray(arguments[0]))return mo(arguments[0]);if(arguments.length>0){let e=new Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return mo(e)}throw new TypeError("Cannot call a class as a function")}H.prototype={addEventListener(e,t,n){if(t==null)return;if(typeof t!="function"&&!lt(t))throw new TypeError("'listener' should be a function or an object.");let r=Le(this),i=lt(n),u=Boolean(i?n.capture:n)?lo:fo,f={listener:t,listenerType:u,passive:i&&Boolean(n.passive),once:i&&Boolean(n.once),next:null},p=r.get(e);if(p===void 0){r.set(e,f);return}let g=null;for(;p!=null;){if(p.listener===t&&p.listenerType===u)return;g=p,p=p.next}g.next=f},removeEventListener(e,t,n){if(t==null)return;let r=Le(this),c=(lt(n)?Boolean(n.capture):Boolean(n))?lo:fo,u=null,f=r.get(e);for(;f!=null;){if(f.listener===t&&f.listenerType===c){u!==null?u.next=f.next:f.next!==null?r.set(e,f.next):r.delete(e);return}u=f,f=f.next}},dispatchEvent(e){if(e==null||typeof e.type!="string")throw new TypeError('"event.type" should be a string.');let t=Le(this),n=e.type,r=t.get(n);if(r==null)return!0;let i=ec(this,e),c=null;for(;r!=null;){if(r.once?c!==null?c.next=r.next:r.next!==null?t.set(n,r.next):t.delete(n):c=r,uo(i,r.passive?r.listener:null),typeof r.listener=="function")try{r.listener.call(this,i)}catch(u){typeof console!="undefined"&&typeof console.error=="function"&&console.error(u)}else r.listenerType!==ct&&typeof r.listener.handleEvent=="function"&&r.listener.handleEvent(i);if(tc(i))break;r=r.next}return uo(i,null),nc(i,0),rc(i,null),!i.defaultPrevented}};Object.defineProperty(H.prototype,"constructor",{value:H,configurable:!0,writable:!0});typeof window!="undefined"&&typeof window.EventTarget!="undefined"&&Object.setPrototypeOf(H.prototype,window.EventTarget.prototype);Pe.defineEventAttribute=Qt;Pe.EventTarget=H;Pe.default=H;je.exports=H;je.exports.EventTarget=je.exports.default=H;je.exports.defineEventAttribute=Qt});var vo=y((Fe,Me)=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});var Kt=po(),ue=class extends Kt.EventTarget{constructor(){super();throw new TypeError("AbortSignal cannot be constructed directly")}get aborted(){let t=ft.get(this);if(typeof t!="boolean")throw new TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return t}};Kt.defineEventAttribute(ue.prototype,"abort");function ic(){let e=Object.create(ue.prototype);return Kt.EventTarget.call(e),ft.set(e,!1),e}function sc(e){ft.get(e)===!1&&(ft.set(e,!0),e.dispatchEvent({type:"abort"}))}var ft=new WeakMap;Object.defineProperties(ue.prototype,{aborted:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ue.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});var ce=class{constructor(){ho.set(this,ic())}get signal(){return go(this)}abort(){sc(go(this))}},ho=new WeakMap;function go(e){let t=ho.get(e);if(t==null)throw new TypeError(`Expected 'this' to be an 'AbortController' object, but got ${e===null?"null":typeof e}`);return t}Object.defineProperties(ce.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}});typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ce.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"});Fe.AbortController=ce;Fe.AbortSignal=ue;Fe.default=ce;Me.exports=ce;Me.exports.AbortController=Me.exports.default=ce;Me.exports.AbortSignal=ue});var en=y(()=>{"use strict";var yo=vo(),ke=typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:void 0;ke&&(typeof ke.AbortController=="undefined"&&(ke.AbortController=yo.AbortController),typeof ke.AbortSignal=="undefined"&&(ke.AbortSignal=yo.AbortSignal))});var bo=y(()=>{});var wo=y(()=>{});var xo=y((Il,To)=>{"use strict";en();var dt=F(),tn=ae(),nn=ut();function rn(e){e=e||{},this.type="fetch",this._closed=!1,this._fetch=dt.resolveFetch(e.fetch),this._pendingRequests=new Map,dt.isNodeEnv()&&e.keepAlive&&(this._keepAliveEnabledAgent=new(e.isHttps?bo():wo()).Agent({keepAlive:!0}))}rn.prototype.execute=function(e){if(this._closed)return Promise.reject(new tn.ClientClosed("The Client has already been closed","No subsequent requests can be issued after the .close method is called. Consider creating a new Client instance"));var t=this,n=null,r=e.streamConsumer!=null,i=!e.signal&&!!e.timeout,c=new AbortController,u={isStreaming:r,isAbortedByClose:!1,onComplete:null};t._pendingRequests.set(c,u);var f=function(){t._pendingRequests.delete(c),e.signal&&e.signal.removeEventListener("abort",E),u.onComplete&&u.onComplete()},p=function(){n&&clearTimeout(n)},g=function(S){p();var J=uc(S.headers),q=r&&S.ok;return q?(oc(S,e.streamConsumer,f),{body:"[stream]",headers:J,status:S.status}):(f(),S.text().then(function($){return{body:$,headers:J,status:S.status}}))},h=function(S){return p(),f(),Promise.reject(Eo(S,function(){return!r&&u.isAbortedByClose?new tn.ClientClosed("The request is aborted due to the Client#close call with the force=true option"):i?new nn.TimeoutError:new nn.AbortError}))},E=function(){c.abort()};return i&&(n=setTimeout(function(){n=null,c.abort()},e.timeout)),e.signal&&e.signal.addEventListener("abort",E),this._fetch(dt.formatUrl(e.origin,e.path,e.query),{method:e.method,headers:e.headers,body:e.body,agent:this._keepAliveEnabledAgent,signal:c.signal}).then(g).catch(h)};rn.prototype.close=function(e){e=e||{},this._closed=!0;var t=[],n=function(i,c){var u=i.isStreaming||e.force;if(u)return i.isAbortedByClose=!0,c.abort();t.push(new Promise(function(f){i.onComplete=f}))};this._pendingRequests.forEach(n);var r=function(){};return Promise.all(t).then(r)};function oc(e,t,n){var r=function(u){n(),t.onError(Eo(u))};if(dt.isNodeEnv()){e.body.on("error",r).on("data",t.onData).on("end",function(){n(),t.onError(new TypeError("network error"))});return}try{let u=function(){return i.read().then(function(f){if(!f.done){var p=c.decode(f.value,{stream:!0});return t.onData(p),u()}n(),t.onError(new TypeError("network error"))})};var i=e.body.getReader(),c=new TextDecoder("utf-8");u().catch(r)}catch(u){throw new tn.StreamsNotSupported("Please, consider providing a Fetch API-compatible function with streamable response bodies. "+u)}}function Eo(e,t){var n=e&&e.name==="AbortError";return n?t?t():new nn.AbortError:e}function uc(e){var t={};for(var n of e.entries()){var r=n[0],i=n[1];t[r]=i}return t}To.exports=rn});var Ao=y(()=>{});var an=y((Nl,Co)=>{"use strict";var So=ze(),{getBrowserOsDetails:cc}=F(),Te=F(),_o=ut();function Be(e){var t=e.scheme==="https";e.port||(e.port=t?443:80);var n=!e.fetch&&Te.isNodeEnv()&&dc();this._adapter=n?new(ro())({http2SessionIdleTime:e.http2SessionIdleTime}):new(xo())({isHttps:t,fetch:e.fetch,keepAlive:e.keepAlive}),this._baseUrl=e.scheme+"://"+e.domain+":"+e.port,this._secret=e.secret,this._headers=Object.assign({},e.headers,fc()),this._queryTimeout=e.queryTimeout,this._lastSeen=null,this._timeout=Math.floor(e.timeout*1e3)}Be.prototype.getLastTxnTime=function(){return this._lastSeen};Be.prototype.syncLastTxnTime=function(e){(this._lastSeen==null||this._lastSeen<e)&&(this._lastSeen=e)};Be.prototype.close=function(e){return this._adapter.close(e)};Be.prototype.execute=function(e){e=e||{};var t=e.streamConsumer&&(typeof e.streamConsumer.onData!="function"||typeof e.streamConsumer.onError!="function");if(t)return Promise.reject(new TypeError('Invalid "streamConsumer" provided'));var n=e.secret||this._secret,r=e.queryTimeout||this._queryTimeout,i=this._headers;return i.Authorization=n&&lc(n),i["X-Last-Seen-Txn"]=this._lastSeen,i["X-Query-Timeout"]=r,this._adapter.execute({origin:this._baseUrl,path:e.path||"/",query:e.query,method:e.method||"GET",headers:Te.removeNullAndUndefinedValues(i),body:e.body,signal:e.signal,timeout:this._timeout,streamConsumer:e.streamConsumer})};function lc(e){return"Bearer "+e}function fc(){var e={driver:["javascript",So.version].join("-")},t;try{t=global instanceof ServiceWorkerGlobalScope}catch{t=!1}try{if(Te.isNodeEnv()){e.runtime=["nodejs",process.version].join("-"),e.env=Te.getNodeRuntimeEnv();var n=Ao();e.os=[n.platform(),n.release()].join("-")}else t?e.runtime="Service Worker":(e.runtime=Te.getBrowserDetails(),e.env="browser",e.os=cc())}catch{}var r={"X-FaunaDB-API-Version":So.apiVersion};return Te.isNodeEnv()&&(r["X-Driver-Env"]=Object.keys(e).map(i=>[i,e[i].toLowerCase()].join("=")).join("; ")),r}function dc(){try{return Yt(),!0}catch{return!1}}Co.exports={HttpClient:Be,TimeoutError:_o.TimeoutError,AbortError:_o.AbortError}});var No=y((Ll,Do)=>{"use strict";en();var mc=ot(),pc=ae(),Oo=De(),hc=an(),Io=Re(),gc=F(),Ro=["start","error","version","history_rewrite"],vc=Ro.concat(["snapshot"]);function qe(e,t,n,r){n=gc.applyDefaults(n,{fields:null}),this._client=e,this._onEvent=r,this._query=Io.wrap(t),this._urlParams=n.fields?{fields:n.fields.join(",")}:null,this._abort=new AbortController,this._state="idle"}qe.prototype.snapshot=function(){var e=this;e._client.query(Io.Get(e._query)).then(function(t){e._onEvent({type:"snapshot",event:t})}).catch(function(t){e._onEvent({type:"error",event:t})})};qe.prototype.subscribe=function(){var e=this;if(e._state==="idle")e._state="open";else throw new Error("Subscription#start should not be called several times, consider instantiating a new stream instead.");var t=JSON.stringify(e._query),n=Date.now(),r="";function i(f){var p=Date.now(),g;try{g=Oo.parseJSON(f.body)}catch{g=f.body}var h=new mc("POST","stream",e._urlParams,t,e._query,f.body,g,f.status,f.headers,n,p);e._client._handleRequestResult(f,h)}function c(f){var p=Oo.parseJSONStreaming(r+f);r=p.buffer,p.values.forEach(function(g){g.txn!==void 0&&e._client.syncLastTxnTime(g.txn),g.event==="error"?u(new pc.StreamErrorEvent(g)):e._onEvent(g)})}function u(f){f instanceof hc.AbortError||e._onEvent({type:"error",event:f})}e._client._http.execute({method:"POST",path:"stream",body:t,query:e._urlParams,signal:this._abort.signal,streamConsumer:{onError:u,onData:c}}).then(i).catch(u)};qe.prototype.close=function(){this._state!=="closed"&&(this._state="closed",this._abort.abort())};function mt(e){this._allowedEvents=e,this._listeners={}}mt.prototype.on=function(e,t){if(this._allowedEvents.indexOf(e)===-1)throw new Error("Unknown event type: "+e);this._listeners[e]===void 0&&(this._listeners[e]=[]),this._listeners[e].push(t)};mt.prototype.dispatch=function(e){var t=this._listeners[e.type];if(!!t)for(var n=0;n<t.length;n++)t[n].call(null,e.event,e)};function He(e,t){this._client=e,this._dispatcher=t}He.prototype.on=function(e,t){return this._dispatcher.on(e,t),this};He.prototype.start=function(){return this._client.subscribe(),this};He.prototype.close=function(){this._client.close()};function yc(e){var t=function(n,r){var i=new mt(Ro),c=new qe(e,n,r,function(u){i.dispatch(u)});return new He(c,i)};return t.document=function(n,r){var i=[],c=!0,u=new mt(vc),f=new qe(e,n,r,p);function p(h){switch(h.type){case"start":u.dispatch(h),f.snapshot();break;case"snapshot":g(h);break;case"error":u.dispatch(h);break;default:c?i.push(h):u.dispatch(h)}}function g(h){u.dispatch(h);for(var E=0;E<i.length;E++){var S=i[E];S.txn>h.event.ts&&u.dispatch(S)}c=!1,i=null}return new He(f,u)},t}Do.exports={StreamAPI:yc}});var Po=y((Pl,sn)=>{"use strict";var bc=ze(),wc=zt(),Ec=ot(),Tc=ae(),xc=an(),Ac=De(),Sc=Re(),_c=No(),te=F(),Cc=Ie(),Lo=te.notifyAboutNewVersion();function V(e){var t=Oc();e=te.applyDefaults(e,{domain:"db.fauna.com",scheme:"https",port:null,secret:null,timeout:60,observer:null,keepAlive:!0,headers:{},fetch:void 0,queryTimeout:null,http2SessionIdleTime:t.value,checkNewVersion:!0}),Lo(e.checkNewVersion),t.shouldOverride&&(e.http2SessionIdleTime=t.value),this._observer=e.observer,this._http=new xc.HttpClient(e),this.stream=_c.StreamAPI(this)}V.apiVersion=bc.apiVersion;V.prototype.query=function(e,t){return this._execute("POST","",Sc.wrap(e),null,t)};V.prototype.paginate=function(e,t,n){return t=te.defaults(t,{}),n=te.defaults(n,{}),new wc(this,e,t,n)};V.prototype.ping=function(e,t){return this._execute("GET","ping",null,{scope:e,timeout:t})};V.prototype.getLastTxnTime=function(){return this._http.getLastTxnTime()};V.prototype.syncLastTxnTime=function(e){this._http.syncLastTxnTime(e)};V.prototype.close=function(e){return this._http.close(e)};V.prototype._execute=function(e,t,n,r,i){r=te.defaults(r,null),(t instanceof Cc.Ref||te.checkInstanceHasProperty(t,"_isFaunaRef"))&&(t=t.value),r!==null&&(r=te.removeUndefinedValues(r));var c=Date.now(),u=this,f=["GET","HEAD"].indexOf(e)>=0?void 0:JSON.stringify(n);return this._http.execute(Object.assign({},i,{path:t,query:r,method:e,body:f})).then(function(p){var g=Date.now(),h=Ac.parseJSON(p.body),E=new Ec(e,t,r,f,n,p.body,h,p.status,p.headers,c,g);return u._handleRequestResult(p,E,i),h.resource})};V.prototype._handleRequestResult=function(e,t,n){var r="x-txn-time";e.headers[r]!=null&&this.syncLastTxnTime(parseInt(e.headers[r],10));var i=[this._observer,n&&n.observer];i.forEach(c=>{typeof c=="function"&&c(t,this)}),Tc.FaunaHTTPError.raiseForStatusCode(t)};function Oc(){var e=te.getEnvVariable("FAUNADB_HTTP2_SESSION_IDLE_TIME"),t=e==="Infinity"?1/0:parseInt(e,10),n=!isNaN(t);return{shouldOverride:n,value:n?t:500}}sn.exports=V;sn.exports.resetNotifyAboutNewVersion=function(){Lo=te.notifyAboutNewVersion()}});var Mo=y((jl,Fo)=>{"use strict";var Ic=De();function Rc(e){return function(t,n){return e(jo(t),n)}}function jo(e){var t=e.query,n=e.method,r=e.path,i=e.requestContent,c=e.responseHeaders,u=e.responseContent,f=e.statusCode,p=e.timeTaken,g="";function h(E){g=g+E}return h("Fauna "+n+" /"+r+Nc(t)+`
`),i!=null&&h("  Request JSON: "+on(i)+`
`),h("  Response headers: "+on(c)+`
`),h("  Response JSON: "+on(u)+`
`),h("  Response ("+f+"): Network latency "+p+`ms
`),g}function Dc(e){var t="  ";return e.split(`
`).join(`
`+t)}function on(e){return Dc(Ic.toJSON(e,!0))}function Nc(e){if(e==null)return"";var t=Object.keys(e);if(t.length===0)return"";var n=t.map(function(r){return r+"="+e[r]});return"?"+n.join("&")}Fo.exports={logger:Rc,showRequestResult:jo}});var pt=y((Fl,Bo)=>{var ko=Re(),Lc=F(),Pc=De().parseJSON;Bo.exports=Lc.mergeObjects({Client:Po(),Expr:Qe(),PageHelper:zt(),RequestResult:ot(),clientLogger:Mo(),errors:ae(),values:Ie(),query:ko,parseJSON:Pc},ko)});function fu(e){return typeof e=="string"?e:Object.keys(e).map(t=>`${t}:${e[t]}`).join(";")}function du(e,...t){return t.filter(n=>!!n).forEach(n=>{Object.keys(n).filter(r=>e[r]===void 0).forEach(r=>e[r]=n[r])}),e}var Tn={style:fu},xn={button:{type:"button"}};function d(e,t,...n){if(typeof e=="string"){let r=document.createElement(e);xn[e]&&(t=du(t??{},xn[e])),t&&Object.keys(t).forEach(c=>{let u=Tn[c]?Tn[c](t[c]):t[c];typeof u=="string"?r.setAttribute(c,u):u instanceof Function?r.addEventListener(c,u):r.setAttribute(c,u+"")});let i=c=>{c&&c.forEach(u=>{typeof u=="string"?r.appendChild(document.createTextNode(u)):u instanceof HTMLElement?r.appendChild(u):u instanceof Array?i(u):console.log("addChildren cannot add to dom node",u)})};return n&&i(n),r}{let r=e(t),i=c=>{c&&c.forEach(u=>{typeof u=="string"||u instanceof HTMLElement?r.setContent(u):u instanceof Array?i(u):typeof u=="object"?r.addChild(u):console.log("addChildren cannot add to widget",u)})};return n&&i(n),r}}function re(e,t){for(;e.firstChild;)t.appendChild(e.firstChild)}function At(e,t){for(;e.firstChild;)t.before(e.firstChild)}var qo=xt(pt());var Ho=location.href.includes("localhost"),le=un("work_offline")?.value===!0,Ue={companyName:"Little Light Show",fullName:"Nathan Alix",addressLine1:"4 Andrea Lane",addressLine2:"Greenville, SC 29615"},U={FAUNADB_SERVER_SECRET:"",FAUNADB_ADMIN_SECRET:"",FAUNADB_DOMAIN:"db.us.fauna.com"};if(globalThis.process?.env)U.FAUNADB_SERVER_SECRET=process.env.FAUNADB_SERVER_SECRET,U.FAUNADB_ADMIN_SECRET=process.env.FAUNADB_ADMIN_SECRET;else if(localStorage){if(U.FAUNADB_SERVER_SECRET=localStorage.getItem("FAUNADB_SERVER_SECRET"),U.FAUNADB_ADMIN_SECRET=localStorage.getItem("FAUNADB_ADMIN_SECRET"),!U.FAUNADB_SERVER_SECRET){let e=prompt("Provide the FAUNADB_SERVER_SECRET")||"";U.FAUNADB_SERVER_SECRET=e,localStorage.setItem("FAUNADB_SERVER_SECRET",e)}U.FAUNADB_SERVER_SECRET||console.error("set FAUNADB_SERVER_SECRET in local storage"),U.FAUNADB_ADMIN_SECRET||console.error("set FAUNADB_ADMIN_SECRET in local storage")}function jc(){return 0<=location.href.indexOf("netlify")}var Fc=U.FAUNADB_DOMAIN,Mc=U.FAUNADB_SERVER_SECRET,Ml=U.FAUNADB_ADMIN_SECRET,Uo=jc()?"NETLIFY":"dev",fe=localStorage.getItem("user");function de(){return new qo.default.Client({secret:Mc,domain:Fc})}var Wo;function Vo(){return Wo=Wo||JSON.parse(localStorage.getItem("__GLOBAL_STATE__")||"{}")}function Go(e,t){let n=Vo(),r=typeof t;n[e]={type:r,value:t},localStorage.setItem("__GLOBAL_STATE__",JSON.stringify(n))}function un(e){return Vo()[e]}function Jo(e){return e/1e3}var kc=Ho?365*24*3600:(7-.2)*24*3600,cn=class{constructor(t){this.table=t;let n=localStorage.getItem(`table_${this.table}`);if(!n)this.data=[],this.lastWrite=0;else{let r=JSON.parse(n);this.lastWrite=r.lastWrite,this.data=r.data}}clear(){this.lastWrite=0,this.save()}renew(){this.lastWrite=Date.now(),this.save()}save(){localStorage.setItem(`table_${this.table}`,JSON.stringify({lastWrite:this.lastWrite,data:this.data}))}deleteLineItem(t){let n=this.data.findIndex(r=>r.id===t);this.data.splice(n,1),this.save()}updateLineItem(t){let n=this.data.findIndex(r=>r.id===t.id);-1<n&&this.data.splice(n,1),this.data.push(t),this.save()}expired(){let t=Jo(Date.now()-this.lastWrite);return kc<t}getById(t){return this.data.find(n=>n.id===t)}get(){return this.data}set(t){this.lastWrite=Date.now(),this.data=t,this.save()}};var O=xt(pt());var ln=class{constructor(t){this.tableName=t.tableName,this.cache=new cn(this.tableName)}async removeItem(t){if(!fe)throw"user must be signed in";le||await de().query(O.query.Delete(O.query.Ref(O.query.Collection(this.tableName),t))),this.cache.deleteLineItem(t)}async getItem(t){if(!fe)throw"user must be signed in";if(le||!this.cache.expired()){let n=this.cache.getById(t);if(n)return n}if(!le)return(await de().query(O.query.Get(O.query.Ref(O.query.Collection(this.tableName),t)))).data;throw`unable to load item: ${this.tableName} ${t}`}async upsertItem(t){if(!fe)throw"user must be signed in";let n=de();if(t.id){if(!le){let r=await n.query(O.query.Update(O.query.Ref(O.query.Collection(this.tableName),t.id),{data:{...t,user:fe,update_date:Date.now()}}))}}else if(le)t.id="invoice_"+Date.now().toFixed();else{let r=await n.query(O.query.Create(O.query.Collection(this.tableName),{data:{...t,user:fe,create_date:Date.now()}}));t.id=r.ref.id}this.cache.updateLineItem(t)}async getItems(){if(!fe)throw"user must be signed in";if(le||!this.cache.expired())return this.cache.get();let r=(await de().query(O.query.Map(O.query.Paginate(O.query.Documents(O.query.Collection(this.tableName)),{size:100}),O.query.Lambda("ref",O.query.Get(O.query.Var("ref")))))).data;return r.forEach(i=>{i.data.id=i.ref.value.id}),r.map(i=>i.data)}};var Bc="general_ledger",ht=new ln({tableName:Bc});async function $o(e){return ht.removeItem(e)}async function gt(e){return ht.getItem(e)}async function fn(e){return ht.upsertItem(e)}async function We(){return(await ht.getItems()).filter(t=>t.items&&t.items[0]&&t.items[0].account)}function dn(e){return e.toFixed(2)}function me(e=new Date){return e.toISOString().split("T")[0]}function Xo(e=new Date){return e.toISOString().split("T")[1].substring(0,5)}function mn(e){return e.length?e.reduce((t,n)=>t+n,0):0}function Ve(e){return e.valueAsNumber||0}function vt(e,t){if(!e)throw"no input found";e.value=(t||0).toFixed(2)}function I(e,t,n){e.addEventListener(t,n)}function pe(e,t){console.log("trigger",t),e.dispatchEvent(new Event(t))}function yt(e){e.querySelectorAll("[data-event]").forEach(t=>{let n=t.dataset.event;if(!n)throw"item must define a data-event";let r=hn(t),i=pn(t),c=qc(t,r),u=zo(t);if(c)I(t,"click",()=>{pe(e,n)});else if(u)I(t,"click",()=>{let f=t.checked;pe(e,n+(f?":yes":":no"))});else if(r)I(t,"change",()=>{pe(e,n)});else throw`data-event not supported for this item: ${t.outerHTML}`}),e.querySelectorAll("[data-bind]").forEach(t=>{let n=t.dataset.bind;if(!n)throw"item must define a data-bind";let r=un(n);if(zo(t))t.checked=r.value,I(t,"change",()=>{Go(n,t.checked)});else throw`unimplemented data-bind on element: ${t.outerHTML}`})}function zo(e){return hn(e)&&pn(e)==="checkbox"}function qc(e,t){return e.tagName==="BUTTON"||t&&pn(e)==="button"}function pn(e){return hn(e)&&e.type}function hn(e){return e.tagName==="INPUT"}var G={home:()=>"/index.html",identity:({context:e,target:t})=>`/app/identity.html?target=${t}&context=${e}`,createInvoice:()=>"/app/invoice/invoice.html",invoice:e=>`/app/invoice/invoice.html?id=${e}`,allInvoices:()=>"/app/invoice/invoices.html",allLedgers:()=>"/app/gl/index.html?print=all",printLedger:e=>`/app/gl/index.html?print=${e}`,createLedger:()=>"/app/gl/index.html",dashboard:()=>"/app/index.html",admin:()=>"/app/admin/index.html"};function gn(e){return e==="0.00"||e==="-0.00"}function Ge(e){return gn(e)?"":e}function bt(e){e=e.sortBy({date:"date",id:"number"}).reverse();let t=d("div",{class:"grid-6"},d("div",{class:"col-1-4 text"},"Account"),d("div",{class:"col-5 currency"},"Debit"),d("div",{class:"col-6 currency"},"Credit"),d("div",{class:"line col-1-6"})),n=[0,0],r="";return e.forEach(i=>{i.items.sortBy({account:"string",amount:"gl"}).forEach(c=>{let u=c.amount,f=u>=0&&u,p=u<0&&-u;n[0]+=f||0,n[1]+=p||0;let g=me(new Date(i.date||c.date)),h=d("div",null,g!=r&&d("div",{class:"col-1-6 date section-title"},`${r=g}`),d("div",{class:"col-1-4 text"},c.account),d("div",{class:"col-5 currency"},f&&f.toFixed(2)),d("div",{class:"col-6 currency"},p&&p.toFixed(2)),d("div",{class:"col-1-6 text"},d("a",{href:`/app/gl/index.html?id=${i.id}`},c.comment||"no comment")),d("div",{class:"vspacer-2"}));re(h,t)})}),re(d("div",null,d("div",{class:"line col-1-6"}),d("div",{class:"col-5 currency"},n[0].toFixed(2)),d("div",{class:"col-6 currency"},n[1].toFixed(2)),d("div",{class:"col-6 currency"},Ge((n[0]-n[1]).toFixed(2)))),t),t}function Je(e){let t={};e.forEach(c=>{c.items.sortBy({account:"string"}).forEach(u=>{t[u.account]=t[u.account]||{debit:0,credit:0},u.amount<0?t[u.account].credit-=u.amount:t[u.account].debit+=u.amount})});let n=0,r=Object.keys(t).sort().map(c=>{let u=t[c];return n+=u.debit-u.credit,d("div",null,d("div",{class:"col-1-4"},c),d("div",{class:"currency col-5"},Ge(u.debit.toFixed(2))),d("div",{class:"currency col-6"},Ge(u.credit.toFixed(2))))}),i=d("div",{class:"grid-6 col-1-6"},d("div",{class:"col-1-4 line"},"Account"),d("div",{class:"col-5 line currency"},"Debit"),d("div",{class:"col-6 line currency"},"Credit"));return r.forEach(c=>re(c,i)),re(d("div",null,d("div",{class:"col-1-6 line"}),d("div",{class:"col-1-6 vspacer-1"}),d("div",{class:"col-1-4"},"Imbalance"),d("div",{class:"currency col-6 bold"},n.toFixed(2))),i),i}function Hc(){return JSON.parse(localStorage.getItem("accounts")||"{}")}function Yo(){let e=document.querySelector("#inventory_list");return e||(e=document.createElement("datalist"),e.id="listOfAccounts",Object.entries(Hc()).sort().forEach(([t,n])=>{let r=document.createElement("option");r.value=t,e.appendChild(r)}),document.body.appendChild(e),e)}function Zo(e){I(e,"focus",()=>e.select())}function Qo(e){e.step="0.01",e.addEventListener("change",()=>{let t=e.value,n=e.valueAsNumber?.toFixed(2);t!=n&&(e.value=n)})}function vn(e){let t=Array.from(e.querySelectorAll("input[type=number]"));t.forEach(Zo),t.filter(r=>r.classList.contains("currency")).forEach(Qo)}function yn(e){let t={id:"",items:[],date:new Date().valueOf()},n=new FormData(e);t.id=n.get("id")||"";let r=n.get("date");t.date=new Date(r).valueOf(),t.description=n.get("description")||"";let i;for(let[c,u]of n.entries())switch(c){case"account":i={},t.items.push(i),i.account=u;break;case"debit":i.amount=(i.amount||0)+parseFloat(u||"0");break;case"credit":i.amount=(i.amount||0)-parseFloat(u||"0");break;case"comment":i.comment=u;break}return t.items=t.items.filter(c=>!gn(c.amount.toFixed(2))||!!c.comment).sortBy({account:"string"}),t}function Uc(e){let t=e.querySelector("#end-of-line-items"),n=e.querySelector("#summary-area"),[r,i,c]=["total_credit","total_debit","total_error"].map(u=>e.querySelector(`[name=${u}]`));I(e,"change",()=>{let u=Array.from(e.querySelectorAll("[name=debit]")).map(Ve),f=Array.from(e.querySelectorAll("[name=credit]")).map(Ve),p=mn(u),g=mn(f);vt(i,p),vt(r,g),vt(c,p-g);let h=yn(e),E=Je([h]);n.innerText="",n.appendChild(E)}),I(e,"print-all",async()=>{location.href=G.allLedgers()}),I(e,"print",async()=>{if(!e.reportValidity())return;if(Ve(e.total_error)!==0){alert("Total error must be zero");return}let u=yn(e);await fn(u),location.href=G.printLedger(u.id)}),I(e,"print-detail",async()=>{let u=await We(),f=bt(u);document.body.innerHTML="",document.body.appendChild(f)}),I(e,"print-summary",async()=>{let u=await We(),f=Je(u);document.body.innerHTML="",document.body.appendChild(f)}),I(e,"clear",async()=>{location.href=G.createLedger()}),I(e,"delete",async()=>{let u=e.id.value;await $o(u),location.href=G.allLedgers()}),I(e,"submit",async()=>{if(!e.reportValidity())return;if(Ve(e.total_error)!==0){alert("Total error must be zero");return}let u=yn(e);await fn(u),location.reload()}),I(e,"add-row",()=>{let u=Ko();vn(u);let f=u.querySelector("[name=account]");At(u,t),f.focus()})}function Ko(){return d("form",null,d("input",{class:"col-1-2",name:"account",required:!0,type:"text",placeholder:"account",list:"listOfAccounts"}),d("input",{name:"debit",class:"currency col-3-2",type:"number",placeholder:"debit"}),d("input",{name:"credit",class:"currency col-5-2",type:"number",placeholder:"credit"}),d("input",{name:"comment",class:"text col-1-6",type:"text",placeholder:"comment"}),d("div",{class:"vspacer-1 col-1-6"}))}function bn(e){Yo();let t=d("form",{class:"grid-6"},d("input",{hidden:!0,name:"id",value:e?.id||""}),d("div",{class:"date col-1"},"Date"),d("input",{class:"col-2-5",name:"date",required:!0,type:"date",placeholder:"date",value:e?.date||me()}),d("label",{class:"col-1"},"Batch Summary"),d("textarea",{name:"description",class:"col-2-5 comments",placeholder:"Describe the context for these entries"}),d("div",{class:"vspacer col-1-6"}),d("div",{class:"text col-1-2"},"Account"),d("div",{class:"currency col-3-2"},"Debit (+)"),d("div",{class:"currency col-5-2"},"Credit (-)"),d("div",{class:"line col-1-6"}),d("div",{id:"end-of-line-items",class:"hidden"}),d("button",{class:"button col-1-2",type:"button","data-event":"add-row"},"Add Row"),d("button",{class:"button col-4-2",type:"button","data-event":"submit"},"Save"),d("button",{class:"button col-6 if-desktop",type:"button","data-event":"delete"},"Delete"),d("div",{class:"vspacer col-1-6"}),d("div",{class:"currency col-2-2"},"Total Debit"),d("input",{readonly:!0,type:"number",class:"currency col-4-3",name:"total_debit",value:"0.00"}),d("div",{class:"currency col-2-2"},"Total Credit"),d("input",{type:"number",readonly:!0,class:"currency col-4-3",name:"total_credit",value:"0.00"}),d("div",{class:"currency col-2-2"},"Imbalance"),d("input",{readonly:!0,type:"number",class:"currency col-4-3",name:"total_error",value:"0.00"}),d("div",{class:"col-1-6 vspacer-1"}),d("div",{class:"col-1-6 flex"},d("button",{class:"button col-1 if-desktop",type:"button","data-event":"print"},"Print"),d("button",{class:"button col-1 if-desktop",type:"button","data-event":"clear"},"Clear"),d("button",{class:"button col-1 if-desktop",type:"button","data-event":"print-all"},"Show All")),d("div",{class:"vspacer-2 col-1-6 if-desktop"}),d("div",{class:"section-title col-1-6"},"Summary"),d("div",{class:"vspacer-2 col-1-6"}),d("div",{id:"summary-area",class:"col-1-6"}),d("div",{class:"vspacer-2 col-1-6"}));if(e){let n=t.querySelector("#end-of-line-items");t.date.value=me(new Date(e.date||Date.now())),t.description.value=e.description,e.items.forEach(r=>{let i=Ko();i.account.value=r.account,r.amount<0?i.credit.value=dn(-r.amount):i.debit.value=dn(r.amount),i.comment.value=r.comment,At(i,n)})}return yt(t),Uc(t),vn(t),e||pe(t,"add-row"),pe(t,"change"),t}async function wn(e){let t=d("div",null),n;if(e){let r=await gt(e);if(!r)throw`ledger not found: ${e}`;n=[r]}else n=await We();return t.appendChild(Wc()),t.appendChild(d("div",null,d("div",{class:"vspacer-2"}),d("div",{class:"section-title if-desktop"},"Account Summary"))),n.length?(t.appendChild(Je(n)),t.appendChild(d("div",{class:"vspacer-2"})),t.appendChild(bt(n))):re(d("div",{class:"grid-6"},d("div",{class:"centered row-1-6"},"No ledgers have been defined"),d("div",{class:"vspacer-2 row-1-6"}),d("button",{class:"button row-1","data-event":"create-ledger"},"Create General Ledger")),t),I(t,"create-ledger",()=>{location.href=G.createLedger()}),yt(t),t}function Wc(){return d("div",{class:"grid-6"},d("div",{class:"col-1-6 centered"},`General Ledger for ${Ue.companyName}`),d("div",{class:"line col-1-6 if-desktop"}),d("div",{class:"col-1-3 if-desktop"},d("address",{class:"col-1-5"},Ue.fullName),d("address",{class:"col-1-5"},Ue.addressLine1),d("address",{class:"col-1-5"},Ue.addressLine2)),d("div",{class:"col-4-3 if-desktop"},d("div",{class:"align-right col-6"},`Printed on ${me()} @ ${Xo()}`)))}var Vc=xt(pt());async function eu(){await de().ping()}async function En(){if(!localStorage.getItem("user"))return location.href=G.identity({target:location.href,context:Uo}),!1;try{await eu()}catch{return localStorage.setItem("FAUNADB_SERVER_SECRET",""),G.home(),!1}return!0}var Gc={number:(e,t)=>e-t,"-number":(e,t)=>-(e-t),gl:(e,t)=>e>=0?e-t:t-e,"abs(number)":(e,t)=>Math.abs(e)-Math.abs(t),"-abs(number)":(e,t)=>-(Math.abs(e)-Math.abs(t)),string:(e,t)=>e.localeCompare(t),date:(e,t)=>e.valueOf()-t.valueOf(),noop:()=>0};Array.prototype.sortBy=function(e){return Jc(this,e)};function Jc(e,t){let n=Object.keys(t);return[...e].sort((r,i)=>{let c=0;return n.some(u=>!!(c=Gc[t[u]](r[u],i[u]))),c})}var $c={light_mode:"light",dark_mode:"dark",holiday_mode:"holiday"};function tu(e){e||(e=localStorage.getItem("mode")||""),localStorage.setItem("mode",e),document.body.classList.remove(...Object.values($c)),document.body.classList.add(e)}var Xc=navigator.userAgent.toLocaleUpperCase(),zc=Xc.includes("CHROME"),Yc=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);function nu(){zc&&ru(".if-print-to-pdf"),Yc||ru(".if-desktop")}function ru(e){let t=document.styleSheets;for(let n=0;n<t.length;n++){let r=t[n];for(let i=0;i<r.cssRules.length;i++)if(r.cssRules[i].selectorText===e){r.deleteRule(i);return}}}async function pd(e){await En(),tu(),nu();let t=new URLSearchParams(window.location.search),n=t.get("print");if(n){let r=document.body;switch(n){case"all":{r.innerHTML="";let i=await wn();r.appendChild(i);break}default:{r.innerHTML="";let i=await wn(n);r.appendChild(i)}}return}if(t.has("id")){let r=t.get("id"),i=await gt(r);if(!i)throw`cannot find ledger: ${r}`;e.appendChild(bn(i))}else{let r=bn();e.appendChild(r)}}export{En as identify,pd as init};
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
//# sourceMappingURL=gl.js.map
